var __extends,AutoSuggest;(function(n){var t;(function(n){var t,i,r,u,f,e;(function(n){n.User="SRCHHPGUSR"})(t=n.CookieNames||(n.CookieNames={})),function(n){n.AutoSuggest="AS"}(i=n.CrumbNames||(n.CrumbNames={})),function(n){n.CursorPosition="cp";n.ConversationId="cvid";n.SuggestionCount="sc";n.PartialQuery="pq";n.SuggestionPosition="sp";n.SuggestionType="qs";n.PreviewPaneSuggestionType="qsc";n.SkipValue="sk";n.PreviewPaneSkipValue="skc";n.Ghosting="ghc";n.Css="css";n.Count="count";n.DataSet="ds";n.SessionId="sid";n.TimeStamp="qt";n.Query="q";n.ImpressionGuid="ig";n.QFQuery="qry";n.FormCode="form";n.HashedMuid="nclid";n.RequestElToken="elvr";n.AppId="appid";n.History="history";n.ApiTextDecoration="textdecorations";n.ClientId="clientid";n.Market="mkt";n.Scope="scope";n.CountryCode="cc";n.HomeGeographicRegion="hgr";n.SetLang="setlang"}(r=n.QueryParams||(n.QueryParams={})),function(n){n.ImpressionGuid="X-MSEdge-IG"}(u=n.Headers||(n.Headers={})),function(n){n.HitHighlighting="h";n.PopularNow="p";n.Local="l";n.Answers="a"}(f=n.Options||(n.Options={})),function(n){n.Id="id";n.Query="query";n.Url="url";n.Navigation="nav";n.Type="stype";n.Autocomplete="hc";n.SubstrateInst="substrateInst"}(e=n.SuggestionAttributes||(n.SuggestionAttributes={}))})(t=n.Service||(n.Service={}))})(AutoSuggest||(AutoSuggest={})),function(n){function p(t,i){if(i){var r=y.exec(t);return r&&n.TopLevelDomains[r[1].toLowerCase()]==1}return y.test(t)}function at(n){return lt.test(n)}function u(n,t){var r,i;return n?(n=n.trim(),r=st.exec(n),!r)?null:t&&r[0].length<n.length?null:(i={length:r[0].length,type:0,protocol:r[1],auth:r[2],hostname:r[3],port:r[4],path:r[5],parameters:r[6]},i.auth&&!i.auth.includes(":")&&!i.protocol&&!i.port&&!i.path&&!i.parameters)?null:i.protocol||i.path&&i.path.endsWith("/")?i:i.hostname=="localhost"||p(i.hostname,t)||c.test(i.hostname)||a.test(i.hostname)?i:p(i.hostname,!1)?null:(i.type=i.path&&!at(i.path)?1:2,i):null}function vt(n){return b.some(function(t){return n.startsWith(t)})||w.test(n)}function yt(t,i){var e,r,f,o,s;return i.isMultiWord?!0:(e=u(t,!0),!e||e.type!=0)?!0:(r=i.queryToFetch,c.test(e.hostname)||a.test(e.hostname))?t.startsWith(r)||e.hostname.startsWith(r):(f=e.hostname.split("."),f.length<=2?o=HitHighlightingParser.addMarkers(f[0],r):(f=n.SecondLevelDomains[f[f.length-2]]?f.splice(0,f.length-2):f.splice(0,f.length-1),s=f.join("."),o=HitHighlightingParser.addMarkers(s,r)),!o.includes(HitHighlightingParser.startMarker))?!1:r.includes(".")?(r.endsWith("/")&&(r=r.substr(0,r.length-1)),e.hostname.includes(r)):!0}function pt(n){return ht.test(n)}function k(n){return et.test(n)}function wt(n){return ct.test(n)&&!k(n)}function bt(n){var t;return t=typeof n=="string"?n:d(n),t=kt(t),t.trim().replace(/^ht+p(s)?[:;]+[\\\/]*|^\/*/i,function(n,t){return t?"https://":"http://"})}function kt(n){if(!n||!n.includes("\\"))return n;var i=n.includes("?")?n.indexOf("?"):n.length,r=n.includes("#")?n.indexOf("#"):n.length,t=Math.min(i,r),u=n.substring(0,t),f=n.substr(t);return u.replace(/\\/g,"/")+f}function d(n){var t=n.protocol?n.protocol:"";return t+=n.hostname,t+=n.port?n.port:"",t+=n.path?n.path:"",t+(n.parameters?n.parameters:"")}function i(n,t){var r=n.toLowerCase(),i;return t&1&&(i=g.exec(r),i&&(r=i[1])),t&2&&(i=nt.exec(r),i&&(r=i[1])),t&4&&(i=tt.exec(r),i&&(r=i[1])),t&8&&(i=it.exec(r),i&&(r=i[1])),t&16&&(i=dt.exec(r),i&&(r=i[1])),r}function gt(n){return it.test(n)}function f(n){return nt.test(n)?1:g.test(n)?2:tt.test(n)?3:0}function ni(n,t,r){if(r===void 0&&(r=!1),t){var u=t.toLowerCase();if("https".startsWith(u)||t=="/"||i(u,7)!=u)return i(n,16);if(!r&&("www".startsWith(u)||i(u,15)!=u))return i(n,o)}return i(n,r?o:31)||n}function ti(n,t){var i=f(t);switch(f(n)){case 1:return i!=2;case 2:return i!=1;case 3:case 0:return!0}}function ii(t,r,u){if(i(r.replace(/%20/g," "),31)!=i(u.replace(/%20/g," "),31))return!1;var e=f(t.originalQuery);return n.contains([1,2],e)&&!ti(r,u)?!1:!0}function ri(t){var r=u(t,!0),f,i;return r?(i=r.hostname.split("."),f=r.hostname&&i.length>1?i[i.length-1]=="com"&&rt.some(function(n){return i[i.length-2]==n}):!0,f&&r.path&&n.contains(["/search","/entityexplore"],r.path.toLowerCase()))?!0:!1:!1}function ui(n){var t=u(n.replace(/^ftp:/,"http:"),!0);return(t?t.hostname:null)||""}var r="\\-\\s\\[\\]\\/\\\\!@#$%^&*()+={}:;~`\"'|<,>.。?",ut="(?:[^"+r+"]-*)*[^"+r+"](?:-*[^"+r+"])*",s="(?:[^"+r+"]-*)*[^"+r+"0-9](?:-*[^"+r+"])*",ft="(?:(?:"+ut+"[.。])*"+s+")",h="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])",e="(?:(?:"+h+"\\.){3}"+h+")",c=new RegExp("^"+e+"$"),t="(?:[0-9a-fA-F]{1,4})",l="(?::(?:(?::"+t+"){1,7}|:)|(?:"+t+":){1,7}:|(?:"+t+":){7}"+t+"|(?:"+t+":){1,6}(?::"+t+"){1}|(?:"+t+":){1,5}(?::"+t+"){2}|(?:"+t+":){1,4}(?::"+t+"){3}|(?:"+t+":){1,3}(?::"+t+"){4}|(?:"+t+":){1,2}(?::"+t+"){5}|(?:"+t+":){1,1}(?::"+t+"){6}|fe80:(?::"+t+"){0,4}%[0-9]+|::ffff:"+e+"|)",a=new RegExp("^\\["+l+"\\]$","i"),v="ht+ps?[:;]+[\\\\/]*|/+",et=new RegExp("^("+v+")","i"),ot=ft+"|"+e+"|\\["+l+"\\]",st=new RegExp("^("+v+")?([^/]+@)?("+ot+")(:(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{1,4}|[1-9][0-9]{0,3}))?([\\/\\\\][^?#]*)?([?#].*)?","i"),y=new RegExp("[.。]("+s+")$","i"),ht=/((^[\\]{2}).+)|(^[a-z]:\\.*)/i,ct=/^[a-z0-9\-]+:/i,lt=/\s/,w,b,o,rt;n.tryParseUrl=u;w=/file:\/\/\/[^:\/]+:\/[^\/]+\/[^\/]+\/AppData\//i;b=["ms-appx-web:","ms-browser-extension:",];n.isJunkUrl=vt;n.matchesOnDomain=yt;n.isUncOrLocalPath=pt;n.isHttpProtocol=k;n.isNonHttpProtocol=wt;n.cleanAndFixUrlProtocol=bt;n.stripAuthenticationFromUrl=d;var g=/^https:\/*(.*)/i,nt=/^http:\/*(.*)/i,tt=/^\/{2,}(.*)/,it=/^www\.(.*)/i,dt=/^(.*[^:\/])\/+$/;n.normalizeUrl=i;n.hasWww=gt;n.getProtocol=f;o=23;n.prettyPrintUrl=ni;n.isDuplicateUrl=ii;rt=["bing","staging-bing-int","working-bing-int","bing-int","bing-exp"];n.isBingSearchUrl=ri;n.getDomain=ui}(AutoSuggest||(AutoSuggest={})),function(n){var r,u,i,t;(function(n){n[n.Apps=0]="Apps";n[n.Settings=1]="Settings";n[n.Cortana=2]="Cortana";n[n.Command=3]="Command";n[n.Photos=4]="Photos";n[n.Videos=5]="Videos";n[n.Music=6]="Music";n[n.Documents=7]="Documents";n[n.Folders=8]="Folders";n[n.Emails=9]="Emails";n[n.Store=10]="Store";n[n.SearchSuggestions=11]="SearchSuggestions";n[n.PathCompletion=12]="PathCompletion";n[n.PowerBi=13]="PowerBi";n[n.JumpListTasks=14]="JumpListTasks";n[n.JumpListPinned=15]="JumpListPinned";n[n.JumpListRecent=16]="JumpListRecent";n[n.JumpListFrequent=17]="JumpListFrequent";n[n.JumpListCustom=18]="JumpListCustom";n[n.Calendar=19]="Calendar";n[n.People=20]="People";n[n.EdgeHistory=21]="EdgeHistory";n[n.LocalPlaces=22]="LocalPlaces";n[n.VCDExamples=23]="VCDExamples";n[n.Experimental=24]="Experimental";n[n.Bookmarks=25]="Bookmarks";n[n.Related=26]="Related";n[n.Websites=27]="Websites";n[n.Frequent=52]="Frequent";n[n.SearchHistory=53]="SearchHistory"})(r=n.GroupType||(n.GroupType={})),function(n){n.WebSuggestions="WebSuggestions";n.AppsOnline="AppsOnline";n.SettingsOnline="SettingsOnline";n.BCSApps="BCSApps";n.BCSSettings="BCSSettings";n.LocalApps="LocalApps";n.LocalRecentApps="LocalRecentApps";n.LocalSettings="LocalSettings";n.LocalMedia="LocalMedia";n.LocalFiles="LocalFiles";n.LocalPowerBI="LocalPowerBI";n.LocalBrowsingHistory="LocalBrowsingHistory";n.PathCompletion="PathCompletion";n.CommandLine="CommandLine";n.MRU="MRU";n.MRUApps="MRUApps";n.MRUSettings="MRUSettings";n.MRUFilesAndFolders="MRUFilesAndFolders";n.OneDrive="OneDrive";n.ZeroInput="ZeroInput";n.Office365Calendar="O365Cal";n.Experimental="Experimental";n.Substrate="Substrate";n.Local="Local";n.TypedUrls="TypedUrls"}(u=n.DataSourceNames||(n.DataSourceNames={})),function(n){function t(t,i,r,u,f,e){var o={T:n.QFPERFPING_EVENT_NAME,ST:r,CVID:u,OFFSETS:i,STATE:f,V:n.QFPERFPING_VERSION,RFC:e};return{ImpressionGuid:t,EventType:n.CLIENTINST_EVENT_TYPE,Data:o}}n.CLIENTINST_EVENT_TYPE="ClientInst";n.QFPERFPING_EVENT_NAME="QFPerfPing";n.CLICK_EVENT_TYPE="Click";n.QFPERFPING_VERSION="2";n.QFPERFPING_INVALID_MEASURE=-2;n.INVALID_SEQUENCE_NUMBER=-2;n.KVALUE_SUGGESTIONS_START=1e3;n.KVALUE_SUFFIX_START=1;n.KVALUE_NON_SUGGESTIONS_START=100;n.DEFAULT_APP_NAMESPACE="SmartSearch";n.DEFAULT_SERVICE_NAME="AutoSuggest";n.createPerfPingEvent=t}(i=n.InstrumentationCommon||(n.InstrumentationCommon={}));t=function(){function n(n,t){this._kValue=n;this._handOffType=t}return n.createInstrumentedItem=function(t){return new n(n.generateKValue(t))},n.getNonSuggestionInstrumentedItem=function(t,i,r){return new n(i[t],r)},n.prototype.getKValue=function(){return this._kValue},n.prototype.getAppNS=function(){return n.AppNS},n.prototype.getLayoutKValue=function(){return this._kValue+"."+n.Suffix},n.prototype.getHValue=function(){return"ID="+n.AppNS+","+this.getLayoutKValue()},n.prototype.getHandoffType=function(){return this._handOffType},n.resetKValues=function(n){delete this._keystrokesKValues[n]},n.generateKValue=function(n){var r=n,t=this._keystrokesKValues[r];return t>0||(t=i.KVALUE_SUGGESTIONS_START),this._keystrokesKValues[r]=++t,t},n}();t.AppNS=i.DEFAULT_APP_NAMESPACE;t.Suffix=i.KVALUE_SUFFIX_START;t._keystrokesKValues={};n.InstrumentedItem=t}(AutoSuggest||(AutoSuggest={})),function(n){function ft(){return matchMedia("screen and (-ms-high-contrast)").matches}function et(){return navigator.onLine}function ot(n){return!n.isAnswer&&(n.handoffType==0||n.handoffType==11)}function s(n){return n?n.replace(g,"$1").replace(nt,"$1 "):n}function st(n){return n?n.replace(/[-{}]/g,"").toLowerCase():null}function ht(n){return!n||Object.keys(n).length===0}function h(n,t,r,u){var f,e;n&&(n=n.slice(0,t)+i+n.slice(t,n.length));f=r(n);f&&(e=f.indexOf(i),t=e!=-1?e:t,f=f.replace(i,""));u(f,t)}function r(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];i.forEach(function(t){return delete n.enabledDataSources[t]})}function ct(i,u,f){return i.queryToFetch&&(i.queryToFetch.length<f.minQueryLengthForWebProvider||f.bingDisabledCountriesList&&t(f.bingDisabledCountriesList,u.toLowerCase()))?(r(i,n.WebDataSource),!0):!1}function c(t){if(t){t=n.normalizeUrl(t,15);for(var i=1;i<t.length-1;++i)if(it.includes(t[i]))return!0}return!1}function lt(n,t){var i,r;return h(n,t,function(n){return s(n)},function(n,t){i=n;r=t}),i&&(i=i.trim(),r=Math.min(r,i.length)),{originalQuery:n,originalCursorPosition:t,queryToFetch:i,cursorPosition:r,enabledDataSources:{},equals:function(n){return(i?i.toLowerCase():i)==(n.queryToFetch?n.queryToFetch.toLowerCase():n.queryToFetch)},isMultiWord:c(i),getCacheKey:function(){return i}}}function l(n,i,r){return i&&!i.enabledDataSources[n]?!1:t(r.enabledDataSources,n)}function a(n,i,r,u,f){var e=u.enabledDataSources[n];return e?e.suggestionIsEnabled&&!e.suggestionIsEnabled(i,r)?!1:t(f.enabledDataSources,n):!1}function t(n,t){return n.indexOf(t)!=-1}function at(n,i){return n.filter(function(n){return!t(i,n)})}function vt(n,t){if(n.length!=t.length)return!1;for(var i=0;i<n.length;++i)if(n[i]!=t[i])return!1;return!0}function yt(n,t){if(n===t)return!0;if(!n||!t||Object.keys(n).length!=Object.keys(t).length)return!1;for(var i in n)if(n[i]!=t[i])return!1;return!0}function pt(n,t){return n?n.replace(tt,function(n,i){return t[i]}):n}function wt(n){var t=n?n.number:null,i=n?n.name:null;return t==-2147023673||i=="Canceled"}function v(n,t,i,r,u,f){try{return n()}catch(e){return f||SharedLogHelper.LogError(t,r,e),u&&u(),i}}function f(n,t){var i=[],r=!0,u=function(){for(var u=[],n=0;n<arguments.length;n++)u[n]=arguments[n];r?i.push(u):t.apply(null,u)};n(u);r=!1;i.forEach(function(n){return t.apply(null,n)})}function bt(n){return t(e,n)}function kt(n){return t(y,n)}function dt(n,t,i){return i?n==93:n==121&&t}function gt(n,t){return n==8||n==46||n==88&&t.ctrlKey}function ni(){return _w.location.protocol}function ti(){return _w.location.host}function ii(){return _w.innerWidth}function ri(){return _d.activeElement}function p(t){return t&&+t!=n.WindowsApiDefaultDate&&!isNaN(t.getTime())&&t.getFullYear()!=1600}function b(n){return p(n)?Math.abs(Date.now()-n.getTime())/w:null}function ui(n){return b(n)>14}function fi(n){var t;return function(){t?(sb_ct(t),t=0,n()):t=sb_st(function(){n();t=0},250)}}function ei(n){return encodeURIComponent(n).replace(/[!'()*]/g,escape).replace(/%20/g,"+")}var i=String.fromCharCode(57346),g=new RegExp("^\\s*("+i+")?\\s*"),nt=new RegExp("\\s*("+i+")?\\s+","g"),tt=/{([0-9]+)}/g,it=" -_/\\",rt=-2147215328,ut=-2147023673,u,e,y,w,o,k,d;SharedLogHelper.RegisterErrorFilter(function(n){var t=n?n.number:null,i=n?n.name:null;return t===ut||t===rt||i==="Canceled"});n.isHighContrastEnabled=ft;n.isBrowserOnline=et;n.isWebSuggestion=ot;n.cleanQuery=s;n.cleanGuid=st;n.isEmpty=ht;n.mantainCursorPositionIn=h;n.disableDataSources=r;n.disableWebDataSourceIfNeeded=ct;n.isMultiWord=c;n.parseQuery=lt;n.isDataSourceEnabled=l;n.isSuggestionTypeEnabled=a;n.contains=t;n.except=at;n.sequenceEqual=vt;n.objEquals=yt;n.log=function(){};n.getDate=function(){return new Date};sa_config.th&&(n.log=function(n,t){return ClientTestHooks.ClientLog("- "+n,t)},u=ClientTestHooks.getUrlValue("currentdate",null),u&&(n.getDate=function(){return new Date(u)}));n.fetchWrapper=function(n,t,i){return i()};n.formatString=pt;n.isCancellation=wt;n.safeExecute=v;n.ensureCallbackIsAsync=f;n.WebDataSource="Web";n.MRUDataSource="MRU";n.DataSourceStateFor200Response=null;n.isBingEnabledCache=!0;e=[38,40,];y=e.concat(37,39,36,35);n.isUpOrDownKey=bt;n.isMovingCursorKey=kt;n.isContextMenuKey=dt;n.isDeletionKey=gt;n.getWindowProtocol=ni;n.getWindowHost=ti;n.getWindowWidth=ii;n.getCurrentActiveElement=ri;n.WindowsApiDefaultDate=-116444736e5;n.isValidDate=p;w=864e5;n.getTimeDiffInDays=b;n.olderThan2Weeks=ui;n.doubleClickGuardedHandler=fi;o=function(){function n(){this._cancellations={};this._lastId=0}return n.prototype.register=function(n,t){var i=++this._lastId;return this._cancellations[i]={action:n,skipOnDismissAndLaunch:t},i},n.prototype.unregister=function(n){delete this._cancellations[n]},n.prototype.cancelAll=function(n){var i,t;for(i in this._cancellations)t=this._cancellations[i],t.skipOnDismissAndLaunch&&n||t.action();this._cancellations={}},n}();n.CancellationManager=o;k=function(){function n(){}return n.prototype.getItem=function(n){try{return _w.localStorage.getItem(n)}catch(t){return SharedLogHelper.LogError("localStorage",t,new Error("getItem")),undefined}},n.prototype.setItem=function(n,t){try{_w.localStorage.setItem(n,t)}catch(i){SharedLogHelper.LogError("localStorage",i,new Error("setItem"))}},n.prototype.removeItem=function(n){try{return _w.localStorage.removeItem(n)}catch(t){SharedLogHelper.LogError("localStorage",t,new Error("removeItem"))}},n}();n.LightweightStorage=k;d=function(){function t(n,t,i,r,u,f,e,s,h){var c=this;this._config=n;this._host=t;this._suggestionsParsers=i;this._rootViewModel=r;this._suggestionsRenderingManager=u;this._webProviders=f;this._otherProviders=e;this._instrumentationHelper=s;this._sequenceNumberManager=h;n.cancellationEnabled&&(this._cancellationManager=new o);t.bindShown(function(){c._lastQuery=null;c._currentQuery=null;c._isPaneDismissed=!1});t.bindDismissed(function(){c.stopFurtherProcessing(!0);c.finalizeKeystroke(!0);c._isPaneDismissed=!0});t.bindQueryChangedOrInitialized(function(n,t){return c.onQueryChanged(n,c._config.d,t)});t.bindOnSubmit(function(n,t){return c.onSubmit(n,t)});t.initializeEvents();sj_be(_d.body,"dragstart",function(n){return n.preventDefault(),n.stopPropagation(),!1});sj_b.addEventListener("click",function(n){n.shiftKey&&sj_pd(n)})}return t.prototype.clearFetchTimer=function(){this._fetchTimer&&(sb_ct(this._fetchTimer),this._fetchTimer=null)},t.prototype.finishPreviousQuery=function(n){this.cancelPreviousQuery(n);this._suggestionsRenderingManager.resetTimers()},t.prototype.finalizeKeystroke=function(n){var t=this._sequenceNumberManager.getSequenceNumber();t>0&&this._instrumentationHelper.finalizeKeystrokeLog(t);this._config.fixInstrumentationForClientSubmissions&&n||this._sequenceNumberManager.incrementSequenceNumber()},t.prototype.onQueryChanged=function(n,t,i){var u=this,r;this.clearFetchTimer();this._stopFurtherProcessing=!1;this._currentQuery=n;this._lastQuery&&(!this._lastQuery.equals(this._currentQuery)||i)&&this.cancelPreviousQuery(!1);t<=0?this.fetchForQueryChange(0,!1,i):(r=Date.now(),this._fetchTimer=sb_st(function(){return v(function(){return u.fetchForQueryChange(Date.now()-r,!1,i)},"fetchTimer")},t))},t.prototype.onSubmit=function(n,t){var i=this;this._fetchTimer&&(this._currentQuery||(this._currentQuery=this._host.getQuery()),this.fetchForQueryChange(0,!0,!1));this._instrumentationHelper.instrumentSubmissionBegin();this._rootViewModel.submit(n,this._sequenceNumberManager.getSequenceNumber(),function(){return i.stopFurtherProcessing(!0)},t,this._isPaneDismissed)},t.prototype.cancelPreviousQuery=function(n){this._cancellationManager&&this._cancellationManager.cancelAll(n)},t.prototype.stopFurtherProcessing=function(n){this.clearFetchTimer();this.finishPreviousQuery(n);this._stopFurtherProcessing=!0},t.prototype.fetchForQueryChange=function(t,i,r){var u=this,o,e,h;if(this.clearFetchTimer(),(!this._lastQuery||!this._lastQuery.equals(this._currentQuery)||r)&&(o=this._host.getQuery(),o.equals(this._currentQuery))){if(this.finishPreviousQuery(i),this.finalizeKeystroke(!1),this._lastQuery=this._currentQuery,e=this._sequenceNumberManager.getSequenceNumber(),this._instrumentationHelper.instrumentBeginRequest(e,this._currentQuery,t),h=!this._config.enabledDataSources.some(function(n){return l(n,u._currentQuery,u._config)}),h)this._rootViewModel.onQueryChanged(this._currentQuery,e);if(this._suggestionsRenderingManager.initiateSequenceNumber(e,this._currentQuery),!h){var s=function(){return!u._stopFurtherProcessing&&(u._config.d>0?o.equals(u._currentQuery):e==u._sequenceNumberManager.getSequenceNumber())},c=function(n,t,i,r){return u.onResponseReceived(o,e,n,t,i,s,r)},a=function(t){n.fetchWrapper(o,s,function(){u._webProviders.forEach(function(n){return u.fetchWeb(o,n,e,t,s)});u._otherProviders.forEach(function(n){return u.fetch(o,n,e,t,s)})});u._rootViewModel.onQueryChanged(u._currentQuery,e)};f(a,c)}}},t.prototype.fetchWeb=function(t,i,r,u,f){var o=n.Service.QueryParams,e=this._host.getCustomUrlParameters(t),s;this._host.shouldRequestEltoken()&&(e[o.RequestElToken]="1");e[o.CursorPosition]=t.cursorPosition.toString();e[o.ConversationId]=this._host.getConversationId();e[o.ImpressionGuid]=this._instrumentationHelper.getImpressionGuid(r);s=this._host.getCustomHeaders();i.fetch(t,u,r,this._cancellationManager,f,e,s)},t.prototype.fetch=function(n,t,i,r,u){t.fetch(n,r,i,this._cancellationManager,u)},t.prototype.onResponseReceived=function(n,t,i,r,u,e,o){var s=this,h,c;e()&&(this._instrumentationHelper.instrumentResponseReceived(t,i,u,o),h=function(i,r,f){return s.onSuggestionsParsed(n,t,i,u,r,f)},c=function(u){var f=s._suggestionsParsers[i];f?f.parse(n,t,i,r,e,u,s._cancellationManager):(SharedLogHelper.LogError("onResponseReceived",null,new Error("No parser for data source "+i)),u(i,[],null))},f(c,h))},t.prototype.onSuggestionsParsed=function(n,t,i,r,u,f){var e=this;u=u.filter(function(t){return a(i,t.type,t.handoffType,n,e._config)});this._instrumentationHelper.instrumentDataSource(t,i,u,f);this._rootViewModel.onSuggestionsParsed(n,t,i,r,u);this._suggestionsRenderingManager.queueSuggestions(t,i,u,f)},t}();n.Core=d;n.encodeQueryParameter=ei}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function it(t){return n.contains(g,t)}function rt(t){return n.contains(nt,t)}function ut(t){return n.contains(p,t)}function ft(t){return n.contains(tt,t)}function et(t){return n.contains(w,t)}function kt(){h=null}function dt(n,i,r){var u,e;if(h={},n.scopesOrder.length!=0){u=function(u){var e=parseInt(u),o=t.ScopeConfig[e],s,c;e!=f.All&&o.prefixesLocString&&v(e,o,n)&&(s=i(o.prefixesLocString)+","+r(o.prefixesLocString),c=HitHighlightingParser.removeDiacritics(s.toLocaleLowerCase()).split(","),c.forEach(function(n){return h[n.trim()]=e}))};for(e in t.ScopeConfig)u(e);t.scopeListRequiresUpdate=!0}}function gt(n,t){return n.prefixesLocString?t.getLocString(n.prefixesLocString).split(",")[0].trim():""}function v(t,r,u){var e,h,o,s,c;if(r.showO365upsell())return!0;for(e=u.enabledDataSources.filter(function(t){return t!=n.MRUDataSource}),n.isBingEnabledCache&&t!=f.Web&&(e=e.filter(function(t){return t!=n.WebDataSource})),t==f.Web&&(e=e.filter(function(n){return n!=i.LocalApps})),h=function(n){y(n,null)||(e=e.filter(function(t){return t!=n.dataSource}))},o=0,s=r.enabledDataSources;o<s.length;o++)c=s[o],h(c);return r.enabledDataSources.some(function(t){return n.contains(e,t.dataSource)})?!0:!1}function ni(i,r,u,e){var o=n.parseQuery(i,r),s,h,v,c,a,l;if(o.fullPartialQuery=o.queryToFetch,o.scope=f.All,s=ei(u,o,e),s)o.isFormulatedQuery=!0;else for(o.fullPartialQuery&&(ti(o,u),e&&o.scope!=e.scope&&(o.isFormulatedQuery=!0)),(o.scope==f.All||o.scope==f.Web)&&(h=n.tryParseUrl(o.queryToFetch,!0),h?(o.isProtocol=h.type==0,o.isProtocol&&(o.fixedUrl=n.cleanAndFixUrlProtocol(h))):b.test(o.queryToFetch)&&(o.isProtocol=!0,o.fixedUrl=n.cleanAndFixUrlProtocol(o.queryToFetch))),s=t.ScopeConfig[o.scope],v=o.queryToFetch?s.enabledDataSources:s.enabledDataSourcesForZeroInput,c=0,a=v;c<a.length;c++)l=a[c],n.contains(u.enabledDataSources,l.dataSource)&&(o.enabledDataSources[l.dataSource]=l);return ii(o,u),o.showProgressBar=u.dataSourcesWithProgressBar.some(function(n){return!!o.enabledDataSources[n]}),o.equals=function(n){return(o.queryToFetch?o.queryToFetch.toLowerCase():o.queryToFetch)==(n.queryToFetch?n.queryToFetch.toLowerCase():n.queryToFetch)&&n.scope==o.scope&&n.taskFrame==o.taskFrame&&n.isFormulatedQuery==o.isFormulatedQuery},o.getCacheKey=function(){return o.cursorPosition+o.queryToFetch.toLocaleLowerCase()+o.scope},o}function ti(t,i){var o=n.isDataSourceEnabled(r.PathCompletion,null,i)?k.test(t.fullPartialQuery):!1,e,u;if(o){t.scope=f.PathCompletion;return}for(e in h)if(HitHighlightingParser.removeDiacritics(t.fullPartialQuery.toLocaleLowerCase()).replace(/\s+:/,":").startsWith(e+":")){u=t.originalQuery.indexOf(":");t.queryToFetch=t.originalQuery.substr(u+1);t.cursorPosition=Math.max(0,t.cursorPosition-u-1);n.mantainCursorPositionIn(t.queryToFetch,t.cursorPosition,n.cleanQuery,function(n,i){t.queryToFetch=n;t.cursorPosition=i});t.scope=h[e];t.scopePrefix=t.originalQuery.substr(0,u);t.isMultiWord=n.isMultiWord(t.queryToFetch);break}}function y(i,r){var f=i.requirementLevel||u.None,e,s;return(i.requiredCortanaCapabilities&&f<u.Cortana&&(f=u.Cortana),!t.isCortanaEnabledCache&&f>=u.Cortana)?!1:!n.isBingEnabledCache&&f>=u.Bing?!1:!t.isSignedInWithMSA&&i.requiresMSA?!1:i.requiredCortanaCapabilities&&(e=i.requiredCortanaCapabilities,n.contains(e,o.Personalization)||e.push(o.Personalization),!e.every(function(i){return n.contains(t.availableCortanaCapabilities,i)}))?!1:(s=r?r.queryToFetch:"",i.conditionalRequirements&&!i.conditionalRequirements(s))?!1:!0}function ii(r,u){var c,f,o,s,e,h;for(n.disableWebDataSourceIfNeeded(r,t.regionCache,u),c=r.queryToFetch?t.ScopeConfig[r.scope].enabledDataSources:t.ScopeConfig[r.scope].enabledDataSourcesForZeroInput,f=0,o=c;f<o.length;f++)s=o[f],y(s,r)||n.disableDataSources(r,s.dataSource);r.queryToFetch||(e=!0,u.mruCandidatesEnabled?(h=SearchAppWrapper.CortanaApp.queryFormulationView.searchHistory,h&&h.isDeviceHistoryEnabled||(e=!1)):e=!1,e||n.disableDataSources(r,i.LocalApps,i.LocalRecentApps,i.LocalDocumentsAndFolders,i.LocalMedia));t.isSubstrateO365AccountConnected||n.disableDataSources(r,i.SubstrateSuggestionsEnterprise,i.SubstrateSearchEnterprise);t.isSubstrateOutlookAccountConnected||n.disableDataSources(r,i.SubstrateSuggestionsConsumer,i.SubstrateSearchConsumer)}function ei(i,r,u){var e,h,o,p,l,c,a,s;if((i.showNLQueriesInQF&&SearchAppWrapper.CortanaApp.searchResultsView.getTaskFrame&&(e=n.safeExecute(function(){return SearchAppWrapper.CortanaApp.searchResultsView.getTaskFrame(r.originalQuery)},"getTaskFrame"),!e&&u&&u.taskFrame&&u.originalQuery==r.originalQuery&&(e=u.taskFrame)),!e)||(h=n.safeExecute(function(){return JSON.parse(e)},"parse task frame"),!h))return null;if(o=d(h,f.All),o!=f.All&&(p=t.ScopeConfig[o],v(o,t.ScopeConfig[o],i)&&(l=t.ScopeConfig[o].enabledDataSources.filter(function(n){return oi(n.dataSource)}),l.length>0))){for(r.taskFrame=e,r.parsedTaskFrame=h,c=0,a=l;c<a.length;c++)s=a[c],n.contains(i.enabledDataSources,s.dataSource)&&y(s,null)&&(r.enabledDataSources[s.dataSource]=s);return p}return null}function d(n,t){if(n)switch(n.Uri){case ri:if(n.FileType&&n.FileType.Value){if(n.FileType.Value=="Picture")return f.Photos;if(n.FileType.Value=="Video")return f.Videos}return f.Documents;case ui:case fi:return f.Emails}return t}function oi(n){switch(n){case i.MyStuffDocuments:case i.MyStuffPhotos:case i.MyStuffVideos:case i.MyStuffMusic:case i.MyStuffFolders:case i.MyStuffOneDrive:case i.Office365Calendar:return!0;default:return!1}}var f,i,c,r,l,s,u,e,o,ot,h,b,k;(function(n){n[n.All=0]="All";n[n.Apps=1]="Apps";n[n.Settings=2]="Settings";n[n.Photos=3]="Photos";n[n.Videos=4]="Videos";n[n.Music=5]="Music";n[n.Documents=6]="Documents";n[n.Files=7]="Files";n[n.Folders=8]="Folders";n[n.Web=9]="Web";n[n.PathCompletion=10]="PathCompletion";n[n.Emails=11]="Emails";n[n.Calendar=12]="Calendar";n[n.People=13]="People"})(f=t.Scope||(t.Scope={})),function(n){n.BingApps="OSTMA";n.BingSettings="QS";n.LocalApps="PP";n.LocalRecentApps="LRA";n.LocalSettings="ST";n.LocalDocumentsAndFolders="FL";n.LocalMedia="LM";n.CommandLine="CG";n.PathCompletion="PT";n.PowerBi="PBI";n.EdgeBrowsingHistory="EBH";n.BingContentStore="BCS";n.BCSApps="BQP";n.BCSSettings="BQS";n.MRUApps="MPP";n.MRUSettings="MST";n.MRUFilesAndFolders="MFF";n.OneDrive="ODC";n.MyStuffOneDrive="MODC";n.Office365Calendar="PAWC";n.MyStuffDocuments="MDOC";n.MyStuffFolders="MFOL";n.MyStuffPhotos="MPHO";n.MyStuffVideos="MVID";n.MyStuffMusic="MMUS";n.Experimental="EXP";n.SubstrateSuggestionsEnterprise="SSUE";n.SubstrateSuggestionsConsumer="SSUC";n.SubstrateSearchEnterprise="SSEE";n.SubstrateSearchConsumer="SSEC"}(i=t.DataSources||(t.DataSources={})),function(n){n.Store="CS";n.SpellCorrectedApp="QP";n.SpellCorrectedSetting="QS";n.DirectNav="MD";n.Deeplink="ML";n.SearchHistory="HS";n.Person="PPL";n.Email="OLE";n.Calendar="CAL";n.Local="ELA";n.Bookmark="SBKS";n.Entity="MB"}(c=t.OnlineSuggestionTypes||(t.OnlineSuggestionTypes={})),function(n){n.App="PP";n.Setting="ST";n.Music="MU";n.Photo="LI";n.Video="LV";n.Document="FL";n.Folder="FD";n.PathCompletion="PT";n.CommandLine="CG";n.BCSApp="BQP";n.BCSSetting="BQS";n.PowerBi="PBI";n.BrowsingHistory="EBH";n.JumpListItem="JL";n.VCDExample="VCDE";n.Experimental="EXP";n.StartMenuUrl="LURL";n.StartMenuDocument="LDOC"}(r=t.LocalSuggestionTypes||(t.LocalSuggestionTypes={})),function(n){n.Globe="&#xE774";n.Video="&#xE714";n.ViewAll="&#xE8A9"}(l=t.SegoeFontIcons||(t.SegoeFontIcons={})),function(n){n.ChevronDown="&#xE70D";n.Cancel="&#xE711";n.More="&#xE712";n.Settings="&#xE713";n.Mail="&#xE715";n.People="&#xE716";n.Search="&#xE721";n.Forward="&#xE72A";n.Back="&#xE72B";n.FavoriteStarFill="&#xE735";n.ChevronLeft="&#xE76B";n.ChevronRight="&#xE76C";n.Contact="&#xE77B";n.WindowsLogo="&#xE782";n.Calendar="&#xE787";n.Page="&#xE7C3";n.HalfStarLeft="&#xE7C6";n.History="&#xE81C";n.Recent="&#xE823";n.Sync="&#xE895";n.Help="&#xE897";n.Audio="&#xE8D6";n.Info="&#xE946";n.FolderOpen="&#xE838";n.StoreLogo="&#xEA96";n.List="&#xEA37";n.ListMirrored="&#xEA55";n.GenericApp="&#xEB3B";n.DoubleBookmark="&#xEB8F";n.Photo2="&#xEB9F";n.PowerBILogo="&#xEA1E";n.RemindMe="&#xED48";n.BrowseCards="&#xED4A";n.PageList="&#xF106"}(s=t.CortanaFontIcons||(t.CortanaFontIcons={}));var g=[r.App,r.BCSApp,c.SpellCorrectedApp],nt=[r.Setting,r.BCSSetting,c.SpellCorrectedSetting],p=[r.Photo,r.Video,r.Music],tt=[r.Document,r.StartMenuDocument,r.Folder].concat(p),w=[f.Documents,f.Folders,f.Photos,f.Videos,f.Music];t.isApp=it;t.isSetting=rt;t.isMedia=ut;t.isFileOrFolder=ft;t.isFileOrFolderScope=et,function(n){n[n.None=0]="None";n[n.Bing=1]="Bing";n[n.Cortana=2]="Cortana"}(u||(u={}));e=sa_config||{};e.enabledDataSources||(e.enabledDataSources=[]),function(n){n.Personalization="Personalization";n.BrowsingHistory="BrowsingHistory";n.Email="Email";n.Calendar="Calendar";n.Contacts="Contacts"}(o=t.CortanaCapabilities||(t.CortanaCapabilities={})),function(n){n.Bookmarks="Bookmarks";n.Documents="Documents";n.People="People";n.EmailMessage="Message"}(ot=t.SubstrateDataTypes||(t.SubstrateDataTypes={}));var a={dataSource:i.EdgeBrowsingHistory,requiredCortanaCapabilities:[o.BrowsingHistory],conditionalRequirements:function(t){return!t||n.normalizeUrl(t,31).length>=3}},st={dataSource:n.WebDataSource,suggestionIsEnabled:function(n,t){return t==4},requirementLevel:u.Cortana,forceLowPriority:!0},ht={dataSource:i.Office365Calendar,requirementLevel:u.Cortana,requiredCortanaCapabilities:[o.Calendar]},ct={dataSource:i.SubstrateSuggestionsEnterprise,requirementLevel:u.Cortana,conditionalRequirements:function(){return e.substrateBookmarksEnabled||e.substrateDocumentsEnabled||e.substratePeopleEnabled}},lt={dataSource:i.SubstrateSuggestionsEnterprise,requirementLevel:u.Cortana,conditionalRequirements:function(){return e.substrateBookmarksEnabled}},at={dataSource:i.SubstrateSuggestionsEnterprise,requirementLevel:u.Cortana,conditionalRequirements:function(){return e.substrateDocumentsEnabled}},vt={dataSource:i.SubstrateSuggestionsEnterprise,requirementLevel:u.Cortana,requiredCortanaCapabilities:[o.Contacts],conditionalRequirements:function(){return e.substratePeopleEnabled}},yt={dataSource:i.SubstrateSuggestionsConsumer,requirementLevel:u.Cortana,conditionalRequirements:function(){return e.substratePeopleEnabled}},pt={dataSource:i.SubstrateSuggestionsConsumer,requirementLevel:u.Cortana,requiredCortanaCapabilities:[o.Contacts],conditionalRequirements:function(){return e.substratePeopleEnabled}},wt={dataSource:i.SubstrateSearchEnterprise,requirementLevel:u.Cortana,requiredCortanaCapabilities:[o.Email],conditionalRequirements:function(){return e.substrateEmailsEnabled}},bt={dataSource:i.SubstrateSearchConsumer,requirementLevel:u.Cortana,requiredCortanaCapabilities:[o.Email],conditionalRequirements:function(){return e.substrateEmailsEnabled}};t.ScopeConfig=function(){var h={},c;h[f.All]={icon:{content:s.WindowsLogo,type:2,needsAccentColor:!0},prefixesLocString:"ScopeAll",enabledDataSources:[{dataSource:i.LocalApps},{dataSource:i.LocalSettings},{dataSource:i.LocalDocumentsAndFolders},{dataSource:i.LocalMedia},{dataSource:i.CommandLine},{dataSource:i.PowerBi,requirementLevel:u.Cortana,conditionalRequirements:function(n){return n&&n.length>=6&&n.trim().includes(" ")}},{dataSource:n.MRUDataSource},{dataSource:i.MRUApps},{dataSource:i.MRUSettings},{dataSource:i.MRUFilesAndFolders},{dataSource:i.BingContentStore},{dataSource:i.BCSApps},{dataSource:i.BCSSettings},{dataSource:n.WebDataSource,requirementLevel:u.Bing},{dataSource:i.BingApps,requirementLevel:u.Bing},{dataSource:i.BingSettings,requirementLevel:u.Bing},a,{dataSource:i.OneDrive,requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.Experimental},ct,yt,],enabledDataSourcesForZeroInput:[],showO365upsell:function(){return!1}};h[f.Apps]={icon:{content:s.GenericApp,type:2},prefixesLocString:"ScopeApps",enabledDataSources:[{dataSource:n.WebDataSource,suggestionIsEnabled:function(){return!1},requirementLevel:u.Bing},{dataSource:i.BingContentStore},{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUApps},{dataSource:i.LocalApps,suggestionIsEnabled:function(n){return n==r.App}},{dataSource:i.BCSApps},{dataSource:i.BingApps,requirementLevel:u.Bing}],enabledDataSourcesForZeroInput:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUApps},n.contains(e.enabledDataSources,i.LocalRecentApps)?{dataSource:i.LocalRecentApps}:{dataSource:i.LocalApps,suggestionIsEnabled:function(n){return n==r.App}}],showO365upsell:function(){return!1}};h[f.Settings]={icon:{content:s.Settings,type:2},prefixesLocString:"ScopeSettings",enabledDataSources:[{dataSource:n.WebDataSource,suggestionIsEnabled:function(){return!1},requirementLevel:u.Bing},{dataSource:i.BingContentStore},{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUSettings},{dataSource:i.LocalSettings},{dataSource:i.BCSSettings},{dataSource:i.BingSettings,requirementLevel:u.Bing}],enabledDataSourcesForZeroInput:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUSettings},],showO365upsell:function(){return!1}};h[f.Photos]={icon:{content:s.Photo2,type:2},prefixesLocString:"ScopePhotos",enabledDataSources:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Photo}},{dataSource:i.LocalMedia,suggestionIsEnabled:function(n){return n==r.Photo}},{dataSource:i.OneDrive,suggestionIsEnabled:function(n){return n==r.Photo},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffOneDrive,suggestionIsEnabled:function(n){return n==r.Photo},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffPhotos,suggestionIsEnabled:function(n){return n==r.Photo}},],enabledDataSourcesForZeroInput:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Photo}},{dataSource:i.LocalMedia,suggestionIsEnabled:function(n){return n==r.Photo}},],showO365upsell:function(){return!1}};h[f.Videos]={icon:{content:l.Video,type:1},prefixesLocString:"ScopeVideos",enabledDataSources:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Video}},{dataSource:i.LocalMedia,suggestionIsEnabled:function(n){return n==r.Video}},{dataSource:i.OneDrive,suggestionIsEnabled:function(n){return n==r.Video},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffOneDrive,suggestionIsEnabled:function(n){return n==r.Video},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffVideos,suggestionIsEnabled:function(n){return n==r.Video}},],enabledDataSourcesForZeroInput:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Video}},{dataSource:i.LocalMedia,suggestionIsEnabled:function(n){return n==r.Video}},],showO365upsell:function(){return!1}};h[f.Music]={icon:{content:s.Audio,type:2},prefixesLocString:"ScopeMusic",enabledDataSources:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Music}},{dataSource:i.LocalMedia,suggestionIsEnabled:function(n){return n==r.Music}},{dataSource:i.OneDrive,suggestionIsEnabled:function(n){return n==r.Music},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffOneDrive,suggestionIsEnabled:function(n){return n==r.Music},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffMusic},],enabledDataSourcesForZeroInput:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Music}},{dataSource:i.LocalMedia,suggestionIsEnabled:function(n){return n==r.Music}},],showO365upsell:function(){return!1}};h[f.Documents]={icon:{content:s.Page,type:2},prefixesLocString:"ScopeDocuments",enabledDataSources:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Document}},{dataSource:i.MyStuffPhotos,suggestionIsEnabled:function(n){return n==r.Document}},{dataSource:i.MyStuffVideos,suggestionIsEnabled:function(n){return n==r.Document}},{dataSource:i.LocalDocumentsAndFolders,suggestionIsEnabled:function(n){return n==r.Document}},{dataSource:i.LocalMedia,suggestionIsEnabled:function(n){return n==r.Document}},{dataSource:i.OneDrive,suggestionIsEnabled:function(n){return n==r.Document},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffOneDrive,suggestionIsEnabled:function(n){return n==r.Document},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.LocalApps,suggestionIsEnabled:function(n){return n==r.StartMenuDocument}},{dataSource:i.MyStuffDocuments},at,],enabledDataSourcesForZeroInput:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Document}},{dataSource:i.LocalDocumentsAndFolders,suggestionIsEnabled:function(n){return n==r.Document}},{dataSource:i.LocalMedia,suggestionIsEnabled:function(n){return n==r.Document}}],showO365upsell:function(){return!1}};h[f.Folders]={icon:{content:s.FolderOpen,type:2},prefixesLocString:"ScopeFolders",enabledDataSources:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Folder}},{dataSource:i.LocalDocumentsAndFolders,suggestionIsEnabled:function(n){return n==r.Folder}},{dataSource:i.OneDrive,suggestionIsEnabled:function(n){return n==r.Folder},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffOneDrive,suggestionIsEnabled:function(n){return n==r.Folder},requirementLevel:u.Bing,requiresMSA:!0},{dataSource:i.MyStuffFolders},],enabledDataSourcesForZeroInput:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(){return!1}},{dataSource:i.MRUFilesAndFolders,suggestionIsEnabled:function(n){return n==r.Folder}},{dataSource:i.LocalDocumentsAndFolders,suggestionIsEnabled:function(n){return n==r.Folder}},],showO365upsell:function(){return!1}};h[f.Web]={icon:{content:l.Globe,type:1},prefixesLocString:"ScopeWeb",enabledDataSources:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(n,t){return t==1}},{dataSource:n.WebDataSource,suggestionIsEnabled:function(t,i){return n.contains([0,9,10,5,1],i)},requirementLevel:u.Bing},{dataSource:i.LocalApps,suggestionIsEnabled:function(n,t){return t==1}},a,lt,],enabledDataSourcesForZeroInput:[{dataSource:n.MRUDataSource,suggestionIsEnabled:function(n,t){return t==1}},{dataSource:n.WebDataSource,suggestionIsEnabled:function(t,i){return n.contains([0,9,10,1],i)},requirementLevel:u.Bing},a,],showO365upsell:function(){return!1}};h[f.PathCompletion]={icon:{content:s.WindowsLogo,type:2,needsAccentColor:!0},prefixesLocString:"",enabledDataSources:[{dataSource:i.PathCompletion},{dataSource:i.CommandLine},],enabledDataSourcesForZeroInput:[],showO365upsell:function(){return!1}};h[f.Emails]={icon:{content:s.Mail,type:2},prefixesLocString:"ScopeEmails",enabledDataSources:[bt,wt],enabledDataSourcesForZeroInput:[],showO365upsell:function(){return e.substrateEmailsEnabled&&t.isCortanaEnabledCache&&(!t.isSubstrateO365AccountConnected||!n.contains(t.availableCortanaCapabilities,o.Personalization)||!n.contains(t.availableCortanaCapabilities,o.Email))}};h[f.Calendar]={icon:{content:s.Calendar,type:2},prefixesLocString:"ScopeCalendar",enabledDataSources:[ht],enabledDataSourcesForZeroInput:[],showO365upsell:function(){return!1}};h[f.People]={icon:{content:s.People,type:2},prefixesLocString:"ScopePeople",enabledDataSources:[vt,pt,],enabledDataSourcesForZeroInput:[],showO365upsell:function(){return e.substratePeopleEnabled&&t.isCortanaEnabledCache&&(!t.isSubstrateO365AccountConnected||!n.contains(t.availableCortanaCapabilities,o.Personalization)||!n.contains(t.availableCortanaCapabilities,o.Contacts))}};t.isMobileCache||w.forEach(function(n){return h[n].enabledDataSources.push(st)});for(c in h)h[c].enabledDataSources=h[c].enabledDataSources.filter(function(t){return n.contains(e.enabledDataSources,t.dataSource)}),h[c].enabledDataSourcesForZeroInput=h[c].enabledDataSourcesForZeroInput.filter(function(t){return n.contains(e.enabledDataSources,t.dataSource)});return h}();t.cleanScopePrefixes=kt;t.scopeListRequiresUpdate=!1;t.initScopePrefixes=dt;t.getScopeDisplayName=gt;t.isScopeEnabled=v;t.isCortanaEnabledCache=SearchAppWrapper.CortanaApp.isCortanaEnabled;t.isSignedInWithMSA=!1;t.isSubstrateO365AccountConnected=!1;t.isSubstrateOutlookAccountConnected=!1;t.isMobileCache=SearchAppWrapper.CortanaApp.isMobile;t.regionCache=SearchAppWrapper.CortanaApp.region;t.homeGeographicRegionCache=SearchAppWrapper.CortanaApp.homeGeographicRegion;t.uiLanguageCache=SearchAppWrapper.CortanaApp.uiLanguage;t.availableCortanaCapabilities=[];b=/^ht+ps?[;:]+|^www(?:\.|。)|^\/+/;k=/^[a-z]:\\|^%[^%]+%\\|^\\/i;t.parseQuery=ni;var ri="action://FindMyStuff/FindDocument",ui="action://FindMyStuff/FindMessage",fi="action://FindMyStuff/FindAttachment";t.getScopeFromTaskFrame=d})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function a(n){switch(n){case t.DataSources.LocalApps:return"Apps";case t.DataSources.LocalSettings:return"Settings";case t.DataSources.LocalDocumentsAndFolders:return"Files";case t.DataSources.LocalMedia:return"Media";default:return null}}function v(n){switch(n){case t.DataSources.LocalMedia:case t.DataSources.LocalDocumentsAndFolders:case t.DataSources.MRUFilesAndFolders:case t.DataSources.PathCompletion:case t.DataSources.CommandLine:case t.DataSources.MyStuffDocuments:case t.DataSources.MyStuffFolders:case t.DataSources.MyStuffPhotos:case t.DataSources.MyStuffVideos:case t.DataSources.MyStuffMusic:case t.DataSources.EdgeBrowsingHistory:case t.DataSources.Experimental:return!0;case t.DataSources.BingApps:case t.DataSources.BingSettings:case t.DataSources.LocalApps:case t.DataSources.LocalRecentApps:case t.DataSources.LocalSettings:case t.DataSources.PowerBi:case t.DataSources.BCSApps:case t.DataSources.BCSSettings:case t.DataSources.MRUApps:case t.DataSources.MRUSettings:return!1}throw new Error("New local data source "+n+" needs to be explicity classified as potentially containing PII or not");}function y(n){return n.deviceItem?n.type+"\t"+n.deviceItem.id:n.type+"\t"+n.query}function p(n){var t=n.id;return t?n.type+"\t"+t:n.type+"\t"+n.query}function w(n){switch(n){case t.DataSources.LocalDocumentsAndFolders:case t.DataSources.LocalMedia:case t.DataSources.MyStuffDocuments:case t.DataSources.MyStuffPhotos:case t.DataSources.MyStuffVideos:case t.DataSources.MyStuffMusic:case t.DataSources.MyStuffFolders:return!0;default:return!1}}function b(n){return n&&(n.tagName.toLowerCase()=="body"||n.tagName.toLowerCase()=="iframe"||n.className&&n.classList.contains("suggestion"))}function k(n){return n.kind=="Modern Setting"}function d(n){return t.isApp(n.type)?n.deviceItem:null}function g(n){return t.isFileOrFolder(n.type)?n.deviceItem:null}function f(n){switch(n){case t.LocalSuggestionTypes.PowerBi:case t.LocalSuggestionTypes.BrowsingHistory:case t.LocalSuggestionTypes.Experimental:return!1}return!0}function nt(n){return f(n.type)?n.deviceItem:null}function tt(n){return n.type==t.LocalSuggestionTypes.CommandLine?n.deviceItem:null}function it(n){return n.type==t.LocalSuggestionTypes.PathCompletion?n.deviceItem:null}function rt(n){return n.type==t.LocalSuggestionTypes.PowerBi?n.deviceItem:null}function ut(n){return n.type==t.LocalSuggestionTypes.BrowsingHistory?n.deviceItem:null}function ft(n){return n.type==t.LocalSuggestionTypes.Experimental?n.deviceItem:null}function et(n){return n&&n.classList.contains(t.CssClass_ScopeTile)}function ot(i,r){if(t.isApp(i.type))return n.GroupType.Apps;var f=u(i);if(f)return f.groupType;if(t.isSetting(i.type))return n.GroupType.Settings;switch(i.type){case t.LocalSuggestionTypes.CommandLine:return n.GroupType.Command;case t.LocalSuggestionTypes.PathCompletion:return n.GroupType.PathCompletion;case t.LocalSuggestionTypes.Photo:return n.GroupType.Photos;case t.LocalSuggestionTypes.Video:return n.GroupType.Videos;case t.LocalSuggestionTypes.Music:return n.GroupType.Music;case t.LocalSuggestionTypes.PowerBi:return n.GroupType.PowerBi;case t.LocalSuggestionTypes.Document:case t.LocalSuggestionTypes.StartMenuDocument:return n.GroupType.Documents;case t.LocalSuggestionTypes.Folder:return n.GroupType.Folders;case t.OnlineSuggestionTypes.Email:return n.GroupType.Emails;case t.OnlineSuggestionTypes.Calendar:return n.GroupType.Calendar;case t.OnlineSuggestionTypes.Person:return n.GroupType.People;case t.LocalSuggestionTypes.BrowsingHistory:return n.GroupType.EdgeHistory;case t.LocalSuggestionTypes.Experimental:return n.GroupType.Experimental;case t.OnlineSuggestionTypes.Bookmark:return n.GroupType.Bookmarks;case t.OnlineSuggestionTypes.Local:return n.GroupType.LocalPlaces;default:if(i.isAnswer)return r.logWebGroupForInstantAnswers&&i.answerHtml||s(i)||i.autoOpenPreviewPaneWhenOnTopHit?n.GroupType.SearchSuggestions:n.GroupType.Cortana;switch(i.handoffType){case 2:case 3:return n.GroupType.Store;case 5:case 4:return n.GroupType.Cortana;case 0:case 9:return n.GroupType.SearchSuggestions;case 1:return r.splitWebGroupIntoSuggestionsAndWebsites?n.GroupType.Websites:n.GroupType.SearchSuggestions}throw new Error("Unexpected handoff type: "+i.handoffType);}}function st(t){switch(t){case n.GroupType.JumpListTasks:case n.GroupType.JumpListPinned:case n.GroupType.JumpListRecent:case n.GroupType.JumpListFrequent:case n.GroupType.JumpListCustom:case n.GroupType.VCDExamples:case n.GroupType.Related:return!0;default:return!1}}function u(n){var t=n;return t.parent?t:null}function ht(n){return n.type==t.LocalSuggestionTypes.JumpListItem?n:null}function ct(i){switch(i){case n.GroupType.Apps:case n.GroupType.Store:return t.Scope.Apps;case n.GroupType.Settings:return t.Scope.Settings;case n.GroupType.Documents:return t.Scope.Documents;case n.GroupType.Folders:return t.Scope.Folders;case n.GroupType.Photos:return t.Scope.Photos;case n.GroupType.Videos:return t.Scope.Videos;case n.GroupType.Music:return t.Scope.Music;case n.GroupType.LocalPlaces:case n.GroupType.SearchSuggestions:case n.GroupType.Websites:case n.GroupType.EdgeHistory:case n.GroupType.Bookmarks:return t.Scope.Web;case n.GroupType.Emails:return t.Scope.Emails;case n.GroupType.Calendar:return t.Scope.Calendar;case n.GroupType.People:return t.Scope.People}return t.Scope.All}function lt(n){switch(n){case 0:return t.IconSize_TopResult;case 1:return t.IconSize_Suggestion;case 2:return t.IconSize_GridLayout_Scaled;case 3:return t.IconSize_StartMenu}throw new Error("Unsupported image size: "+n);}function at(){var n=t.uiLanguageCache.toLocaleLowerCase();return e[n]||n}function vt(n,t,i,r,u,f,e,o,s,h,c){return{text:n,getIcon:t,icon:i,type:r,query:u,ciMatchedQuery:null,id:h,click:c,handoffType:e,instItem:f,isAnswer:!1,answerHtml:null,selected:!1,featureStore:undefined,sequenceNumber:o,getMruData:function(){return null},template:0,mayContainPII:s}}function yt(n,t){return n.answerHtml?null:(t=t||n.additionalInfoTextFor3LinesTemplate||n.secondaryText,HitHighlightingParser.removeMarkers(n.text)+(t?", "+t:""))}function pt(n){return n.scope!=t.Scope.All||!!n.taskFrame}function wt(i){return typeof i=="string"?i==t.LocalSuggestionTypes.Photo||i==t.LocalSuggestionTypes.Video:i==n.GroupType.Photos||i==n.GroupType.Videos}function bt(){return o(undefined)}function o(n){return new _w.Promise(n)}function kt(n){n.removeIcon={content:t.CortanaFontIcons.Cancel,type:2}}function dt(n,i){return!n||t.isMobileCache?null:i.scope==t.Scope.All?{fullySuppressedGroups:n.FSUP?n.FSUP.split("\t"):null,partiallySuppressedGroups:n.PSUP?n.PSUP.split("\t"):null}:null}function gt(t){switch(t){case n.GroupType.Calendar:case n.GroupType.Emails:return!0;default:return!1}}function s(n){return n.isAnswer&&(n.handoffType==9||n.handoffType==0&&(!!n.additionalInfoText||!!n.secondaryIcon))}function ni(n){if(u(n))return!1;switch(n.handoffType){case 0:case 9:case 5:case 10:case 4:return!0;case 3:return n.type==r.SearchTheStore;case 2:return n.type==t.LocalSuggestionTypes.PowerBi;default:return!1}}function ti(n){return t.PreviewPane?n.handoffType==0&&!n.answerHtml:!1}function ii(n){if(ThresholdUtilities.isRightToLeftLanguage(t.uiLanguageCache))switch(n){case 37:return 39;case 39:return 37}return n}var r,c,l,i,e,h;(function(t){t.PathCompletionGroupHeader="GPT";t.StoreGroupHeader="GT";t.SearchSuggestionsGroupHeader="GW";t.SearchTheWeb="SW";t.Protocol="PWL";t.SearchTheStore="STS";t.SearchBingImages="SBI";t.SearchBingVideos="SBV";t.ScopesDrawer_SignInToCortana="SDSC";t.ScopesDrawer_IndexingOptions="SDIO";t.IndexingMessage_IndexingOptions="IMIO";t.Substrate_ConnectO365Account="COFA";t.Substrate_CommunicationConsent="SCC";t.SyntheticSuggestionTypesCreatedInAggregator=[t.SearchTheWeb,t.Protocol,t.SearchTheStore,t.SearchBingImages,t.SearchBingVideos];t.KValues=function(){var n={};return n[t.PathCompletionGroupHeader]=108,n[t.StoreGroupHeader]=109,n[t.SearchSuggestionsGroupHeader]=110,n[t.SearchTheWeb]=114,n[t.Protocol]=115,n[t.SearchTheStore]=116,n[t.SearchBingImages]=117,n[t.SearchBingVideos]=118,n[t.ScopesDrawer_SignInToCortana]=119,n[t.ScopesDrawer_IndexingOptions]=120,n[t.IndexingMessage_IndexingOptions]=121,n[t.Substrate_ConnectO365Account]=122,n[t.Substrate_CommunicationConsent]=123,n}();t.HandoffsForNonSuggestions=function(){var n={};return n[t.PathCompletionGroupHeader]=2,n[t.StoreGroupHeader]=3,n[t.SearchSuggestionsGroupHeader]=0,n[t.ScopesDrawer_SignInToCortana]=2,n[t.ScopesDrawer_IndexingOptions]=2,n[t.IndexingMessage_IndexingOptions]=2,n[t.Substrate_ConnectO365Account]=2,n[t.Substrate_CommunicationConsent]=2,n}();t.GroupsForNonSuggestions=function(){var i={};return i[t.PathCompletionGroupHeader]=104,i[t.StoreGroupHeader]=104,i[t.SearchSuggestionsGroupHeader]=104,i[t.ScopesDrawer_SignInToCortana]=n.GroupType.Settings,i[t.ScopesDrawer_IndexingOptions]=n.GroupType.Settings,i[t.IndexingMessage_IndexingOptions]=n.GroupType.Settings,i[t.Substrate_ConnectO365Account]=n.GroupType.Settings,i[t.Substrate_CommunicationConsent]=n.GroupType.Settings,i}()})(r=t.SyntheticQSCodes||(t.SyntheticQSCodes={}));t.GroupHeaderQSCodes=function(){var t={};return t[n.GroupType.PathCompletion]=r.PathCompletionGroupHeader,t[n.GroupType.Store]=r.StoreGroupHeader,t[n.GroupType.SearchSuggestions]=r.SearchSuggestionsGroupHeader,t}(),function(n){n.Unknown="UN";n.NotIndexed="NI";n.PartiallyIndexed="PI"}(c=t.LocalProviderIndexerState||(t.LocalProviderIndexerState={})),function(n){n.ContinuePending="CP";n.Disabled="DI";n.PausePending="PP";n.Paused="PD";n.StartPending="SP";n.StopPending="TP";n.Stopped="SD"}(l=t.SearchServiceStatus||(t.SearchServiceStatus={}));t.providerFailureLogName=a;t.localDataSourceMayContainPII=v;i=function(){function n(){}return n}();i.LaunchAsAdmin="RunAs";i.OpenInNewWindow="TabletMode_OpenNewWindow";i.RemoveFromDeviceHistory="RemoveFromDeviceHistory";i.RemoveFromThisList="RemoveFromThisList";t.Verbs=i;t.getSuggestionKey=y;t.getMRUSuggestionKey=p;t.MRUDatabaseName="mruWithIndex";t.isFileOrFolderLocalDataSource=w;t.isBodyOrSuggestion=b;t.isModernSetting=k;t.getAppItem=d;t.getFileItem=g;t.isItemWithFileMetadata=f;t.getItemWithFileMetadata=nt;t.getCommandLineItem=tt;t.getPathCompletionItem=it;t.getPowerBiItem=rt;t.getBrowsingHistoryItem=ut;t.getNamedItem=ft;t.CssClass_ScopeTile="scopeTile";t.CssClass_Annotation="annotation";t.CssClass_Action="action";t.CssClass_Force1LineOutsideTopResult="force1LineOutsideTopResult";t.isScopeTile=et;t.getGroupType=ot;t.isTopHitChildGroup=st;t.asChildSuggestion=u;t.asJumpListSuggestion=ht;t.getScope=ct;t.IconSize_Suggestion=16;t.IconSize_StartMenu=24;t.IconSize_TopResult=32;t.IconSize_GridLayout=92;t.IconSize_GridLayout_Medium=68;t.IconSize_GridLayout_Scaled=130;t.getImageSizeValue=lt;e={"zh-hans-cn":"zh-cn","zh-hans-sg":"zh-cn","zh-hant-hk":"zh-hk","zh-hant-tw":"zh-tw",ko:"ko-kr",ja:"ja-jp",nb:"nb-no"};t.getCurrentLanguage=at;t.createSuggestion=vt;t.getNarratorText=yt;t.isL2=pt;t.isPhotoOrVideo=wt;t.createVoidPromise=bt;t.createPromise=o;t.setRemoveIcon=kt;t.parseWebSuppresionSignals=dt;t.uses3lineTemplate=gt;t.isWebGroupAnswer=s;t.hasReverseHighlighting=ni;t.supportsPreview=ti;h=function(){function n(n,t){this.verb=n.verb;this.displayName=n.displayName;this.executeAsync=function(){return t(function(){return n.executeAsync()})};this.isDefault=n.isDefault}return n.prototype.executeAsync=function(){return null},n}();t.DeviceItemVerbWrapper=h;t.OneDriveSource="OneDrive";t.Office365Source="Office 365";t.SharePointSource="SharePoint";t.IndexingOptionsSettingId="Classic_{87d66a43-7b11-4a28-9811-c86ee395acf7}";t.ChangeHowWindowsSearchesSettingId="Classic_{D4690CFE-6A59-4BAB-BFF7-9ED0D083E798}";t.EdgeAppId="Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge";t.getRtlAdjustedKey=ii})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function n(){this._sequenceNumber=0}return n.prototype.getNextSequenceNumber=function(){return this._sequenceNumber+1},n.prototype.getSequenceNumber=function(){return this._sequenceNumber},n.prototype.incrementSequenceNumber=function(){this._sequenceNumber++},n}();n.SequenceNumberManager=t}(AutoSuggest||(AutoSuggest={})),function(n){var t,i,r;(function(n){n.checking="checking";n.downloading="downloading";n.error="error";n.noUpdate="noupdate";n.obsolete="obsolete";n.updateReady="updateready"})(t||(t={}));i=[t.checking,t.downloading,t.error,t.noUpdate,t.obsolete,t.updateReady];r=function(){function r(n,t,i){i===void 0&&(i=Date.now);this._autoSuggestHost=n;this._instrumentationHelper=t;this.getNowTimestamp=i;this._appCacheEventIndex=1;this._superFreshEnabled=!1;this._appCache=_w.applicationCache;this.subscribeForEvents()}return r.prototype.instrumentSuperFreshUpdate=function(n){this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.SuperFreshUpdateData.T=this.getNowTimestamp();this._appCacheTimeline.SuperFreshUpdateData.S=n;this.sendAppCacheEvents()},r.prototype.registerSuperFresh=function(){this._superFreshEnabled=!0},r.prototype.subscribeForEvents=function(){var n=this;i.forEach(function(t,i){return sj_be(n._appCache,t,function(){return n.handleAppCacheEvent(t,i)})})},r.prototype.handleAppCacheEvent=function(n,i){n!=t.checking&&this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.AppCacheEvents[i]=this.getNowTimestamp();switch(n){case t.obsolete:SharedLogHelper.LogError("handleAppCacheEvent",null,"AppCache marked as obsolete and will be deleted");this.sendAppCacheEvents();break;case t.error:case t.noUpdate:this.sendAppCacheEvents();break;case t.updateReady:this._superFreshEnabled||this.sendAppCacheEvents()}},r.prototype.sendAppCacheEvents=function(){var t=this._appCacheTimeline,r,u,i;t&&(r=t.AppCacheEvents,u=[{I:t.EventIndex,E:r,S:t.SuperFreshUpdateData,ABT:this._instrumentationHelper.getConversationStartTimestamp()}],r[2]&&(u[0].OL=navigator.onLine),i=n.InstrumentationCommon.createPerfPingEvent(this._autoSuggestHost.getConversationId(),u,"AppCache",this._autoSuggestHost.getConversationId()),Log2.LogEvent(i.EventType,i.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,i.ImpressionGuid,null,null),this._appCacheTimeline=this.createAppCacheTimelineObject())},r.prototype.createAppCacheTimelineObject=function(){var n={EventIndex:this._appCacheEventIndex,AppCacheEvents:{},SuperFreshUpdateData:{T:undefined,S:undefined}};return this._appCacheEventIndex++,n},r}();n.AppCacheInstrumentationHelper=r}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=[t.DataSources.LocalApps,t.DataSources.LocalSettings,t.DataSources.LocalDocumentsAndFolders,t.DataSources.LocalMedia],r=function(){function r(n,t){this._config=n;this._host=t}return r.prototype.logProfilerMarker=function(n,t,i,r,u){u||(u={});n==1?SearchAppWrapper.CortanaApp.logMeasure("Bing_QF_"+i,t,"QF",JSON.stringify(u),r):SearchAppWrapper.CortanaApp.logVerboseTrace("Bing_QF_"+i,t,"QF",JSON.stringify(u),r)},r.prototype.getEnrichedClientInfo=function(n){var i={},r;return i.entryPoint=SearchAppWrapper.CortanaApp.entryPoint,i.previousExperience=SearchAppWrapper.CortanaApp.queryFormulationView.previousExperience,n&&n.scope!=t.Scope.All&&(i.scope=t.Scope[n.scope]),r=SearchAppWrapper.CortanaApp.queryFormulationView.searchHistory,i.deviceHistoryEnabled=r&&r.isDeviceHistoryEnabled?1:0,typeof ConnectedAccounts!="undefined"&&(i.o365Connected=t.isSubstrateO365AccountConnected?1:0,i.outlookConnected=t.isSubstrateOutlookAccountConnected?1:0),this._host.hasFallbackHappened()&&(i.fallback=1),i},r.prototype.getInitPageName=function(){return"Page.SmartSearch.AS.Init"},r.prototype.getSuggestionsPageName=function(){return"Page.SmartSearch.AS.Suggestions"},r.prototype.getApplicationName=function(){return"SmartSearch"},r.prototype.getRankerModelId=function(){return this._config.mainRankerId},r.prototype.getDataSourceNameMap=function(){var i={};return i[n.WebDataSource]=n.DataSourceNames.WebSuggestions,i[t.DataSources.BingApps]=n.DataSourceNames.AppsOnline,i[t.DataSources.BingSettings]=n.DataSourceNames.SettingsOnline,i[t.DataSources.BCSApps]=n.DataSourceNames.BCSApps,i[t.DataSources.BCSSettings]=n.DataSourceNames.BCSSettings,i[t.DataSources.LocalApps]=n.DataSourceNames.LocalApps,i[t.DataSources.LocalRecentApps]=n.DataSourceNames.LocalRecentApps,i[t.DataSources.LocalSettings]=n.DataSourceNames.LocalSettings,i[t.DataSources.LocalMedia]=n.DataSourceNames.LocalMedia,i[t.DataSources.MyStuffPhotos]=n.DataSourceNames.LocalMedia,i[t.DataSources.MyStuffVideos]=n.DataSourceNames.LocalMedia,i[t.DataSources.MyStuffMusic]=n.DataSourceNames.LocalMedia,i[t.DataSources.PowerBi]=n.DataSourceNames.LocalPowerBI,i[t.DataSources.LocalDocumentsAndFolders]=n.DataSourceNames.LocalFiles,i[t.DataSources.MyStuffDocuments]=n.DataSourceNames.LocalFiles,i[t.DataSources.MyStuffFolders]=n.DataSourceNames.LocalFiles,i[t.DataSources.PathCompletion]=n.DataSourceNames.PathCompletion,i[t.DataSources.CommandLine]=n.DataSourceNames.CommandLine,i[n.MRUDataSource]=n.DataSourceNames.MRU,i[t.DataSources.MRUApps]=n.DataSourceNames.MRUApps,i[t.DataSources.MRUSettings]=n.DataSourceNames.MRUSettings,i[t.DataSources.MRUFilesAndFolders]=n.DataSourceNames.MRUFilesAndFolders,i[t.DataSources.OneDrive]=n.DataSourceNames.OneDrive,i[t.DataSources.MyStuffOneDrive]=n.DataSourceNames.OneDrive,i[t.DataSources.Office365Calendar]=n.DataSourceNames.Office365Calendar,i[t.DataSources.EdgeBrowsingHistory]=n.DataSourceNames.LocalBrowsingHistory,i[t.DataSources.Experimental]=n.DataSourceNames.Experimental,i[t.DataSources.SubstrateSuggestionsEnterprise]=n.DataSourceNames.Substrate,i[t.DataSources.SubstrateSuggestionsConsumer]=n.DataSourceNames.Substrate,i[t.DataSources.SubstrateSearchEnterprise]=n.DataSourceNames.Substrate,i[t.DataSources.SubstrateSearchConsumer]=n.DataSourceNames.Substrate,i},r.prototype.createNonSuggestionDataSourceObject=function(n,i){return{T:"D.Url",K:i.getKValue(),Val:n,Ho:t.SyntheticQSCodes.HandoffsForNonSuggestions[n],Gr:t.SyntheticQSCodes.GroupsForNonSuggestions[n]}},r.prototype.createDataSourceObject=function(i){var f=this,e=i.mayContainPII&&!this._config.th,r={T:"D.Url",K:i.instItem.getKValue(),Q:e?undefined:i.query,MQ:i.ciMatchedQuery?i.ciMatchedQuery:undefined,Val:i.type,Ho:i.handoffType,Ans:i.isAnswer?1:undefined,Gr:t.getGroupType(i,this._config),HC:i.hc?1:undefined,RAF:i.useRaf?1:undefined,HS:i.fromHistory?1:undefined,F:i.features?i.features.join(","):undefined,AC:i.autoCompleteType?i.autoCompleteType:undefined,HCMS:i.highConfidenceMetaSuggestionScore,HCS:i.highConfidenceSuggestionScore,PVW:i.previewPaneScenario,LM:i.suggestionLogMeta,PCS:i.prefetchConfidenceScore,PC:i.isPrefetch,Uri:i.actionUri,Src:i.source},u;return i.deviceItem?r.DeviceSignals=n.safeExecute(function(){return f.buildDeviceItemDataSource(e,i)},"buildDeviceItemDataSource"):(u=t.asJumpListSuggestion(i),u&&(r.DeviceSignals=n.safeExecute(function(){return f.buildJumpListItemDataSource(u)},"buildJumpListItemDataSource"))),r.RankerSignals=this.buildRankerOutputDataSource(i),r},r.prototype.buildRankerOutputDataSource=function(n){if(!n.rankingScore&&!n.featureStore)return undefined;return{rankingScore:n.rankingScore,featureStore:n.featureStore,mruSuppressionScore:n.mruSuppressionScore}},r.prototype.buildJumpListItemDataSource=function(t){var r=t.jumpListItem,i={Rank:r.usagePoints||undefined,LAD:n.isValidDate(r.lastAccessed)?r.lastAccessed.toJSON():undefined};if(this._config.th)i.path=r.path,i.description=t.tooltip;else if(!i.Rank&&!i.LAD)return undefined;return i},r.prototype.buildDeviceItemDataSource=function(i,r){var e=r.deviceItem,u={Rank:e.rankScore},f,s,h,o;if(e.propertyHits&&e.propertyHits.length>0&&(u.PHits=e.propertyHits.join(",")),i||(u.Id=e.id,u.DName!=r.query&&(u.DName=e.displayName)),this._config.th&&(u.kind=e.kind),t.isSetting(r.type))return u.MDN=t.isModernSetting(e)?1:0,u;if(f=t.getAppItem(r),f)return u.LAD=n.isValidDate(f.lastAccessed)?f.lastAccessed.toJSON():undefined,u.AppLnch=f.totalLaunches,u.Args=f.launchArguments?1:0,u.MDN=f.isImmersive?1:0,u.Ext=f.extension,this._config.th&&(u.CDT=f.createdDate&&+f.createdDate!=n.WindowsApiDefaultDate?f.createdDate.toJSON():undefined,u.LMD=f.lastModifiedDate&&+f.lastModifiedDate!=n.WindowsApiDefaultDate?f.lastModifiedDate.toJSON():undefined,u.launchArguments=f.launchArguments,u.filePath=f.filePath),u;if(s=t.getItemWithFileMetadata(r),s){if(u.Ext=s.extension,this._config.th&&(u.itemTypeDisplayName=s.itemTypeDisplayName),h=t.getCommandLineItem(r),h)return this._config.th&&(u.launchArguments=h.launchArguments,u.encodedPath=h.encodedPath),u;t.getPathCompletionItem(r)||(o=r.deviceItem,u.CDT=o.createdDate?o.createdDate.toJSON():undefined,u.LMD=o.lastModifiedDate?o.lastModifiedDate.toJSON():undefined,u.Ext=o.extension?o.extension:"")}return u},r.prototype.logMasterPageImpression=function(t){n.safeExecute(function(){return ThresholdInst.LogPageImpression(t,null,t.enrichedClientInfo)},"WindowsCortanaPaneInstrumentationProvider.logMasterImpressionForClient")},r.prototype.logDataSourceTimeout=function(r,u){var o,s,f,e,h;if(SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure)for(o=function(i){n.isDataSourceEnabled(i,u,s._config)&&!n.contains(r,i)&&n.safeExecute(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(t.providerFailureLogName(i),"NoReturnForTopHit")},"logProviderFailure")},s=this,f=0,e=i;f<e.length;f++)h=e[f],o(h)},r.prototype.onItemClick=function(){SearchAppWrapper.CortanaApp.queryFormulationView.resetConversationIdNextTimeQFIsShown&&SearchAppWrapper.CortanaApp.queryFormulationView.resetConversationIdNextTimeQFIsShown()},r}();t.WindowsCortanaPaneInstrumentationProvider=r})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var i="DSNameNotFound",r="/QF_KEYSTROKE_VIRTUAL_URL?",u="/QF_INIT_VIRTUAL_URL?",f="autosuggest",t,e=function(){function e(i,r,u,f,e){var o,s;f===void 0&&(f=Date.now);e===void 0&&(e=function(){return n.getWindowProtocol()+"//"+n.getWindowHost()});o=this;this._config=i;this._host=r;this._clientInstrumentationProvider=u;this.getNowTimestamp=f;this.getOrigin=e;this._perfPingConversationStartTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;this._perfPingSubmissionBeginTime=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;this._perfPingSubmissionEndTime=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;this._keystrokesPerfPingData={};this._keystrokesInstrumentationData={};this._dsNameMap=this._clientInstrumentationProvider.getDataSourceNameMap();this.reset(!0);r.bindConversationStart(function(){return o.reset(!1)});i.th&&(ClientTestHooks.isTesthookParamSet("perfTrace")&&(t=!0),s=n.log,n.log=function(n,t){t||o.instrumentDebugEvent(n);s(n,t)})}return e.prototype.getImpressionGuid=function(n){var t=this._keystrokesInstrumentationData[n];if(t&&t.ImpressionGuid)return t.ImpressionGuid;throw"getImpressionGuid(): No IG for sequence "+n;},e.prototype.enrichTargetUrl=function(t,i,r,u){this._perfPingSubmissionEndTime=this.getOffsetedNow();var f=r+"&form="+n.encodeQueryParameter(u);return f+="&qs="+n.encodeQueryParameter(i),f+="&cvid="+n.encodeQueryParameter(this._host.getConversationId()),f+("&pq="+n.encodeQueryParameter(t))},e.prototype.onItemClick=function(n,t,i){this._perfPingSubmissionEndTime=this.getOffsetedNow();t&&this.updatePageIG(n);var r=this._keystrokesInstrumentationData[n];r?_G.IG!=r.ImpressionGuid&&SharedLogHelper.LogError("onItemClick","IG ("+r.ImpressionGuid+") for sequenceNumber "+n+" does not match the page IG ("+_G.IG+")",new Error("IG for sequence number does not match the currently rendered page's IG (_G.IG)")):SharedLogHelper.LogError("onItemClick","sequenceNumber: "+n+" ConversationID: "+this._host.getConversationId(),new Error("No instrumentation data found for sequenceNumber"));this.finalizeKeystrokeLog(n,1);r&&this.logPerfPingEvent(this.createSubmissionPerfPingEvent(r));i&&i();this._clientInstrumentationProvider.onItemClick()},e.prototype.instrumentCustomGping=function(n,t,i,r,u){var f={},e;i&&(f.cm=i);switch(n){case 0:f.i="k";r&&(e=r.altKey?"A":"",e+=r.ctrlKey?"C":"",e+=r.shiftKey?"S":"",e&&(f.mk=e));break;case 2:f.i="n";break;case 3:f.i="b"}u&&(f.pp=u);this.logCustomGPing(t,f)},e.prototype.logCustomGPing=function(t,i){n.isEmpty(i)||(t+="&PR="+JSON.stringify(i));_w.si_T&&n.safeExecute(function(){return _w.si_T(t)},"logCustomGPing")},e.prototype.logClientInstEvent=function(n,t,i,r,u){var f,e,o;r?(f=null,e=this._keystrokesInstrumentationData[r],e&&(f=e.ImpressionGuid),Log2.LogEvent(n,u,i,null,null,f,null,null)):(o=[n,t,i,!1],u&&Object.keys(u).forEach(function(n){return o.push(n,u[n])}),Log.Log.apply(null,o))},e.prototype.safeInstrument=function(n,t,i,r){var u=this._keystrokesInstrumentationData[n];u?t(u):SharedLogHelper.LogError(i,(r?r+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"))},e.prototype.safeInstrumentPerf=function(n,t,i,r){var u=this._keystrokesPerfPingData[n];u?t(u):SharedLogHelper.LogError(i,(r?r+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"))},e.prototype.instrumentRenderingStarted=function(n){var t=this;this.safeInstrument(n,function(i){i.RenderingStarted=!0;t.updatePageIG(n)},"instrumentRenderingStarted")},e.prototype.instrumentBeginRequest=function(t,i,r){var u;delete this._keystrokesInstrumentationData[t-1];n.InstrumentedItem.resetKValues(t);u=this._keystrokesPerfPingData[t];u&&SharedLogHelper.LogError("instrumentBeginRequest","sequenceNumber: "+t,new Error("Duplicate BeginRequest for sequenceNumber"));var f=this._host.getConversationId(),o=this._host.getRawImpressionGuid(),e=n.cleanGuid(o),s={ImpressionGuid:e,ConversationId:f,Query:i,PendingDataSources:{},DataSources:{},RankerExtraInfo:{},DuplicateDS:{},Layout:[],MasterPageImpressionCreated:!1,RenderingStarted:!1,PendingInstrumentedItems:{},PendingSyntheticSuggestions:{}},h=this.getOffsetedNow(),c={ImpressionGuid:e,ConversationId:f,PrefixLength:i.queryToFetch?i.queryToFetch.length:0,RequestBegin:h-r,ResponseReceived:{},DataSourcesState:this._searchServiceStatus?{Indexer:this._searchServiceStatus}:undefined,RenderFinished:{},AllDataSourcesProcessed:!1,PendingIcons:0,TopResultRendered:[],IconsRetrieved:{},ResponseFromCache:{}};this._keystrokesInstrumentationData[t]=s;this._keystrokesPerfPingData[t]=c},e.prototype.setSearchServiceStatus=function(n){this._searchServiceStatus=n},e.prototype.instrumentResponseReceived=function(n,i,r,u){var f=this;this.safeInstrumentPerf(n,function(n){var e=f.getOffsetedNow();n.ResponseReceived[i]=e;t&&f.logProfilerMarker(0,0,i,n);r&&(n.DataSourcesState=n.DataSourcesState||{},n.DataSourcesState[i]=r);u&&(n.ResponseFromCache[i]=1)},"instrumentResponseReceived",i)},e.prototype.instrumentTopResultRendered=function(n,t){var i=this;this.safeInstrumentPerf(n,function(r){var u=i.getOffsetedNow();i.logProfilerMarker(1,0,"topResultRendered",r);r.TopResultRendered.push({V:u,T:t.join(",")});i.tryInstrumentRenderStopped(n,r)},"instrumentTopResultRendered")},e.prototype.instrumentAggregatorCall=function(t,i){var r=this;this.safeInstrument(t,function(t){var e={fastRankModelId:r._clientInstrumentationProvider.getRankerModelId()},f,u;for(f in t.RankerExtraInfo)e[f]=t.RankerExtraInfo[f];t.RankerExtraInfo={};u={T:"D.Aggregator",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Aggregator",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:[],rankerModelIds:e};r._config.counterFactualLoggingOn&&(u.counterFactualDiff=u.counterFactualDiff||i.isCounterFactualDiff);t.DataSources.aggregator=u},"instrumentAggregatorCall")},e.prototype.addDuplicatesDataSource=function(t){var i=Object.keys(t.DuplicateDS).map(function(n){return t.DuplicateDS[n]});i.length>0&&(t.DataSources.duplicates={T:"D.Duplicates",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Duplicates",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:i})},e.prototype.instrumentDuplicate=function(t,i,r){this.safeInstrument(t,function(t){var u=t.DuplicateDS[i.instItem.getHValue()],f;u||(u={T:"D.Duplicate",DS:[{T:"D.DSRef",KRef:i.instItem.getKValue()}]},i.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(u.DS[0].AppNS=i.instItem.getAppNS()),t.DuplicateDS[i.instItem.getHValue()]=u);f={T:"D.DSRef",KRef:r.instItem.getKValue()};r.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(f.AppNS=r.instItem.getAppNS());u.DS.push(f);i.duplicates=i.duplicates||[];i.duplicates.push(r)},"instrumentDuplicate")},e.prototype.renderingStopped=function(n){return n.PendingIcons==0&&n.AllDataSourcesProcessed},e.prototype.notifyAllDataSourcesProcessed=function(n){var t=this;this.safeInstrumentPerf(n,function(i){i.AllDataSourcesProcessed=!0;t.tryInstrumentRenderStopped(n,i)},"notifyAllDataSourcesProcessed")},e.prototype.notifyIconPending=function(t,i,r,u){var f=this;this.safeInstrumentPerf(t,function(t){var e=r+(i?"T":"S");t.IconsRetrieved[e]||(t.IconsRetrieved[e]={B:f.getOffsetedNow(),E:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,T:u},t.PendingIcons++)},"notifyIconPending",i?"TR":"SUG")},e.prototype.notifyIconReady=function(n,t,i){var r=this;this.safeInstrumentPerf(n,function(n){var u=i+(t?"T":"S");n.IconsRetrieved[u]?n.IconsRetrieved[u].E=r.getOffsetedNow():SharedLogHelper.LogError("notifyIconReady",null,new Error("Instrumenting unseen icon"));n.PendingIcons--},"notifyIconReady",t?"TR":"SUG")},e.prototype.tryInstrumentRenderStopped=function(n,t){this.renderingStopped(t)&&(this.finalizeKeystrokeLog(n,2),this._config.th&&sj_evt.fire("RenderStopped"))},e.prototype.isLayoutLogged=function(n){return this._keystrokesInstrumentationData[n].MasterPageImpressionCreated},e.prototype.finalizeKeystrokeLog=function(n,t){var i,r;t===void 0&&(t=0);i=this._keystrokesInstrumentationData[n];i&&(this.logKeystrokeData(i,n),this._config.fixInstrumentationForClientSubmissions||t!=0||delete this._keystrokesInstrumentationData[n]);t!=1&&(r=this._keystrokesPerfPingData[n],r&&(this.logPerfPingEvent(this.createKeystrokePerfPingEvent(n,r)),delete this._keystrokesPerfPingData[n]))},e.prototype.instrumentSubmissionBegin=function(){this._perfPingSubmissionBeginTime==n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE&&(this._perfPingSubmissionBeginTime=this.getOffsetedNow())},e.prototype.instrumentRenderFinished=function(n,i){var r=this;this.safeInstrumentPerf(n,function(u){var f=r.getOffsetedNow();i.forEach(function(n){return u.RenderFinished[n]=f});t&&r.logProfilerMarker(0,0,"groupsRendered",u);r.tryInstrumentRenderStopped(n,u)},"instrumentRenderFinished",i.join(","))},e.prototype.instrumentSyntheticInstrumentedItem=function(n,t,i){var r=this._keystrokesInstrumentationData[n];r?r.PendingInstrumentedItems[t]=i:SharedLogHelper.LogError("instrumentSyntheticInstrumentedItem",t,new Error("keystrokesInstrumentationData not found"))},e.prototype.instrumentSyntheticSuggestion=function(n,t){var i=this._keystrokesInstrumentationData[n];i?i.PendingSyntheticSuggestions[t.type]=t:SharedLogHelper.LogError("instrumentSyntheticSuggestion",t.type,new Error("Instrumentation synthetic suggestion after flush"))},e.prototype.getInstrumentedSyntheticSuggestion=function(n,t){return this._keystrokesInstrumentationData[n].PendingSyntheticSuggestions[t]},e.prototype.instrumentDataSource=function(n,t,i,r){this.safeInstrument(n,function(n){var u,f,e;if(r&&r.rankerExtraInfo)for(u in r.rankerExtraInfo)n.RankerExtraInfo[u]=r.rankerExtraInfo[u];f=i||[];e=n.PendingDataSources[t];n.PendingDataSources[t]=e?e.concat(f):f},"instrumentDataSource",t)},e.prototype.processPendingDataSources=function(t){var r,o,u,f,e,s,h;for(r in t.PendingDataSources)if(o=t.PendingDataSources[r],o.length>0){for(u=[],f=this._dsNameMap[r],f||(f=i,SharedLogHelper.LogError("instrumentDataSource",r,new Error("Missing DS name mapping for dataSource"))),e=0,s=o;e<s.length;e++)h=s[e],u.push(this._clientInstrumentationProvider.createDataSourceObject(h));u.length>0&&(t.DataSources[r]={T:"D."+f,AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:f,SC:u.length,DS:u})}t.PendingDataSources={}},e.prototype.instrumentSnRProviderFetchUrl=function(n,t){this.safeInstrument(n,function(n){n.SnRProviderFetchUrl=t},"instrumentSnRProviderFetchUrl")},e.prototype.reset=function(n){this._perfPingConversationStartTimestamp=this.getNowTimestamp();this._searchServiceStatus=null;this.logInitializationPhase(n)},e.prototype.getConversationStartTimestamp=function(){return this._perfPingConversationStartTimestamp},e.prototype.logDataSourceTimeout=function(i,r){t&&n.log("timeout");this._clientInstrumentationProvider.logDataSourceTimeout(i,r)},e.prototype.logProfilerMarker=function(i,r,u,f,e){if(t&&r!=2){var o=this.getOffsetedNow();n.log(u+" "+(o-f.RequestBegin))}this._clientInstrumentationProvider.logProfilerMarker(i,r,u,f.ImpressionGuid,e)},e.prototype.createKeystrokePerfPingEvent=function(t,i){var u={I:t,PL:i.PrefixLength,K:i.RequestBegin,RRT:i.ResponseReceived,RFT:i.RenderFinished,TRR:i.TopResultRendered,RS:undefined,IRT:i.IconsRetrieved},r,f,e,o,s;if(this.renderingStopped(i)){for(r=0,f=0,e=u.TRR;f<e.length;f++)o=e[f],r=Math.max(r,o.V);for(s in u.RFT)r=Math.max(r,u.RFT[s]);r&&(u.RS=r)}return n.InstrumentationCommon.createPerfPingEvent(i.ImpressionGuid,[u],"Keystroke",i.ConversationId,i.DataSourcesState,i.ResponseFromCache)},e.prototype.updatePageIG=function(n){_G.IG=this.getImpressionGuid(n)},e.prototype.createMasterPageImpression=function(t,i,r,u,e,o){var c={dataSources:o||[],layoutNodes:[],pageName:t,rawQuery:u?u.queryToFetch:"",isQuery:!1,impressionUrl:this.createVirtualImpressionURL(i,r),appName:this._clientInstrumentationProvider.getApplicationName(),enrichedClientInfo:{FDPartnerEntry:f,nclid:_G.nclid,isOffline:n.isBrowserOnline()?0:1,webRequested:r?1:0}},s=this._clientInstrumentationProvider.getEnrichedClientInfo(u),h;if(s)for(h in s)c.enrichedClientInfo[h]=s[h];return c},e.prototype.logKeystrokeData=function(t,i){var u,f,e;(this.processPendingDataSources(t),this._config.th&&this.addDuplicatesDataSource(t),u=Object.keys(t.DataSources).map(function(n){return t.DataSources[n]}).concat(this.createNonSuggestionsDataSource(t.PendingInstrumentedItems,t.PendingSyntheticSuggestions)),t.DataSources={},t.PendingSyntheticSuggestions={},t.PendingInstrumentedItems={},u.length==0&&t.MasterPageImpressionCreated)||(t.RenderingStarted&&(f=DsLManager.CreateLayoutNode(_d.body,n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,!1,!0,t.MasterPageImpressionCreated)),t.MasterPageImpressionCreated?Log2.LogEvent("ClientInst",null,null,u,f,t.ImpressionGuid,null,null):(e=this.createMasterPageImpression(this._clientInstrumentationProvider.getSuggestionsPageName(),r,t.SnRProviderFetchUrl?t.SnRProviderFetchUrl.substring(t.SnRProviderFetchUrl.indexOf("?")+1):"",t.Query,i,u),f&&(e.layoutNodes=f),this.logMasterPageImpression(t.ImpressionGuid,e),t.MasterPageImpressionCreated=!0))},e.prototype.getSubmissionBeginTime=function(){return this._perfPingSubmissionBeginTime==n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE?this._perfPingSubmissionEndTime:this._perfPingSubmissionBeginTime},e.prototype.createSubmissionPerfPingEvent=function(t){var i=[{ISS:this.getSubmissionBeginTime(),ISE:this._perfPingSubmissionEndTime,ABT:this._perfPingConversationStartTimestamp}];return n.InstrumentationCommon.createPerfPingEvent(t.ImpressionGuid,i,"Submit",t.ConversationId)},e.prototype.logPerfPingEvent=function(t){Log2.LogEvent(t.EventType,t.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,t.ImpressionGuid,null,null);this._config.th&&ClientTestHooks.ClientApiLogNoConsole("perfPingEvent",[t])},e.prototype.logMasterPageImpression=function(n,t){if(t){if(!n){SharedLogHelper.LogError("logMasterPageImpression",null,new Error("Missing impressionGuid"));return}t.impressionGuid=n;this._clientInstrumentationProvider.logMasterPageImpression(t,this._host.getConversationId());this._config.th&&ClientTestHooks.ClientApiLogNoConsole("masterPageImpression",t,n)}},e.prototype.logInitializationPhase=function(t){var i=this._host.getConversationId(),o,f,e,c,l;if(i){o=this.getOffsetedNow();f=this.createMasterPageImpression(this._clientInstrumentationProvider.getInitPageName(),u,"",null,-1);t&&(f.enrichedClientInfo.isColdStart=1);this.logMasterPageImpression(i,f);e=-1;this._keystrokesInstrumentationData[e]={ImpressionGuid:i,ConversationId:i,Query:null,PendingDataSources:{},RankerExtraInfo:{},DataSources:{},DuplicateDS:{},Layout:[],MasterPageImpressionCreated:!0,RenderingStarted:!1,PendingInstrumentedItems:{},PendingSyntheticSuggestions:{}};this.updatePageIG(e);var s=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,h=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,r=_w.performance;r&&r.timing&&(s=this.calculateOffsetTimePoint(r.timing.responseStart),h=this.calculateOffsetTimePoint(r.timing.responseEnd));c=[{JS:o,FBR:s,LBR:h,ABT:this._perfPingConversationStartTimestamp}];l=n.InstrumentationCommon.createPerfPingEvent(i,c,"Init",i);this.logPerfPingEvent(l)}},e.prototype.calculateOffsetTimePoint=function(n){return n-this._perfPingConversationStartTimestamp},e.prototype.getOffsetedNow=function(){return this.calculateOffsetTimePoint(this.getNowTimestamp())},e.prototype.createNonSuggestionsDataSource=function(t,i){var r=[],u,f;for(u in t)r.push(this._clientInstrumentationProvider.createNonSuggestionDataSourceObject(u,t[u]));for(u in i)r.push(this._clientInstrumentationProvider.createDataSourceObject(i[u]));return r.length?(f={T:"D.ContentGroup",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"NonSuggestions",SC:r.length,DS:r},[f]):[]},e.prototype.createVirtualImpressionURL=function(t,i){var r=this.getOrigin()+t;return r+=i?i:n.Service.QueryParams.ConversationId+"="+n.encodeQueryParameter(this._host.getConversationId()),_G.ServerIG&&(r+="&ASInitIG="+n.encodeQueryParameter(_G.ServerIG)),r},e.prototype.instrumentBcsPopulationEvent=function(t,i){var u=this._host.getConversationId(),f=u,r=n.InstrumentationCommon.createPerfPingEvent(f,undefined,"BCSPopulation",u);r.Data.BCS_V=t;r.Data.EV=i;this.logPerfPingEvent(r)},e.prototype.instrumentDebugEvent=function(t){var i=this._host.getConversationId(),u=i,r=n.InstrumentationCommon.createPerfPingEvent(u,undefined,"Debug",i);r.Data.Message=t;this.logPerfPingEvent(r)},e}();n.InstrumentationHelper=e}(AutoSuggest||(AutoSuggest={})),function(n){var t="&nclid=",i="&ts=",r="&nclidts=",u="&tsms=",f="&elv=",e="&cc=",o="&setlang=",s="&cvid=",h="&qs=",c=function(){function c(t,i,r,u,f,e){f===void 0&&(f=Date.now);e===void 0&&(e=n.getWindowProtocol()+"//"+n.getWindowHost());this._config=t;this._host=i;this._instrumentationHelper=r;this._searchPreCacheHandler=u;this.getNowTimestamp=f;this._baseUrl=e}return c.prototype.getSearchUrl=function(t,i,r,u,e,o,s){var l=o?o:"search",h,c;return u||(u=(e?"/"+e:"")+"/"+l+"?q="+n.encodeQueryParameter(i)),h=this._baseUrl+u,h=this._instrumentationHelper.enrichTargetUrl(t,r,h,s||this._host.getFormCode()),o||(h=this.enrichUrlWithMuidInfo(h),c=this._host.getElToken(),c&&this._baseUrl.startsWith("https:")&&(h+=f+n.encodeQueryParameter(c)),this._searchPreCacheHandler&&(h=this._searchPreCacheHandler.attempPreCacheAndEnrichUrl(h))),this.enrichUrlWithMarketInfo(h)},c.prototype.enrichUrlWithMarketInfo=function(n){return this._config.forceMarketOnHandoff&&(n+=e+this._host.getRegion()+o+this._host.getLanguage()),n},c.prototype.enrichUrlWithMuidInfo=function(f){var e,o,s;return _G.nclid&&(f+=t+n.encodeQueryParameter(_G.nclid),e=this.getNowTimestamp().toString(),f+=i+n.encodeQueryParameter(e),o=e.substring(0,e.length-3),f+=r+n.encodeQueryParameter(o),s=e.substring(e.length-3),f+=u+n.encodeQueryParameter(s)),f},c.prototype.enrichUrlWithCvid=function(t){return t+(s+n.encodeQueryParameter(this._host.getConversationId()))},c.prototype.enrichUrlWithSuggestionType=function(t,i){return t+(h+n.encodeQueryParameter(i))},c}();n.NavigationHelper=c}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function n(n,t,i){var r=this;this._config=n;this._host=t;this._selectableItemsContainer=i;t.bindKeyDown(function(n,t,u){switch(n){case 38:r.selectNextItem(!0);break;case 40:r.selectNextItem(!1)}i.onAfterKeyDown(n,t,u)})}return n.prototype.selectNextItem=function(n){var i=this._selectableItemsContainer.getSelectableItems(),f;if(i.length!=0){var r=this._selectableItemsContainer.getSelectedItem(),t=r?i.indexOf(r):-1,u=n?t==0:t==i.length-1;(!u||this._config.allowKeyboardNavCycling)&&(u&&this._selectableItemsContainer.allowUnselectedState()||(t=n?t<=0?i.length-1:t-1:(t+1)%i.length,f=i[t]),this._selectableItemsContainer.select(f,!0))}},n}();n.KeyboardEvtHandler=t}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function t(n,t,i,r,u){this._config=n;this._host=t;this._instrumentationHelper=i;this._aggregator=r;this._rootViewModel=u;this._lastUsedId=-1;this._sequenceNumber=-1;this._suggestionsQueue={}}return t.prototype.initiateSequenceNumber=function(t,i){var s=this,u,f,r,e,o;if(this._sequenceNumber>=t){SharedLogHelper.LogError("initiateSequenceNumber",null,new Error("Unexpected sequence number"));return}for(this.resetStateForNewQuery(t,i),this._highPriorityDataSources=[],this._normalPriorityDataSources=[],this._lowPriorityDataSources=[],u=0,f=this._config.enabledDataSources;u<f.length;u++)r=f[u],e=i.enabledDataSources[r],e&&(this._config.lowPriorityDataSources[r]||e.forceLowPriority?this._lowPriorityDataSources.push(r):this._config.highPriorityDataSources[r]?this._highPriorityDataSources.push(r):this._normalPriorityDataSources.push(r));this._highPriorityDataSources.length==0&&this._normalPriorityDataSources.length==0&&this._lowPriorityDataSources.length==0?this.processSuggestions(!1):(o=this.getLatencyTimeout(),o>0&&(this._bufferingTimer=sb_st(function(){return n.safeExecute(function(){s._bufferingTimer=null;s.processSuggestions(!0)},"processSuggestionsBuffering")},o)))},t.prototype.getLatencyTimeout=function(){return this._partialQuery.queryToFetch?this._config.latencyTimeout:this._config.latencyTimeoutForZeroInput},t.prototype.queueSuggestions=function(t,i,r,u){if(t>this._sequenceNumber){SharedLogHelper.LogError("queueSuggestions",null,new Error("Unexpected sequence number"));return}if(!(t<this._sequenceNumber)){if(this._suggestionsQueue[i]){SharedLogHelper.LogError("queueSuggestions",i,new Error("Duplicate data source response"));return}if(!n.contains(this._highPriorityDataSources,i)&&!n.contains(this._normalPriorityDataSources,i)&&!n.contains(this._lowPriorityDataSources,i)){SharedLogHelper.LogError("queueSuggestions",i,new Error("Unexpected data source"));return}this._suggestionsQueue[i]={suggestions:r,updated:!1};u&&(this._extraSignalsMap[i]=u);this._arrivedDataSources.push(i);this._allDataSourcesArrived=this._arrivedDataSources.length==this._highPriorityDataSources.length+this._normalPriorityDataSources.length+this._lowPriorityDataSources.length;this._processingStopped||this._instrumentationHelper.isLayoutLogged(this._sequenceNumber)?this._allDataSourcesArrived&&this._instrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber):this.processSuggestions(!1)}},t.prototype.resetTimers=function(){this._bufferingTimer&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null)},t.prototype.resetStateForNewQuery=function(t,i){this._arrivedDataSources=[];this._sequenceNumber=t;this._partialQuery=i;this._suggestionsQueue={};this._extraSignalsMap={};this._isAnySuggestionRendered=!1;this._waitingForMoreResults=!0;this._processingStopped=!1;this._allDataSourcesArrived=n.isEmpty(i.enabledDataSources);this.resetTimers()},t.prototype.getDependencies=function(t){var i=this;return this._host.dataSourceDependencies(t).filter(function(t){return n.isDataSourceEnabled(t,i._partialQuery,i._config)})},t.prototype.haveAllDataSources=function(n){var t=this;return n.every(function(n){return!!t._suggestionsQueue[n]})},t.prototype.processSuggestions=function(t){var i=this,u=[],s=[],r,a=this.getLatencyTimeout()>0&&this._bufferingTimer==null,v=this.haveAllDataSources(this._normalPriorityDataSources),o=this.haveAllDataSources(this._highPriorityDataSources),y=o||a,h=o&&v,c,e,l,f;t&&this._instrumentationHelper.logDataSourceTimeout(Object.keys(this._suggestionsQueue),this._partialQuery);c=function(t,f){if(!t.updated&&i.getDependencies(f).every(function(t){return n.contains(i._arrivedDataSources,t)})){if(s.push(f),t.suggestions.length>0){var e=i.canHaveSuppressions(f)?t.suggestions.filter(function(n){return!i.isSuppressed(f,n,t.suggestions)}):t.suggestions;e.length>0&&(r||(r=i._isAnySuggestionRendered?i._rootViewModel.getSuggestions(!0):[]),u=u.concat(i.removeDuplicatesAndAssignIds(e,r,u,f)))}t.updated=!0}};e=function(n){var u,t,r;for(u in n)t=n[u],r=i._suggestionsQueue[t],r&&c(r,t)};y&&e(this._highPriorityDataSources);this._bufferingTimer&&h&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);l=this.getLatencyTimeout()>0?this._bufferingTimer==null:o;l&&(e(this._normalPriorityDataSources),e(this._lowPriorityDataSources));f=t&&!this._isAnySuggestionRendered;this._waitingForMoreResults&&h&&(this._waitingForMoreResults=!1,f=!0);this._partialQuery.showProgressBar&&this._allDataSourcesArrived&&(f=!0);(u.length>0||f)&&(r||(r=this._isAnySuggestionRendered?this._rootViewModel.getSuggestions(!0):[]),this.addSuggestions(r,u,s,f));this._allDataSourcesArrived&&this._instrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber)},t.prototype.getAggregatorResult=function(t,i,r){var f=this,o=n.isBrowserOnline()&&[n.WebDataSource].concat(this.getDependencies(n.WebDataSource)).some(function(t){return n.isDataSourceEnabled(t,f._partialQuery,f._config)&&!n.contains(f._arrivedDataSources,t)}),e=null,u;return this._config.counterFactualLoggingOn&&(e=this._aggregator.rank(i,r,this._extraSignalsMap,this._partialQuery,t,this._sequenceNumber,o,!0)),u=this._aggregator.rank(i,r,this._extraSignalsMap,this._partialQuery,t,this._sequenceNumber,o,!1),this._config.counterFactualLoggingOn&&(u.isCounterFactualDiff=!this.isSuggestionOrderTheSame(u.topResults,e.topResults)||!this.isSuggestionOrderTheSame(u.suggestionsToAdd,e.suggestionsToAdd)),u},t.prototype.isSuggestionOrderTheSame=function(n,t){var r=function(n){return n.query+"\t"+n.type},i;if(n.length!=t.length)return!1;for(i=0;i<n.length;i++)if(r(n[i])!=r(t[i]))return!1;return!0},t.prototype.addSuggestions=function(t,i,r,u){var e=this,c=this._isAnySuggestionRendered?this._rootViewModel.getCurrentTopResults():[],f=this.getAggregatorResult(c,t,i),o,s,l,h,a,v;for(this._instrumentationHelper.instrumentAggregatorCall(this._sequenceNumber,f),i=f.suggestionsToAdd,o=f.suggestionsToRemove,s=0,l=f.topResults;s<l.length;s++)h=l[s],n.contains(t,h)&&!n.contains(c,h)&&o.push(h);(u||i.length!=0||o.length!=0||!n.sequenceEqual(c,f.topResults))&&(a=!this._isAnySuggestionRendered,a&&(this._isAnySuggestionRendered=!0,this._instrumentationHelper.instrumentRenderingStarted(this._sequenceNumber),this._rootViewModel.setExtraSignalsMap(this._extraSignalsMap)),v=n.safeExecute(function(){return e._rootViewModel.update(a,f.topResults,e._waitingForMoreResults,e._sequenceNumber,i,o,r,f.groupOrder,e._allDataSourcesArrived)},"rootViewModel.update",0,null,function(){return e._host.reloadWebView(!0)}),v==0&&(this._processingStopped=!0,this.resetTimers()))},t.prototype.removeDuplicatesAndAssignIds=function(n,t,i,r){var u=this,s=function(n){n.id||(n.id="id_"+ ++u._lastUsedId)},o;if(this._aggregator.canHaveDuplicates(r)){var e=[],h=function(o){var h=n[o],c=t.findIndex(function(n){return u._aggregator.isDuplicate(u._partialQuery,n,h)});if(c>=0)return f._instrumentationHelper.instrumentDuplicate(f._sequenceNumber,t[c],h),"continue";if(c=i.findIndex(function(n){return u._aggregator.isDuplicate(u._partialQuery,n,h)}),c>=0)return f._instrumentationHelper.instrumentDuplicate(f._sequenceNumber,i[c],h),"continue";if(f._aggregator.canHaveDuplicatesWithinDataSource(r)&&(c=e.findIndex(function(n){return u._aggregator.isDuplicate(u._partialQuery,n,h)}),c>=0))return f._instrumentationHelper.instrumentDuplicate(f._sequenceNumber,e[c],h),"continue";s(h);e.push(h)},f=this;for(o=0;o<n.length;++o)h(o);return e}return n.forEach(function(n){return s(n)}),n},t.prototype.canHaveSuppressions=function(n){return this._config.suppressDataSources[n]||this._config.dataSourcesWithSuppressedTypes[n]},t.prototype.isSuppressed=function(n,t){return this._config.suppressDataSources[n]||this._config.suppressTypes[t.type]},t}();n.SuggestionsRenderingManager=t}(AutoSuggest||(AutoSuggest={})),function(n){function f(n){var t,i;if(n.length==0)return 0;for(t=0,i=0;i<n.length;i++)t=(t<<5)-t+n.charCodeAt(i)|0;return t}function t(n,t){var u,i,r;if(n.length===0)return t.length;if(t.length===0)return n.length;for(u=[],i=0;i<=t.length;i++)u[i]=[i];for(r=0;r<=n.length;r++)u[0][r]=r;for(i=1;i<=t.length;i++)for(r=1;r<=n.length;r++)u[i][r]=t.charAt(i-1)==n.charAt(r-1)?u[i-1][r-1]:Math.min(u[i-1][r-1]+1,Math.min(u[i][r-1]+1,u[i-1][r]+1));return u[t.length][n.length]}function s(n,i){return n&&(n=n.toLowerCase()),i&&(i=i.toLowerCase()),t(n,i)}function o(n,t,i){var r=0,u;return(t>0||i>0)&&(t>0&&i>0?(i>t&&(u=t,t=i,i=u),r=n/(t-n+i)):r=Number.MAX_VALUE),r}function h(n,t){return!n||!t?0:n.length+1<=t.length&&t[n.length]==" "?1:n.length==t.length?1:0}function c(n){var r=0,i=1,t;if(n&&n.length>1)for(t=1;t<n.length;t++)n.charAt(t)==n.charAt(t-1)?i++:i=1,i>r&&(r=i);else if(n)return 1;return r}function l(n){return n&&n.length>0?n.trim().split(" ").length:0}function a(n){var t=new RegExp("^[0-9a-zA-Z ]+$");return n&&t.test(n)?1:0}function v(n){return n&&n.length>0&&n.charAt(n.length-1)==" "?1:0}function y(n){return n&&n.length>0&&(n.includes("http://")||n.includes("https://")||n.includes("."))?1:0}function p(t,i,r,u){var e,o,s;t.includes("?")&&(r[117]=1,k(t)&&(r[127]=1));t.replace("///","").replace("//","").includes("/")&&(r[118]=1);t.includes(".")&&(r[119]=1);e=u.cvid+u.privacyNumber+t;r[120]=f(e);(t.startsWith("www.")||t.startsWith("http://www.")||t.startsWith("https://www."))&&(r[122]=1);t.startsWith("www.")||t.startsWith("http://")?r[123]=1:t.startsWith("https://")?r[124]=1:t.startsWith("ftp://")?r[125]=1:r[126]=1;i&&(o=n.normalizeUrl(t,15),s=n.normalizeUrl(i,15),o.startsWith(s)&&(r[187]=1))}function w(n,i,r,u,e){if(e){r[128]=t(e,i);r[129]=e.length;var o=u.cvid+u.privacyNumber+e;r[130]=f(o)}}function b(n,i,r){var e=n.toLocaleLowerCase(),s,u,f,h,c;if(r[140]=n.length,s=e.split(" "),r[144]=s.length,i)for(r[141]=t(n,i),r[142]=Math.min(100,o(r[141],i.length,n.length)),u=i.toLocaleLowerCase(),e.includes(u)&&(r[143]=1),e.startsWith(u)&&(r[188]=1),f=0,h=s;f<h.length;f++)if(c=h[f],c==u){r[145]=1;break}}function k(n){return ct.some(function(t){return n.startsWith(t)})}function d(n){var i=0,r,t;if(n)for(r in n)t=n[r],t&&t.prefixLaunchCount&&(i+=t.prefixLaunchCount);return i}function g(n,t,i,r,u){if(r){var f=r[t];f&&(i[47]=f.prefixLaunchCount,i[49]=f.lastLaunchTime,i[101]=u,u>0&&(i[100]=f.prefixLaunchCount/u))}}function nt(n,t,r,u,f,e,o){if(r){var h=i(f,u),s=r[h];s&&(e?(t[153]=s.ProbSugClickGivenPref,t[152]=s.ClicksOnSugGivenPref):o?(t[161]=s.Loglikelihood,t[162]=s.ProbSugClickGivenBackground,t[163]=s.ClicksOnSugGivenPref,t[164]=s.ProbSugClickGivenPref,t[165]=s.CCR,t[166]=s.EventCount,t[167]=s.ProbSugClickGivenTime,t[168]=s.CCRTime):(t[6]=s.Loglikelihood,t[3]=s.ProbSugClickGivenBackground,t[151]=s.ClicksOnSugGivenPref,t[0]=s.ProbSugClickGivenPref,t[94]=s.CCR,t[95]=s.EventCount,t[154]=s.ProbSugClickGivenTime,t[155]=s.CCRTime))}}function tt(n,t,i){if(t){var r=t[i];r&&(n[256]=r.PSGPCR,n[257]=r.PSGCCR,n[258]=r.PSGSTR)}}function i(n,t){return(n+"\t"+t).toLowerCase()}function r(t,i,r,u){i=="100"&&(i=n.GroupType.SearchSuggestions.toString());r==11..toString()&&r==0..toString();switch(t.athenaKeyType){case 0:return i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group is empty")),i;case 1:return i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group is empty")),r||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),i+"_"+r;case 2:return r||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),r;case 3:return u||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key suggestion type is empty")),r||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),u+"_"+r;default:return SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group type is not set")),""}}function u(n,t,i,r){switch(n.athenaKeyType){case 0:return i==t;case 1:return i==t&&r==t;case 2:return r==t;case 3:return r==t;default:return!1}}function it(n,t){var i={};return n?(t.athenaKeyType==3?ft(t,n,i):(rt(t,n,i),ut(t,n,i)),i):i}function rt(n,t,f){var a=t.Suggestions?t.Suggestions.split("\t"):[],v=t.ProbSugClickGivenPrefs?t.ProbSugClickGivenPrefs.split("\t"):[],y=t.ClicksOnSugGivenPrefs?t.ClicksOnSugGivenPrefs.split("\t"):[],p=t.ProbSugClickGivenBackground?t.ProbSugClickGivenBackground.split("\t"):[],w=t.Loglikelihoods?t.Loglikelihoods.split("\t"):[],l=t.SuggestionGroups?t.SuggestionGroups.split("\t"):[],b=t.ProbSugClickGivenPrefWeeks?t.ProbSugClickGivenPrefWeeks.split("\t"):[],k=t.ProbSugClickGivenPrefWeekends?t.ProbSugClickGivenPrefWeekends.split("\t"):[],c=n.athenaKeyType==0||!t.SuggestionHandOffTypes?[]:t.SuggestionHandOffTypes.split("\t"),s=a.length,d=e(),o;if(u(n,s,l.length,c.length))for(o=0;o<s;o++){var g=l&&l.length>o?l[o]:"",nt=c&&c.length>o?c[o]:"",tt=r(n,g,nt,""),h=i(a[o],tt);f[h]={SuggestionGroup:+l[o]};p.length==s&&(f[h].ProbSugClickGivenBackground=Number(p[o]));v.length==s&&(f[h].ProbSugClickGivenPref=Number(v[o]));y.length==s&&(f[h].ClicksOnSugGivenPref=Number(y[o]));w.length==s&&(f[h].Loglikelihood=Number(w[o]));n.athenaKeyType!=0&&c.length==s&&(f[h].SuggestionHandOffType=Number(c[o]));f[h].ProbSugClickGivenTime=b.length!=s||d?k.length==s&&d?Number(k[o]):f[h].ProbSugClickGivenPref:Number(b[o])}else SharedLogHelper.LogError("parseLLSignals",null,new Error("Length doesn't match"))}function ut(n,t,f){var a=t.CCRSuggestions?t.CCRSuggestions.split("\t"):[],l=t.CCRSuggestionGroups?t.CCRSuggestionGroups.split("\t"):[],v=t.CCRs?t.CCRs.split("\t"):[],y=t.EventCounts?t.EventCounts.split("\t"):[],c=n.athenaKeyType==0||!t.CCRSuggestionHandOffTypes?[]:t.CCRSuggestionHandOffTypes.split("\t"),p=t.CCRsWeek?t.CCRsWeek.split("\t"):[],w=t.CCRsWeekend?t.CCRsWeekend.split("\t"):[],s=a.length,b=e(),o;if(u(n,s,l.length,c.length))for(o=0;o<s;o++){var k=l&&l.length>o?l[o]:"",d=c&&c.length>o?c[o]:"",g=r(n,k,d,""),h=i(a[o],g);f[h]||(f[h]={SuggestionGroup:Number(l[o])});v.length==s&&(f[h].CCR=Number(v[o]));y.length==s&&(f[h].EventCount=Number(y[o]));n.athenaKeyType!=0&&c.length==s&&(f[h].CCRSuggestionHandOffType=Number(c[o]));f[h].CCRTime=p.length!=s||b?w.length==s&&b?Number(w[o]):f[h].CCR:Number(p[o])}else SharedLogHelper.LogError("parseCCRSignals",null,new Error("Length doesn't match"))}function ft(n,t,i){var s=t.SugTypes?t.SugTypes.split("\t"):[],h=t.HandOffTypes?t.HandOffTypes.split("\t"):[],c=t.PSGPCRs?t.PSGPCRs.split("\t"):[],l=t.PSGCCRs?t.PSGCCRs.split("\t"):[],a=t.PSGSTRs?t.PSGSTRs.split("\t"):[],e=s.length,f;if(u(n,e,0,h.length))for(f=0;f<e;f++){var v=s[f],y=h[f],o=r(n,"",y,v);i[o]={};c.length==e&&(i[o].PSGPCR=Number(c[f]));l.length==e&&(i[o].PSGCCR=Number(l[f]));a.length==e&&(i[o].PSGSTR=Number(a[f]))}else SharedLogHelper.LogError("parseGroupEngagementSignals",null,new Error("Length doesn't match"))}function e(n){var t=n?n.getDay():(new Date).getDay();return t==6||t==0}function et(n){switch(n){case 0:case 3:case 5:case 12:case 17:case 18:case 22:case 23:case 24:case 26:case 28:case 40:case 56:case 57:case 91:case 94:case 97:case 99:case 100:case 103:case 135:case 142:case 153:case 154:case 162:case 164:case 165:case 167:case 168:case 169:case 170:case 171:case 172:case 173:case 174:case 175:case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:case 184:case 185:case 186:case 190:case 192:case 194:case 196:case 198:case 200:case 202:case 204:case 206:case 207:case 209:case 210:case 212:case 213:case 215:case 216:case 218:case 219:case 221:case 222:case 224:case 225:case 227:case 228:case 233:case 234:case 236:case 237:case 239:case 240:case 242:case 243:case 245:case 247:case 249:case 251:case 255:case 256:case 257:case 258:case 260:case 261:return!0;case 1:case 2:case 4:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 19:case 20:case 21:case 25:case 27:case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 37:case 38:case 39:case 40:case 42:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 59:case 60:case 61:case 63:case 64:case 65:case 70:case 82:case 83:case 85:case 86:case 87:case 88:case 89:case 90:case 92:case 93:case 95:case 96:case 98:case 101:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:case 128:case 129:case 130:case 131:case 132:case 133:case 134:case 136:case 137:case 138:case 139:case 140:case 141:case 143:case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:case 152:case 155:case 156:case 157:case 158:case 159:case 160:case 161:case 163:case 166:case 187:case 188:case 189:case 191:case 193:case 195:case 197:case 199:case 201:case 203:case 205:case 208:case 211:case 214:case 217:case 220:case 223:case 226:case 229:case 235:case 238:case 241:case 244:case 246:case 248:case 250:case 252:case 253:case 254:case 1e3:case 1001:case 1002:case 1004:case 1005:case 1006:case 1007:case 1008:case 1009:case 1010:case 1011:case 1012:return!1;default:throw new Error("Please configure if your new feature is a rate or not");}}function ot(n){var r,t,i;for(r in n)t=parseInt(r),i=n[t],n[t]=et(t)?Math.round(100*i):Math.round(i)}function st(n){var i=Object.keys(n);for(var t in i)n[t]||delete n[t]}function ht(n,t){n.featureStore||(n.featureStore={});n.featureStore[t]=1}n.stringHashCode=f;n.getEditDistance=t;n.getEditDistanceIgnoreCase=s;n.computeEditDistanceRatio=o;n.isWordBoundary=h;n.countMaxContiguousRepeatedChars=c;n.getNumberOfWords=l;n.containsOnlyDigitsLettersOrSpaces=a;n.endsWithSpace=v;n.prefixIsLikeUrl=y;n.computeUrlFeatures=p;n.computeDomainFeatures=w;n.computeTitleFeatures=b;n.getSumMruLaunches=d;n.setMRUSignal=g;n.setEngagementSignals=nt;n.setSuggestionGroupEngagementSignals=tt;n.getEngagementSignalKey=i;n.getAthenaGroupKey=r;n.checkAthenaGroupLength=u;n.parseWebEngagementSignals=it;n.isWeekend=e;n.convertFeaturesToCRank=ot;n.removeUndefinedAndZeroValues=st;n.setFlagInFeatureStore=ht;var ct=["http://www.bing.","www.bing.","https://www.bing.","http://cn.bing.","cn.bing.","https://cn.bing.","http://www.google.","www.google.","https://www.google.","http://www.yandex.","www.yandex.","https://www.yandex.","http://www.baidu.","www.baidu.","https://www.baidu.","http://www.yahoo.","www.yahoo.","https://www.yahoo."]}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(i){i.suggestionRankingModels={};var r=function(){function r(n,t){this._config=n;this._previewPane=t}return r.prototype.rank=function(n,i,r,u,f,e,o,s){var h,c,l;return n.scope==t.Scope.PathCompletion?this.rankPathCompletion(i):(h=n.scope==t.Scope.All?{sumMruLaunches:0,unknownRatio:0,mruGroupLaunches:null}:null,this.orderSuggestions(n,i,r,u,f,e,o,s,h),c=this.getTopHitCandidates(n,i),l=this.createMulticlassClassifierTopHitSuggestionList(c),this.createRankerResponse(l,h))},r.prototype.rankPathCompletion=function(n){var i=n.find(function(n){return n.type==t.LocalSuggestionTypes.CommandLine})||n[0];return{topResults:i?[i]:[],mruSuppressions:null}},r.prototype.orderSuggestions=function(t,r,u,f,e,o,s,h,c){var w=this,y=n.safeExecute(function(){return w.createFeatureStore(t,r,u,f,e,o,s,c)},"createFeatureStore"),a,l,p,v;if(y=y||r.map(function(){return{}}),l=h?this._config.counterFactualRankerId:this._config.mainRankerId,l?(a=n.safeExecute(function(){return i.suggestionRankingModels[l]},"getRanker"),a||SharedLogHelper.LogError("getRanker",l,new Error("Model not found"))):SharedLogHelper.LogError("getRanker",l,new Error(h?"CounterFactualRankerId not defined ":"MainRankerId not defined")),a)for(p=function(t){var i=y[t],u=n.safeExecute(function(){return a(i)},"calculateRankingScore");r[t].rankingScore=u;r[t].featureStore=i},v=0;v<r.length;v++)p(v);r.sort(function(n,t){return t.rankingScore-n.rankingScore})},r.prototype.getTopHitCandidates=function(n,t){var i=this,r=this.isNonHcWebAllowedToTopHit(n,t);return t.filter(function(u){return i.allowInTopHit(n,u,t.length==1,r)})},r.prototype.allowInTopHit=function(i,r,u,f){if(t.isL2(i)&&t.isPhotoOrVideo(r.type)&&!this._config.topHitAllowedForPhotosAndVideosL2||r.answerHtml&&this._previewPane&&this._previewPane.getPreviewedSuggestion())return!1;switch(r.type){case t.OnlineSuggestionTypes.Local:return!1;case t.SyntheticQSCodes.SearchBingImages:case t.SyntheticQSCodes.SearchBingVideos:return u&&this._config.topHitAllowedForPhotosAndVideosL2;case t.SyntheticQSCodes.SearchTheStore:return u}if(t.isMobileCache)switch(r.handoffType){case 2:case 3:return!1;case 1:if(!i.queryToFetch.includes("."))return!1}var e=t.getGroupType(r,this._config);switch(e){case n.GroupType.SearchSuggestions:case n.GroupType.Websites:return r.type==t.SyntheticQSCodes.SearchTheWeb||r.type==t.SyntheticQSCodes.Protocol||r.hc||f;case n.GroupType.Store:case n.GroupType.PowerBi:return r.hc;case n.GroupType.Command:return r.hc||u}return t.uses3lineTemplate(e)?!1:r.handoffType==8&&!this._config.substrateDocumentsEnabled&&!this._config.substratePeopleEnabled?!1:!0},r.prototype.createMulticlassClassifierTopHitSuggestionList=function(n){for(var i=[],r=-1,t=0;t<Math.min(n.length,this._config.maxNumberOfTopResults);t++)n[t].rankingScore!==undefined&&n[t].rankingScore>.5&&(r=t);return r>-1?i=n.slice(0,r+1):n.length>0&&i.push(n[0]),i},r.prototype.createRankerResponse=function(n,t){var i=!1;return n=n.filter(function(n){if(n.handoffType==0&&!n.isAnswer){if(i)return!1;i=!0}return!0}),{topResults:n,mruSuppressions:t}},r.prototype.createFeatureStore=function(i,r,u,f,e,o,s,h){var ut=[],k=0,ft=0,d=0,lt=i.queryToFetch.toLowerCase(),g=n.getSumMruLaunches(f),at=function(n,t,i){n[t]=n[t]?n[t]+i:i},nt=0,tt={},et,a,y,ot,w,it,v,p,b,rt,c,l,st,ht,ct;if(f){for(et in f)(a=f[et],a&&a.prefixLaunchCount)&&(y=a.groupType,y||y===0?(ot=t.isTopHitChildGroup(y)?n.GroupType.Apps:y,at(tt,ot,a.prefixLaunchCount)):nt+=a.prefixLaunchCount);this.setMRUSuppressionSignals(g,tt,nt,h)}for(w=0,it=r;w<it.length;w++)v=it[w],v.handoffType==2&&(p=t.getAppItem(v),p&&(ft+=p.totalLaunches,p.totalLaunches>k&&(k=p.totalLaunches)),v.deviceItem&&v.deviceItem.rankScore>d&&(d=v.deviceItem.rankScore));for(b=0,rt=r;b<rt.length;b++)c=rt[b],l=this.getSuggestionFeatureStore(lt,c,e,u,ft,s),l[148]=i.scope,l[13]=k,l[7]=d,l[60]=t.isMobileCache?1:0,l[93]=u&&u.WebSignalsAvailable?1:0,st=t.getSuggestionKey(c),n.setMRUSignal(c,st,l,f,g),this.setMRUGroupLaunchRatios(l,g,tt,nt),c.handoffType==1&&c.query&&(n.computeUrlFeatures(c.query,i.queryToFetch,l,o,!c.mayContainPII),ht=n.getDomain(c.query),n.computeDomainFeatures(c,i.queryToFetch,l,o,ht,this._config,e)),c.query&&t.isFileOrFolder(c.type)&&(ct=o.cvid+o.privacyNumber+c.query,l[131]=n.stringHashCode(ct)),n.removeUndefinedAndZeroValues(l),ut.push(l);return ut},r.prototype.isNonHcWebAllowedToTopHit=function(i,r){var f=this,u;return t.isMobileCache?!1:this._config.allowAnyNonHcWebToTopHit?!0:(u=r.every(function(i){return t.getGroupType(i,f._config)==n.GroupType.SearchSuggestions&&i.handoffType!=1}),!u)?!1:!this._config.topHitNonHcWebBasedOnClassifierScore&&!this._config.topHitNonHcWebSugQueryDistThreshold?!0:r.length>0&&this._config.topHitNonHcWebSugQueryDistThreshold&&r[0].query&&Math.abs(r[0].query.length-i.queryToFetch.length)<this._config.topHitNonHcWebSugQueryDistThreshold?!0:this._config.topHitNonHcWebBasedOnClassifierScore&&r.every(function(n){return n.rankingScore>=.5})?!0:!1},r.prototype.setMRUSuppressionSignals=function(n,t,i,r){n&&r&&(r.sumMruLaunches=n,r.mruGroupLaunches=t,r.unknownRatio=i/n)},r.prototype.setMRUGroupLaunchRatios=function(t,i,r,u){var e,f;if(i){t[186]=u/i;for(e in r){f=r[e]/i;switch(Number(e)){case n.GroupType.Apps:t[169]=f;break;case n.GroupType.Settings:t[170]=f;break;case n.GroupType.Cortana:t[171]=f;break;case n.GroupType.Command:t[172]=f;break;case n.GroupType.Photos:t[173]=f;break;case n.GroupType.Videos:t[174]=f;break;case n.GroupType.Music:t[175]=f;break;case n.GroupType.Documents:t[176]=f;break;case n.GroupType.Folders:t[177]=f;break;case n.GroupType.Emails:t[178]=f;break;case n.GroupType.Store:t[179]=f;break;case n.GroupType.SearchSuggestions:t[180]=f;break;case n.GroupType.PathCompletion:t[181]=f;break;case n.GroupType.PowerBi:t[182]=f;break;case n.GroupType.Calendar:t[183]=f;break;case n.GroupType.People:t[184]=f;break;case n.GroupType.EdgeHistory:t[185]=f;break;case n.GroupType.Bookmarks:t[260]=f;break;case n.GroupType.LocalPlaces:t[261]=f}}}},r.prototype.getRank=function(n){if(n.type==t.LocalSuggestionTypes.BrowsingHistory)return undefined;if(n.deviceItem&&typeof n.deviceItem.rankScore!="undefined")return n.deviceItem.rankScore;var i=t.asJumpListSuggestion(n),r=i?i.jumpListItem.usagePoints:undefined;return typeof r!="undefined"?r:undefined},r.prototype.getSuggestionFeatureStore=function(i,r,u,f,e,o){var s={},h,w,c,b,l,a,p,v,y,k;return this.setTypeSignal(r,s),h=t.getAppItem(r),h?(s[2]=h.totalLaunches,e>0&&(s[103]=h.totalLaunches/e),s[92]=h.launchArguments?1:0,this.addLastAccessDate(h.lastAccessed,s)):(w=t.asJumpListSuggestion(r),this.addLastAccessDate(w?w.jumpListItem.lastAccessed:null,s)),c=t.getBrowsingHistoryItem(r),c&&(c.visitCount&&(s[138]=c.visitCount),this.addLastAccessDate(c.dateVisited,s)),s[96]=r.catalogScore,s[97]=r.avgRating,s[98]=r.ratingCount,s[99]=r.confidence,s[150]=r.source,r.hc&&(s[189]=1),s[17]=r.highConfidenceMetaSuggestionScore,b=this.getRank(r),typeof b!="undefined"?s[16]=b:s[4]=1,r.matchedOnlyOnContent&&(s[259]=1),s[23]=r.prefetchConfidenceScore,this.setThresholdRatios(s,f),this.setRatios(s,f),l=t.getGroupType(r,this._config),a=r.query,r.type==t.SyntheticQSCodes.SearchTheWeb&&(a="SearchTheWeb"),p=n.getAthenaGroupKey(this._config,String(l),String(r.handoffType),r.type),n.setEngagementSignals(r,s,u,p,a,!1,!1),n.setEngagementSignals(r,s,o,p,a,!1,!0),o&&!u&&n.setEngagementSignals(r,s,o,p,a,!1,!1),s[10]=i.length,(r.isAnswer||l==n.GroupType.Cortana)&&(s[11]=1),s[65]=!r.query||r.mayContainPII?1:0,s[132]=r.query&&(!r.mayContainPII||t.isFileOrFolder(r.type))?0:1,s[20]=r.query&&r.query.toLowerCase()==i&&!r.mayContainPII?1:0,s[133]=r.query&&r.query.toLowerCase()==i&&(!r.mayContainPII||t.isFileOrFolder(r.type))?1:0,r.handoffType==2?(s[8]=1,t.isSetting(r.type)&&(s[64]=1),t.isApp(r.type)&&(s[83]=1)):s[8]=0,l==n.GroupType.SearchSuggestions&&(r.type!=t.SyntheticQSCodes.SearchTheWeb&&(s[82]=1),s[25]=1),v=s[65]==1,s[14]=v?0:n.getEditDistanceIgnoreCase(i,r.query),s[22]=v?0:Math.min(100,n.computeEditDistanceRatio(s[14],i.length,r.query.length)),s[70]=v?0:n.isWordBoundary(i,r.query),s[15]=v?i.length:r.query.length,y=s[132]==1,s[134]=y?0:n.getEditDistanceIgnoreCase(i,r.query),s[135]=y?0:Math.min(100,n.computeEditDistanceRatio(s[134],i.length,r.query.length)),s[136]=y?0:n.isWordBoundary(i,r.query),s[137]=y?i.length:r.query.length,s[8]==1&&(s[27]=s[20]),(r.isAnswer||l==n.GroupType.Cortana)&&(s[55]=s[20]),(r.type==t.OnlineSuggestionTypes.SearchHistory||r.fromHistory)&&(s[121]=1),s[41]=s[83]==1?s[40]:s[64]==1?s[39]:s[11]==1?s[32]:s[89]==1?s[54]:s[85]==1?s[30]:s[86]==1?s[53]:s[87]==1?s[52]:s[61]==1?s[31]:s[88]==1?s[51]:s[63]==1?s[35]:s[82]==1?s[29]:s[90]==1?s[50]:s[59]==1?s[34]:s[37],(t.isSetting(r.type)||t.isApp(r.type))&&(k=this.parseConstraintIndexMetaData(r.deviceItem),this.computeConstraintIndexFeatures(r.deviceItem,s,k),r.ciMatchedQuery=this.getConstraintIndexMatchedQuery(k)),r.signals&&(s[230]=r.signals.DistanceToEntity,s[231]=r.signals.DistanceToEntityPrecision,s[232]=r.signals.RankingScore),s},r.prototype.addLastAccessDate=function(t,i){var r=n.getTimeDiffInDays(t);r!=null?i[9]=r:i[19]=1},r.prototype.setTypeSignal=function(n,i){switch(n.type){case t.LocalSuggestionTypes.StartMenuDocument:case t.LocalSuggestionTypes.Document:i[61]=1;break;case t.LocalSuggestionTypes.Photo:i[85]=1;break;case t.LocalSuggestionTypes.Video:i[86]=1;break;case t.LocalSuggestionTypes.Music:i[87]=1;break;case t.LocalSuggestionTypes.Folder:i[88]=1;break;case t.LocalSuggestionTypes.CommandLine:i[89]=1;break;case t.LocalSuggestionTypes.PathCompletion:i[90]=1;break;case t.LocalSuggestionTypes.App:i[1]=1;break;case t.OnlineSuggestionTypes.Deeplink:case t.OnlineSuggestionTypes.DirectNav:i[21]=1;break;case t.OnlineSuggestionTypes.Store:i[63]=1;break;case t.SyntheticQSCodes.SearchTheWeb:i[59]=1}},r.prototype.setRatios=function(n,t){t&&t.AppsRatio!==undefined&&(n[26]=t.AppsRatio,t.SettingsRatio&&(n[5]=t.SettingsRatio),t.StoreRatio&&(n[57]=t.StoreRatio),t.PrefixProbability&&(n[12]=t.PrefixProbability),t.FilesRatio&&(n[24]=t.FilesRatio),t.WebRatio&&(n[18]=t.WebRatio),t.PhotosVideosMusicRatio&&(n[28]=t.PhotosVideosMusicRatio),t.ContactsRatio&&(n[56]=t.ContactsRatio),t.LocalProtocolRatio&&(n[91]=t.LocalProtocolRatio))},r.prototype.setThresholdRatios=function(n,t){t&&t.ThApps!==undefined?(n[40]=t.ThApps,t.ThStore&&(n[35]=t.ThStore),t.ThSetting&&(n[39]=t.ThSetting),t.ThCortAns&&(n[32]=t.ThCortAns),t.ThPrefixCount&&(n[38]=t.ThPrefixCount),t.ThWeb&&(n[29]=t.ThWeb),t.ThSearchTheWeb&&(n[34]=t.ThSearchTheWeb),t.ThOther&&(n[37]=t.ThOther),t.ThSearchMyStuff&&(n[36]=t.ThSearchMyStuff),t.ThFile&&(n[31]=t.ThFile),t.ThFolder&&(n[51]=t.ThFolder),t.ThPath&&(n[50]=t.ThPath),t.ThEmail&&(n[33]=t.ThEmail),t.ThCommAns&&(n[54]=t.ThCommAns),t.ThPhotoAns&&(n[30]=t.ThPhotoAns),t.ThVideoAns&&(n[53]=t.ThVideoAns),t.ThMusicAns&&(n[52]=t.ThMusicAns),t.ThDNav&&(n[147]=t.ThDNav)):n[42]=1},r.prototype.computeConstraintIndexFeatures=function(n,t,i){if(n&&n.rawIndexResponse){if(!i)return;t[157]=i.GrammarScore;t[158]=i.MatchScore;i.Parses&&i.Parses.length>0&&i.Parses[0].Entities&&i.Parses[0].Entities.length>0&&(t[159]=i.Parses[0].Entities[0].EntityScore)}},r.prototype.parseConstraintIndexMetaData=function(t){return t&&t.rawIndexResponse?n.safeExecute(function(){return JSON.parse(t.rawIndexResponse)},"parseConstraintIndexMetaData"):undefined},r.prototype.getConstraintIndexMatchedQuery=function(n){return!n||n.GrammarScore==0?null:n.Query},r}();i.FastRankRanker=r})(i=t.Ranking||(t.Ranking={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var r=/[+.\\*?\[\]()]/g,u={".":"\\.","+":"\\+","*":"\\*","\\":"\\\\","?":"\\?","[":"\\[","]":"\\]","(":"\\(",")":"\\)"},f=/^(?:https?:\/\/)?(.*)/,e=/^(?:(?:https?:\/\/(?:www\.)?)|(?:www\.))(.*)/,i=/^\s+/,o=function(){function o(t,i){var r=this;this._config=t;this._host=i;i.bindKeyDown(function(t){n.isUpOrDownKey(t)&&(r._autoCompletedQuery=null,r._fullAutoCompletedQuery=null)});i.bindQueryChangedOrInitialized(function(n){r._currentQuery=n;r._fullAutoCompletedQuery&&!r._fullAutoCompletedQuery.startsWith(n.originalQuery)&&(r._fullAutoCompletedQuery=null,r._autoCompletedQuery=null)})}return o.prototype.apply=function(n){var u,o,r;if((n.query||this._currentQuery.queryToFetch)!=this._autoCompletedQuery){if(u=this._currentQuery.originalQuery,n.query&&n.type!=t.LocalSuggestionTypes.BrowsingHistory&&this._currentQuery.originalCursorPosition===u.length){var s=this._currentQuery.scopePrefix?this._currentQuery.scopePrefix.length+1:0,e=u.substr(s).replace(i,"").toLowerCase(),h=this._fullAutoCompletedQuery?this._fullAutoCompletedQuery.substr(s).replace(i,"").toLowerCase():u,f=n.query.toLowerCase();if(h!==f&&(o=1,r=this.fullAutoCompleteOffset(f,e),r<0&&(this._config.allowInfixGhosting||n.url)&&(r=this.infixAutoCompleteOffset(f,e),o=2),r<0&&(r=this.directNavAutoCompleteOffset(f,e)),r>=0)){this.setAutoCompletedQuery(u,n.query,r);n.autoCompleteType=o;return}}this._autoCompletedQuery&&this.setAutoCompletedQuery(u,"",0)}},o.prototype.fullAutoCompleteOffset=function(n,t){var i=n.startsWith(t);return i?t.length:-1},o.prototype.infixAutoCompleteOffset=function(n,t){var i=n.search("[ .:,\\\\/+_&-]"+t.replace(r,function(n){return u[n]})),e,o;return i>0&&(e=n.substring(0,i+1).match(f)[1],o=e?e.match(/[ .:,\\/+_&-]+/g).length+1:1,o<3)?i+1+t.length:-1},o.prototype.directNavAutoCompleteOffset=function(n,t){var i=t.match(e),r;return i&&(r=i[1],r.length>0&&n.startsWith(i[1]))?r.length:-1},o.prototype.setAutoCompletedQuery=function(n,t,i){var r=n+t.slice(i);this._host.setAutoCompleteQueryText(r);this._autoCompletedQuery=t;this._fullAutoCompletedQuery=r},o}();t.WindowsAutoComplete=o})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(i){function v(){return r?r:(SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getFolderPathFromKnownFolderIdGuid&&(r=n.safeExecute(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getFolderPathFromKnownFolderIdGuid(a)},"FOLDERID_SkyDrive"),r&&(r+="\\",r=r.toLocaleLowerCase())),r||(r="\\onedrive\\"),r)}function y(){if(u)return u;var t;return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getFolderPathFromKnownFolderIdGuid&&(t=n.safeExecute(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getFolderPathFromKnownFolderIdGuid(l)},"FOLDERID_Profile")),u=(t||"").toLocaleLowerCase()+"\\onedrive - "}function h(n,t){if(t){var i=v(),r=n.indexOf(i);r>=0&&(n=n.substr(r+i.length))}else n.startsWith(o)&&(n=n.substr(o.length));return n}function c(n,t){var i,r,u;return t?(i=y(),r=n.indexOf(i),r>=0&&(u=n.indexOf("\\",r+i.length),n=n.substr(u+1))):n.startsWith(s)&&(n=n.substr(s.length)),n}var f={"Microsoft.Windows.ControlPanel":"ControlPanel","Microsoft.AutoGenerated.{923DD477-5846-686B-A659-0FCCD73851A8}":"Classic_{E9C71548-B580-43B2-ACDB-1BA924002754}","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\dfrgui.exe":"Classic_{7D13A5DB-6081-48BD-8EA3-A9D7FE67A335}","{6D809377-6AF0-444B-8957-A3773F02200E}\\Windows Defender\\MSASCui.exe":"NameSpace_Classic_{D8559EB9-20C0-410E-BEDA-7ED416AECC2A}","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\cleanmgr.exe":"Classic_{AACA901F-E74F-4894-B074-F55059532853}","Microsoft.AutoGenerated.{BB044BFD-25B7-2FAA-22A8-6371A93E0456}":"Classic_{45FDB5DF-1457-4A41-A824-7AD9C75767BC}","Microsoft.Windows.PCSettings.DefaultApps":"AAA_SettingsPageAppsDefaults"},e={"NameSpace_Classic_{F942C606-0914-47AB-BE56-1321B8035096}":"Classic_{232A1851-808C-4B44-A92A-38E862989CE5",AAA_Proxy_Automatic_Config_Group:"AAA_SettingsPageNetworkProxy",AAA_Settings_DeveloperModeGroup:"AAA_SettingsPageRestoreDeveloperOptions",AAA_SystemSettings_Users_PicturePassword:"AAA_SettingsGroupPicturePassword"},o="onedrive:\\",s="onedrive for business:\\",l="{5E6C858F-0E22-4760-9AFE-EA3317B67173}",a="{A52BBA46-E9E1-435f-B3D9-28DAA648C0F6}",r,u,p=function(){function i(n,t,i,r,u,f,e){this._config=n;this._host=t;this._instrumentationHelper=i;this._navigationHelper=r;this._webSignalsCache=u;this._ranker=f;this._previewPane=e}return i.prototype.launchWebSearch=function(n,t,i,r){var u=n.queryToFetch;this._host.launchSearch(u,this._navigationHelper.getSearchUrl(n.fullPartialQuery,u,i,null,r),t)},i.prototype.getProtocol=function(i,r){var o=this,f=t.SyntheticQSCodes.Protocol,u=this._instrumentationHelper.getInstrumentedSyntheticSuggestion(r,f),e;return u?u:(u=t.createSuggestion(null,this._host.getEdgeIcon,null,f,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(f,t.SyntheticQSCodes.KValues),1,r,!1,"tp",function(){return o._host.launchUrl(u.url)}),e=function(i){var r=n.prettyPrintUrl(i.fixedUrl,i.queryToFetch);u.url=i.fixedUrl;u.tooltip=i.fixedUrl;u.text=HitHighlightingParser.addMarkers(r);u.narratorText=t.getNarratorText(u,o._host.getLocString("DirectNavSuggestion"))},e(i),u.updateFromQuery=function(n){return n.isProtocol?(e(n),!0):!1},this._instrumentationHelper.instrumentSyntheticSuggestion(r,u),u)},i.prototype.getWebSearch=function(i,r,u,f,e,o,s){var a=this,h=this._instrumentationHelper.getInstrumentedSyntheticSuggestion(r,u),l,c;return h?h:(l=i.scope,h=t.createSuggestion(null,null,f,u,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(u,t.SyntheticQSCodes.KValues),e,r,!1,"tstw"),h.secondaryText=this._host.getLocString(o),h.secondaryTextClass=t.CssClass_Annotation,s&&(h.additionalInfoText=" - "+h.secondaryText),c=function(n){var i=n.queryToFetch.toLocaleLowerCase();h.text=HitHighlightingParser.addMarkers(i);h.narratorText=t.getNarratorText(h);h.click=function(){return a.launchWebSearch(n,h.useRaf,u,s)}},c(i),h.updateFromQuery=function(n){return!n.isProtocol&&n.scope==l&&n.queryToFetch?(c(n),!0):!1},this._instrumentationHelper.instrumentSyntheticSuggestion(r,h),h)},i.prototype.getStoreSearch=function(i,r){var s=this,f=t.SyntheticQSCodes.SearchTheStore,u=this._instrumentationHelper.getInstrumentedSyntheticSuggestion(r,f),o,e;return u?u:(o=i.scope,u=t.createSuggestion(null,null,{content:t.CortanaFontIcons.StoreLogo,type:2},f,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(f,t.SyntheticQSCodes.KValues),3,r,!1,"sts"),u.secondaryText=this._host.getLocString("SearchForAppsInTheStore"),u.additionalInfoText=" - "+u.secondaryText,u.secondaryTextClass=t.CssClass_Annotation,e=function(n){var i=n.queryToFetch.toLocaleLowerCase();u.text=HitHighlightingParser.addMarkers(i);u.narratorText=t.getNarratorText(u);u.click=function(){return s._host.launchStoreSearch(n.queryToFetch)}},e(i),u.updateFromQuery=function(n){return n.scope==o&&n.queryToFetch?(e(n),!0):!1},this._instrumentationHelper.instrumentSyntheticSuggestion(r,u),u)},i.prototype.getRecourse=function(i,r){if(!i.queryToFetch)return null;switch(t.getScopeFromTaskFrame(i.parsedTaskFrame,i.scope)){case t.Scope.Apps:return this.getStoreSearch(i,r);case t.Scope.Photos:return n.isBingEnabledCache?this.getWebSearch(i,r,t.SyntheticQSCodes.SearchBingImages,{content:t.CortanaFontIcons.Photo2,type:2},9,"SearchForWebImages","images"):null;case t.Scope.Videos:return n.isBingEnabledCache?this.getWebSearch(i,r,t.SyntheticQSCodes.SearchBingVideos,{content:t.SegoeFontIcons.Video,type:1},9,"SearchForWebVideos","videos"):null;default:return null}},i.prototype.getSyntheticSuggestions=function(i,r){var f=i.queryToFetch&&n.isSuggestionTypeEnabled(n.WebDataSource,t.SyntheticQSCodes.SearchTheWeb,0,i,this._config)?this.getWebSearch(i,r,t.SyntheticQSCodes.SearchTheWeb,{content:t.CortanaFontIcons.Search,type:2},0,"SearchTheWeb",""):null,e=i.isProtocol?this.getProtocol(i,r):null,u=this.getRecourse(i,r);return u&&(u.rankingScore=-Number.MAX_VALUE),{protocol:e,searchTheWeb:f,recourse:u}},i.prototype.canHaveDuplicates=function(i){switch(i){case n.WebDataSource:case n.MRUDataSource:case t.DataSources.BingApps:case t.DataSources.BingSettings:case t.DataSources.LocalApps:case t.DataSources.LocalRecentApps:case t.DataSources.LocalSettings:case t.DataSources.LocalDocumentsAndFolders:case t.DataSources.LocalMedia:case t.DataSources.CommandLine:case t.DataSources.PathCompletion:case t.DataSources.BCSApps:case t.DataSources.BCSSettings:case t.DataSources.MRUApps:case t.DataSources.MRUSettings:case t.DataSources.MRUFilesAndFolders:case t.DataSources.OneDrive:case t.DataSources.MyStuffOneDrive:case t.DataSources.MyStuffDocuments:case t.DataSources.MyStuffFolders:case t.DataSources.MyStuffPhotos:case t.DataSources.MyStuffVideos:case t.DataSources.MyStuffMusic:case t.DataSources.EdgeBrowsingHistory:case t.DataSources.SubstrateSuggestionsEnterprise:case t.DataSources.SubstrateSuggestionsConsumer:case t.DataSources.SubstrateSearchEnterprise:case t.DataSources.SubstrateSearchConsumer:return!0;case t.DataSources.BingContentStore:case t.DataSources.PowerBi:case t.DataSources.Office365Calendar:case t.DataSources.Experimental:return!1}throw new Error("New data source "+i+" needs to be explicity classified as needed deduping with other data sources or not");},i.prototype.canHaveDuplicatesWithinDataSource=function(i){switch(i){case t.DataSources.MRUApps:case t.DataSources.MRUSettings:case n.MRUDataSource:case t.DataSources.BCSApps:return!0}return!1},i.prototype.isDuplicate=function(i,r,u){var l,a,o,s;if(n.contains([5,4],r.handoffType)&&n.contains([5,4],u.handoffType)&&r.query.toLocaleLowerCase()==u.query.toLocaleLowerCase()&&r.actionUri==u.actionUri||r.handoffType==10&&u.handoffType==10&&r.query.toLocaleLowerCase()==u.query.toLocaleLowerCase()&&r.type==u.type&&!r.answerHtml&&!u.answerHtml||r.type!=t.SyntheticQSCodes.Protocol&&r.handoffType==1&&u.handoffType==1&&n.isDuplicateUrl(i,r.url,u.url))return!0;if(r.type==t.LocalSuggestionTypes.CommandLine&&t.isApp(u.type)||u.type==t.LocalSuggestionTypes.CommandLine&&t.isApp(r.type)){var y=t.getAppItem(r)||t.getAppItem(u),p=y.filePath,v=t.getCommandLineItem(r)||t.getCommandLineItem(u),w=v.encodedPath;return p&&w&&p.toLocaleLowerCase()==w.toLocaleLowerCase()?!v.launchArguments||(y.launchArguments||"").toLocaleLowerCase()==v.launchArguments.toLocaleLowerCase()||!y.launchArguments&&v.launchArguments&&y.displayName.toLocaleLowerCase().startsWith(v.displayName.toLocaleLowerCase()):!1}if(r.deviceItem&&u.deviceItem){if(l=r.deviceItem.id||"",a=u.deviceItem.id||"",l.toLocaleLowerCase()==a.toLocaleLowerCase())return!0;if(t.isApp(r.type)){if(t.isSetting(u.type)&&f[l]==a)return!0}else if(t.isSetting(r.type)&&(t.isApp(u.type)&&f[a]==l||t.isSetting(u.type)&&(e[l]==a||e[a]==l)))return!0}return(o=r.path,s=u.path,o&&s&&((o=o.toLocaleLowerCase(),s=s.toLocaleLowerCase(),o==s)||r.handoffType!=u.handoffType&&((o=h(o,r.handoffType!=7),s=h(s,u.handoffType!=7),o==s)||(o=c(o,r.handoffType!=8),s=c(s,u.handoffType!=8),o==s))))?!0:this.isCortanaSettingDuplicate(r,u)||this.isCortanaSettingDuplicate(u,r)?!0:!1},i.prototype.isCortanaSettingDuplicate=function(n,t){return n.handoffType==5&&n.actionUri=="ms-cortana://navigate/Settings"&&t.deviceItem&&t.deviceItem.id=="CortanaSettings"},i.prototype.isWebSuggestionForPrefix=function(i,r){return!i.suppressed&&(n.isWebSuggestion(i)||i.autoOpenPreviewPaneWhenOnTopHit||t.isWebGroupAnswer(i)&&i.handoffType==0)&&(!i.query||i.query.toLocaleLowerCase()==r.queryToFetch.toLocaleLowerCase())},i.prototype.rank=function(i,r,u,f,e,o,s,h){var ft=this,nt,c,tt,st,it,rt,ht,ut,ct,l,v,lt,yt;f.scope!=t.Scope.All&&(s=!1);var et=u[t.DataSources.BingContentStore],k=u[n.WebDataSource],d=k?k.rankingSignals:null,pt=k?k.webTopResultRoutingType:1,w=u[n.MRUDataSource],g=null,p=null,at=null;d?(d.WebSignalsAvailable=!0,g=k.engagementSignals,p=k.suppressedGroups):w&&w.WebRankingSignalsCache?(d=w.WebRankingSignalsCache,d.WebSignalsAvailable=!1,g=w.EngagementSignalsCache,p=w.SuppressedGroupsCache):et&&et.engagementSignals&&(g=et.engagementSignals);this._webSignalsCache&&(at=this._webSignalsCache.getPreviousEventData(f.queryToFetch));var wt=w?w.RankingSignals:null,bt={cvid:this._host.getConversationId(),privacyNumber:this._host.getPrivacyNumber()},a=this.getSyntheticSuggestions(f,o);r=p&&p.fullySuppressedGroups?r.filter(function(t){return!n.contains(p.fullySuppressedGroups,String(ft.getGroupTypeForSuppressions(t,ft._config)))}):r.slice();i.length==0&&a.protocol&&r.unshift(a.protocol);nt=e.length==1&&e[0].childSuggestions&&e[0].childSuggestions.some(function(n){return n.displayed});c=this._ranker.rank(f,this.getSuggestionsToRank(nt,i,r,a,o),d,wt,g,bt,at,h);i.length==0&&a.recourse&&r.push(a.recourse);var b=this.determineTopResults(e,r,c,a,f,o,nt),ot=i.filter(function(t){return!n.contains(e,t)}),y=this.determineSuggestionsToAddToGroups(ot,r,e,b,a,f,nt,s),vt=b.map(function(n){return t.getGroupType(n,ft._config)});if(this._config.aggressiveMRUSuppressionForLocalEnabled&&c.mruSuppressions&&c.mruSuppressions.mruGroupLaunches)for(tt=0,st=y;tt<st.length;tt++)l=st[tt],t.getGroupType(l,this._config)==n.GroupType.LocalPlaces&&(c.mruSuppressions.mruGroupLaunches[n.GroupType.Apps]>0||c.mruSuppressions.mruGroupLaunches[n.GroupType.Settings]>0)&&(l.suppressed=!0);if(this._config.mruSuppressionsEnabled&&c.mruSuppressions&&c.mruSuppressions.sumMruLaunches>=this._config.mruSuppressionMinLaunchCount&&c.mruSuppressions.unknownRatio<this._config.mruSuppressionMaxUnknownRatio&&c.mruSuppressions.mruGroupLaunches&&this.canPartiallySuppressGroups(b,y)){for(it={},rt=0,ht=y;rt<ht.length;rt++)if(l=ht[rt],l!=a.searchTheWeb&&(v=this.getGroupTypeForSuppressions(l,this._config),this.canBePartiallySuppressed(v,vt))){if(!it[v]){var kt=c.mruSuppressions.mruGroupLaunches[v]?c.mruSuppressions.mruGroupLaunches[v]/c.mruSuppressions.sumMruLaunches:0,dt=this._config.mruSuppressionGroupRatioWeight*kt+this._config.mruSuppressionBias,gt=1/(1+Math.exp(-dt));it[v]=gt}l.mruSuppressionScore=it[v];l.mruSuppressionScore>.5&&(l.suppressed=!0)}}else if(p&&p.partiallySuppressedGroups&&this.canPartiallySuppressGroups(b,y))for(ut=0,ct=y;ut<ct.length;ut++)l=ct[ut],l!=a.searchTheWeb&&(v=this.getGroupTypeForSuppressions(l,this._config),this.canBePartiallySuppressed(v,vt)&&n.contains(p.partiallySuppressedGroups,String(v))&&(l.suppressed=!0));return lt=[],this.removeProtocolIfDuplicate(f,a,b,ot,y,lt),this.setUseRafFlag(b,y,f,pt),yt=this.getGroupOrder(f,y,ot),{topResults:b,suggestionsToAdd:y,suggestionsToRemove:lt,groupOrder:yt}},i.prototype.allowedInGroups=function(n){return n.isAnswer?n.allowedInGroups:!0},i.prototype.getGroupTypeForSuppressions=function(i,r){var u=t.getGroupType(i,r);return u==n.GroupType.LocalPlaces?n.GroupType.SearchSuggestions:u},i.prototype.canBePartiallySuppressed=function(i,r){return t.getScope(i,this._config)==t.Scope.All?!1:this._config.groupSuppressionOnlyIfNotInTophit&&n.contains(r,i)?!1:!0},i.prototype.canPartiallySuppressGroups=function(i,r){var u=this;return this._config.groupSuppressionOnlyIfNotInTophit?!0:i.every(function(i){return t.getGroupType(i,u._config)==n.GroupType.SearchSuggestions})&&r.every(function(i){return t.getGroupType(i,u._config)==n.GroupType.SearchSuggestions})?!1:!0},i.prototype.isProtocolDuplicate=function(i,r,u){return i==u?!1:i.type==t.OnlineSuggestionTypes.DirectNav?!0:i.handoffType==1&&n.isDuplicateUrl(r,i.url,u.url)},i.prototype.removeProtocolIfDuplicate=function(n,t,i,r,u,f){var e=this,o,s;t.protocol&&(i.some(function(i){return!i.suppressed&&e.isProtocolDuplicate(i,n,t.protocol)})||r.some(function(i){return!i.suppressed&&e.isProtocolDuplicate(i,n,t.protocol)})||u.some(function(i){return!i.suppressed&&e.isProtocolDuplicate(i,n,t.protocol)}))&&(o=i.indexOf(t.protocol),o>=0?i.splice(o,1):(s=u.indexOf(t.protocol),s>=0?u.splice(s,1):f.push(t.protocol)),t.protocol=null)},i.prototype.getSuggestionsToRank=function(i,r,u,f){i&&(r=r.filter(function(n){return!t.asChildSuggestion(n)}));f.recourse&&(r=r.filter(function(n){return n!=f.recourse}));var e=r.concat(u);return f.searchTheWeb&&!n.contains(r,f.searchTheWeb)&&e.push(f.searchTheWeb),e},i.prototype.determineTopResults=function(t,i,r,u,f,e,o){var w=this,s,h,a,v,y,l,p,c;if(o)return t;for(s=this._config.forceVoiceFlowOnTopHit||!f.queryToFetch?[]:r.topResults,h=t[0],h&&s[0]!=h&&this._previewPane&&this._previewPane.getPreviewedSuggestion()==h&&(s=[h].concat(s.filter(function(n){return n!=h}))),u.protocol&&u.searchTheWeb&&this._ranker.allowInTopHit(f,u.protocol,!0,this._config.allowAnyNonHcWebToTopHit)&&(a=s.indexOf(u.searchTheWeb),a>=0&&s.splice(a,1)),u.searchTheWeb&&(v=s.indexOf(u.searchTheWeb),v>=0&&s.some(function(n){return n!=u.searchTheWeb&&w.isWebSuggestionForPrefix(n,f)})&&s.splice(v,1)),s.length==0&&(u.protocol&&this._ranker.allowInTopHit(f,u.protocol,!0,this._config.allowAnyNonHcWebToTopHit)?(s.push(u.protocol),y=i.indexOf(u.protocol),y>=0&&i.splice(y,1)):u.searchTheWeb&&this._ranker.allowInTopHit(f,u.searchTheWeb,!0,this._config.allowAnyNonHcWebToTopHit)?s.push(u.searchTheWeb):u.recourse&&this._ranker.allowInTopHit(f,u.recourse,!0,this._config.allowAnyNonHcWebToTopHit)&&(s.push(u.recourse),i.splice(i.indexOf(u.recourse),1))),s.length>this._config.maxNumberOfTopResults&&(s=s.slice(0,this._config.maxNumberOfTopResults)),l=0,p=t;l<p.length;l++)c=p[l],n.contains(s,c)||(c.useRaf&&(c.useRaf=!1),i.unshift(c));return s.forEach(function(n){return n.suppressed=!1}),s},i.prototype.setUseRafFlag=function(n,i,r,u){var e,s,o,h,f;if(t.isCortanaEnabledCache)if(u==2||this._config.forceVoiceFlowOnTopHit)for(e=0,s=n;e<s.length;e++)f=s[e],f.handoffType!=0||f.isAnswer||(f.useRaf=!0);else for(o=0,h=n;o<h.length;o++)f=h[o],f.handoffType==0&&!f.isAnswer&&this._host.matchesVcd(f.query||r.queryToFetch)&&(f.useRaf=!0)},i.prototype.determineSuggestionsToAddToGroups=function(i,r,u,f,e,o,s,h){var l=this,c=r.filter(function(t){return!n.contains(f,t)}),p=[],a,v,y,w;for(c.forEach(function(n,i){l.allowedInGroups(n)||(t.getScope(t.getGroupType(n,l._config),l._config)==t.Scope.All?p.push(i):n.suppressed=!0)}),a=p.length-1;a>=0;--a)c.splice(a,1);return e.searchTheWeb&&n.contains(f,e.searchTheWeb)&&(v=c.findIndex(function(n){return l.isWebSuggestionForPrefix(n,o)}),v!=-1&&c.splice(v,1)),y=c.filter(function(i){return i.handoffType==5||n.contains([n.GroupType.SearchSuggestions,n.GroupType.Websites],t.getGroupType(i,l._config))}),w=c.filter(function(n){return n.handoffType==8||l._config.enforceOriginalOrderForTypes[n.type]}),s||this.addChildSuggestions(o,f,c,h),o.queryToFetch&&c.sort(function(n,t){return t.rankingScore-n.rankingScore}),this.insertDefaultSearchTheWeb(o,e,f,i,c,y),c=this.insertSuggestionsToRightPlace(c,w,f),this.insertSuggestionsToRightPlace(c,y,f)},i.prototype.insertDefaultSearchTheWeb=function(n,i,r,u,f,e){var s=this,o,h;i.searchTheWeb&&(n.scope==t.Scope.Web||n.scope==t.Scope.All)&&(o=e.findIndex(function(t){return s.isWebSuggestionForPrefix(t,n)}),u.some(function(t){return s.isWebSuggestionForPrefix(t,n)})||r.some(function(t){return s.isWebSuggestionForPrefix(t,n)})?o!=-1&&(h=e[o],e.splice(o,1),f.splice(f.indexOf(h),1)):o==-1&&(e.unshift(i.searchTheWeb),f.push(i.searchTheWeb)))},i.prototype.getGroupOrder=function(i,r,u){var e,l,o,s,a,h,c,v,f,y;switch(i.scope){case t.Scope.Web:if(!i.queryToFetch)return[n.GroupType.EdgeHistory,n.GroupType.Websites,n.GroupType.SearchSuggestions];break;case t.Scope.Apps:return[n.GroupType.Apps,n.GroupType.Store];case t.Scope.Photos:return[n.GroupType.Photos,n.GroupType.SearchSuggestions];case t.Scope.Videos:return[n.GroupType.Videos,n.GroupType.SearchSuggestions]}for(e=r.concat(u),e.sort(function(n,t){return t.rankingScore-n.rankingScore}),l=[],o=[],s=0,a=e;s<a.length;s++)f=a[s],f.suppressed?o.push(f):l.push(f);for(o.length!=0&&(e=l.concat(o)),h=[],c=0,v=e;c<v.length;c++)f=v[c],y=t.getGroupType(f,this._config),n.contains(h,y)||h.push(y);return h},i.prototype.addChildSuggestions=function(n,t,i,r){var f=this,u;t.length!=1||r&&this._config.maxNumberOfTopResults>1||(u=t[0],u.calculateChildSuggestions&&u.calculateChildSuggestions(),u.childSuggestions&&u.childSuggestions.length>0&&Object.keys(this._config.topHitChildGroups).forEach(function(n,t){var o=parseInt(n),r=f._config.topHitChildGroups[n],e;r>0&&(e=u.childSuggestions.filter(function(n){return n.groupType==o}).slice(0,r),e.forEach(function(n,r){n.rankingScore=1e4-100*t-r;i.push(n)}))}))},i.prototype.insertSuggestionsToRightPlace=function(t,i){var u,r;if(i.length>0){for(u=[],r=0;r<t.length;r++)i[0]==t[r]?u=u.concat(i):n.contains(i,t[r])||u.push(t[r]);return u}return t},i}();i.Aggregator=p})(i=t.Ranking||(t.Ranking={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function t(n,t,i,r,u){var f=this;this._config=n;this._instrumentationHelper=i;this._sequenceNumberReader=r;this._page=u;this._itemLaunchEventHandlers=[];this.groups=[];this.topResults=[];this._lastUpdatedSequenceNumber=-1;this._topResultsRenderingDisabled=!1;this._groupRenderingDisabled=!1;t.bindDismissed(function(){f.topResults=[];f.renderTopResults();f.groups=[];f.renderGroups();f._partialQuery=null;f._extraSignalsMap=null;f._config.fixInstrumentationForClientSubmissions||(f._lastUpdatedSequenceNumber=-1,f._selectedItem=null)});this._config.fixInstrumentationForClientSubmissions&&t.bindShown(function(){f._selectedItem=null})}return t.prototype.bindItemLaunch=function(n){this._itemLaunchEventHandlers.push(n)},t.prototype.onSuggestionLaunch=function(n){var t=this;this._itemLaunchEventHandlers.forEach(function(i){return i(n,t._partialQuery,t._extraSignalsMap)})},t.prototype.onQueryChanged=function(){this._extraSignalsMap=null},t.prototype.setExtraSignalsMap=function(n){this._extraSignalsMap=n},t.prototype.getCurrentTopResults=function(){return this.topResults.slice(0)},t.prototype.getTopResultsWhichFitInCanvas=function(n){return n},t.prototype.update=function(t,i,r,u,f,e,o,s,h){var l=this,p,w,c,a,k;t!=(u!=this._lastUpdatedSequenceNumber)&&SharedLogHelper.LogError("updateTopResult",t+" != (sequenceNumber "+u+" != lastUpdateSequenceNumber "+this._lastUpdatedSequenceNumber+")",new Error("Precondition failed"));this._lastUpdatedSequenceNumber=u;p=this.groups;t&&(this.groups=[],this.onGroupsCleared());w=this._selectedItem;c=this.topResults;i=this.getTopResultsWhichFitInCanvas(i);a=!n.sequenceEqual(i,c);a&&(this.topResults=i.slice(0));var v=!1,y=a?i.length:0,b=function(){v&&y==0&&(l._instrumentationHelper.instrumentTopResultRendered(u,i.map(function(n){return n.type})),v=!1)};a?(this.renderTopResultsAfter(function(){for(var e,t=0,i=l.topResults;t<i.length;t++)e=i[t],n.contains(c,e)?y-=1:l.setupIcon(u,e,!0,function(){y-=1;b()});l.onBeforeRenderTopResults(c,f,r,h)}),v=!0):(k=this.onBeforeRenderTopResults(c,f,r,h),k==0&&(this.renderTopResults(),v=!0));this._selectedItem&&(w!=this._selectedItem||t)&&n.contains(this.topResults,this._selectedItem)&&this._page.render(function(){var n=_ge(l._selectedItem.id);n&&(n.setAttribute("aria-selected","false"),n.setAttribute("aria-selected","true"))});return this.onAfterRenderTopResults(t,r,u,f,e,o,s,a,c,p,b)},t.prototype.setupIcon=function(n,t,i,r){r()},t.prototype.renderGroups=function(){this._groupRenderingDisabled||this._page.updateGroupsView(this.groups)},t.prototype.renderGroupsAfter=function(n){var t=this._groupRenderingDisabled;this._groupRenderingDisabled=!0;try{n()}finally{this._groupRenderingDisabled=t;this.renderGroups()}},t.prototype.renderTopResults=function(){this._topResultsRenderingDisabled||this._page.updateTopResultsView(this.topResults)},t.prototype.renderTopResultsAfter=function(n){var u=this._topResultsRenderingDisabled,t,i,r;this._topResultsRenderingDisabled=!0;try{n()}finally{for(this._topResultsRenderingDisabled=u,this.renderTopResults(),t=0,i=this.topResults;t<i.length;t++)r=i[t],r.executeScript&&r.executeScript()}},t.prototype.insertGroup=function(n,t){for(var u,f=t.indexOf(n.type),r=!1,i=0;i<this.groups.length;i++)if(u=t.indexOf(this.groups[i].type),u>f){this.groups.splice(i,0,n);r=!0;break}r||this.groups.push(n)},t}();n.BaseRootViewModel=t}(AutoSuggest||(AutoSuggest={})),function(n){var t="aria-selected",i=function(){function n(){var n=this,i;this._renderingInProgress=!1;this._narratorLaunchHandlers=[];i=new MutationObserver(function(i){var r,o,u,f,s,e;if(!n._renderingInProgress){for(r=[],u=0,f=i;u<f.length;u++)s=f[u],e=s.target,o=e.id,r.push(e.getAttribute(t)=="true"?1:0);(r.length==1&&r[0]==0||r.length==2&&r[0]^r[1])&&n._narratorLaunchHandlers.forEach(function(n){return n(o)})}});i.observe(document,{subtree:!0,attributes:!0,attributeFilter:[t]})}return n.prototype.bindOnNarratorLaunch=function(n){this._narratorLaunchHandlers.push(n)},n.prototype.render=function(n){var t=this;sb_ct(this._renderingTimer);this._renderingInProgress=!0;try{n()}finally{this._renderingTimer=sb_st(function(){return t._renderingInProgress=!1},0)}},n}();n.BasePage=i}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){var r="slideInMessage",i="b_hide",u;t.PreviewPaneWidth=438;u=function(u){function f(n,i,f){var e=u.call(this)||this;return e._config=n,e._instHelper=i,e._host=f,e._windowsTemporaryMessageShown=!1,e._windowsIndexingMessageShown=!1,e._suggestionsContainerHeight=0,e.progressBarVisible=!1,e.previewPaneVisible=!1,e._viewData={TestHooksEnabled:n.th},e._windowsTemporaryMessageWrapper=_ge("temporaryMessageWrapper"),e._windowsIndexingMessageWrapper=_ge("indexingMessageWrapper"),e._qfContainer=_ge("qfContainer"),e._groupsView=Sparkle.render("AutoSuggest:WindowsGroups",{uiCulture:t.uiLanguageCache,properties:{Groups:[]},viewData:e._viewData},_ge("groups")),e._topResultsView=Sparkle.render("AutoSuggest:WindowsTopResults",{uiCulture:t.uiLanguageCache,properties:{Suggestions:[]},viewData:e._viewData},_ge("topResults")),e._windowsTemporaryMessageView=Sparkle.render("AutoSuggest:WindowsMessage",{uiCulture:t.uiLanguageCache,properties:{MessageClassName:r},viewData:e._viewData},_ge("temporaryMessage")),e._windowsDialogBoxView=Sparkle.render("AutoSuggest:WindowsDialogBox",{uiCulture:t.uiLanguageCache,properties:{},viewData:e._viewData},_ge("dialogBox")),e._windowsIndexingMessageView=Sparkle.render("AutoSuggest:WindowsIndexingMessage",{uiCulture:t.uiLanguageCache,properties:{},viewData:e._viewData},_ge("indexingMessage")),e._topHitHeaderView=Sparkle.render("AutoSuggest:TopHitHeader",{uiCulture:t.uiLanguageCache,properties:{ShowModule:!1,Scopes:[]},viewData:e._viewData},_ge("topHitHeader")),e._config.scopesOrder.length>0&&(e._searchScopesL2View=Sparkle.render("AutoSuggest:WindowsSearchScopesL2",{uiCulture:t.uiLanguageCache,properties:{Scopes:[],AdvancedOptions:[]},viewData:e._viewData},_ge("searchScopesL2"))),e._config.startMenuPrototypeEnabled&&(e._startMenu=Sparkle.render("AutoSuggest:WindowsGroups",{uiCulture:t.uiLanguageCache,properties:{Groups:[]},viewData:e._viewData},_ge("startMenu"))),f.bindAppVisible(function(){var n=SearchAppWrapper.CortanaApp.width,t=SearchAppWrapper.CortanaApp.height;n&&t?e.setDimensions(n,t):ThresholdUtilities.getCortanaHeaders(function(n){var t=n["X-BM-DeviceDimensionsLogical"].split("x"),i=t[0],r=t[1];e.setDimensions(parseInt(i),r)});e.resetSuggestionsContainerHeight()}),f.bindAppHidden(function(){return e._openPreviewPaneButtonCache=undefined}),e}return __extends(f,u),f.prototype.setDimensions=function(n,i){if(t.isMobileCache&&(this._root||(this._root=_ge("root")),this._root.style.height=i+"px"),n!=this._currentPaneWidth){this.onPaneWidthSet(n);this._originalPaneWidth=n}},f.prototype.getScrollTop=function(){return this._qfContainer.scrollTop},f.prototype.scrollToTop=function(){this._qfContainer.scrollTop=0;_d.body.scrollTop=0},f.prototype.scrollTo=function(n){var r=_ge(n.id),i;this.scrollToElement(r,this._qfContainer,this._qfContainer.offsetHeight);i=window.innerHeight;t.isMobileCache&&_d.body.scrollHeight>i&&this.scrollToElement(r,_d.body,i)},f.prototype.scrollToElement=function(n,t,i){var u=t.scrollTop,r=n.offsetTop-t.offsetTop,f=r+n.offsetHeight;f>u+i?t.scrollTop=f-i:r<u&&(t.scrollTop=r)},f.prototype.getSuggestionsContainerHeight=function(){return this._suggestionsContainerHeight||this.calculateSuggestionsContainerHeight(),this._suggestionsContainerHeight},f.prototype.resetSuggestionsContainerHeight=function(){this._suggestionsContainerHeight=0},f.prototype.calculateSuggestionsContainerHeight=function(){var n=_ge("root").clientHeight,t=_ge("indexingMessage");n-=t.offsetHeight;this._suggestionsContainerHeight=n},f.prototype.isSingleWidth=function(){return this._currentPaneWidth==this._originalPaneWidth},f.prototype.openDoubleWidth=function(){if(this.isSingleWidth()){this._qfContainer.style.width=this._currentPaneWidth+"px";var n=this._currentPaneWidth+t.PreviewPaneWidth;SearchAppWrapper.CortanaApp.setPaneWidth(n);this.onPaneWidthSet(n)}},f.prototype.closeDoubleWidth=function(){if(!this.isSingleWidth()){SearchAppWrapper.CortanaApp.resetToDefaultSize();this._qfContainer.style.width="";this.onPaneWidthSet(this._originalPaneWidth)}},f.prototype.onPaneWidthSet=function(n){this._currentPaneWidth=n;sj_evt.fire("CortanaPaneWidthSet",n)},f.prototype.setContextMenuHandler=function(n){this._contextMenuHandler=n},f.prototype.setSuggestionClickHandler=function(n){this._suggestionClickHandler=n},f.prototype.setRemoveSuggestionClickHandler=function(n){this._removeSuggestionClickHandler=n},f.prototype.setOpenPreviewPaneClickHandler=function(n){this._openPreviewPaneClickHandler=n},f.prototype.getPreviewPaneGlyph=function(n){switch(this._config.previewPaneIcon){case 0:return t.CortanaFontIcons.More;case 1:return n?t.CortanaFontIcons.ListMirrored:t.CortanaFontIcons.List;case 2:case 3:case 4:return n?t.CortanaFontIcons.ChevronLeft:t.CortanaFontIcons.ChevronRight}throw new Error("Unknown preview pane icon: "+this._config.previewPaneIcon);},f.prototype.getOpenPreviewPaneButton=function(){if(t.PreviewPane&&!this._openPreviewPaneButtonCache){var n=ThresholdUtilities.isRightToLeftLanguage(t.uiLanguageCache);this._openPreviewPaneButtonCache={defaultIcon:{content:this.getPreviewPaneGlyph(n),type:2},hoverIcon:{content:n?t.CortanaFontIcons.Back:t.CortanaFontIcons.Forward,type:2},clickHandler:this._openPreviewPaneClickHandler}}return this._openPreviewPaneButtonCache},f.prototype.updateGroupsView=function(n){var i=this;if(this._config.th&&ClientTestHooks.isTesthookParamSet("forceRenderingCrashOnSecondConversation")&&this._host.getPaneCloseCount())throw new Error("Simulated exception");this.render(function(){Sparkle.update(i._groupsView,{uiCulture:t.uiLanguageCache,properties:{Groups:n,ContextMenuHandler:i._contextMenuHandler,ClickHandler:i._suggestionClickHandler,RemoveClickHandler:i._removeSuggestionClickHandler,OpenPreviewPaneButton:i.getOpenPreviewPaneButton()},viewData:i._viewData})})},f.prototype.updateTopResultsView=function(n){var i=this;this.render(function(){Sparkle.update(i._topResultsView,{uiCulture:t.uiLanguageCache,properties:{Suggestions:n,ContextMenuHandler:i._contextMenuHandler,ClickHandler:i._suggestionClickHandler,RemoveClickHandler:i._removeSuggestionClickHandler,OpenPreviewPaneButton:i.getOpenPreviewPaneButton()},viewData:i._viewData})})},f.prototype.showTemporaryMessage=function(u,f){var e=this;this._windowsTemporaryMessageShown?(this.hideTemporaryMessage(),sb_st(function(){return n.safeExecute(function(){return e.showTemporaryMessage(u,f)},"showTemporaryMessage")},100)):(Sparkle.update(this._windowsTemporaryMessageView,{uiCulture:t.uiLanguageCache,properties:{Visible:!0,Icon:f,MessageClassName:r,MessageText:u,ClickHandler:function(){e.hideTemporaryMessage();e._host.setFocusInSearchBox("temporaryMessage")}},viewData:this._viewData}),this._windowsTemporaryMessageShown=!0,this._windowsTemporaryMessageWrapper.classList.remove(i))},f.prototype.hideTemporaryMessage=function(){this._windowsTemporaryMessageShown&&(Sparkle.update(this._windowsTemporaryMessageView,{uiCulture:t.uiLanguageCache,properties:{MessageClassName:r},viewData:this._viewData}),this._windowsTemporaryMessageShown=!1,this._windowsTemporaryMessageWrapper.classList.add(i))},f.prototype.showIndexingMessage=function(n,r){this._windowsIndexingMessageShown||(Sparkle.update(this._windowsIndexingMessageView,{uiCulture:t.uiLanguageCache,properties:{Icon:{content:t.CortanaFontIcons.Sync,type:2},Running:n,Visible:!0,Action:r},viewData:this._viewData}),this._windowsIndexingMessageShown=!0,this._windowsIndexingMessageWrapper.classList.remove(i),this.resetSuggestionsContainerHeight())},f.prototype.hideIndexingMessage=function(){this._windowsIndexingMessageShown&&(Sparkle.update(this._windowsIndexingMessageView,{uiCulture:t.uiLanguageCache,properties:{},viewData:this._viewData}),this._windowsIndexingMessageShown=!1,this._windowsIndexingMessageWrapper.classList.add(i),this.resetSuggestionsContainerHeight())},f.prototype.updateDialogBox=function(n,i,r){var u=this;this.render(function(){Sparkle.update(u._windowsDialogBoxView,{uiCulture:t.uiLanguageCache,properties:{Visible:n,MessageText:i,Buttons:r},viewData:u._viewData})})},f.prototype.updateTopHitHeaderView=function(n,i,r,u,f,e,o){var s=this;this.render(function(){Sparkle.update(s._topHitHeaderView,{uiCulture:t.uiLanguageCache,properties:{ShowModule:n,HeaderText:i,Message:r,MessageIcon:u,Scopes:f,ChevronDownIcon:{content:t.CortanaFontIcons.ChevronDown,type:2},MoreClickHandler:e,AdvancedOptions:o},viewData:s._viewData})})},f.prototype.updateSearchScopesL2View=function(n,i,r,u){var f=this;this.render(function(){Sparkle.update(f._searchScopesL2View,{uiCulture:t.uiLanguageCache,properties:{Scopes:n,CancelIcon:{content:t.CortanaFontIcons.ChevronDown,type:2},CancelHandler:i,AdvancedOptionsBottom:u,AdvancedOptionsTop:r},viewData:f._viewData})})},f.prototype.updateStartMenu=function(n){this._config.startMenuPrototypeEnabled&&(_ge("startMenu").style.display=n.length?"block":"none",Sparkle.update(this._startMenu,{uiCulture:t.uiLanguageCache,properties:{Groups:n,ContextMenuHandler:this._contextMenuHandler,ClickHandler:this._suggestionClickHandler,RemoveClickHandler:this._removeSuggestionClickHandler},viewData:this._viewData}))},f.prototype.setProgressIndicatorVisibility=function(n){this.progressBarVisible!=n&&(this._progressBar||(this._progressBar=_ge("b_progress")),this.setVisiblity(this._progressBar,n),this.progressBarVisible=n)},f.prototype.setPreviewPaneVisibility=function(n){this.previewPaneVisible!=n&&(this._previewPane||(this._previewPane=_ge("qfPreviewPane")),n||this.closeDoubleWidth(),this.setVisiblity(this._previewPane,n),n&&this.openDoubleWidth(),this.previewPaneVisible=n)},f.prototype.setVisiblity=function(n,t){t?n.classList.remove(i):n.classList.add(i)},f}(n.BasePage);t.Page=u})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var r="SA_SUPERFRESH_SUPPRESS",u="LAST",t="SRCHHPGUSR",i="FORCE",f=54e5,e=function(){function e(t,i,e){var o=this;this._config=t;this._host=i;this._appCacheInstrumentationHelper=e;this._isReloadSuppressed=!1;this._pendingReload=!1;this._emptyQuery=!1;e.registerSuperFresh();this._lastCheck=Number(sj_cook.get(r,u));i.hasFallbackHappened()&&(this._isReloadSuppressed=!0,this._lastReloadAfterFallback=Date.now());i.bindAppHidden(function(){(o._isReloadSuppressed=o._lastReloadAfterFallback&&Date.now()-o._lastReloadAfterFallback<f,o._isReloadSuppressed)||(!o._pendingReload&&t.reloadAfterConversations&&i.getPaneCloseCount()>=t.reloadAfterConversations&&(o._pendingReload=!0),o._pendingReload&&(o.logReloadAttempt(),o.reload()))});sj_be(applicationCache,"updateready",function(){return o.onUpdateReady()});i.bindConversationStart(function(){o._isReloadSuppressed=!0;o.shouldCheckForUpdate()&&(applicationCache.status!=0||appcacheConfig.IgnoreAppCacheStatus)&&n.safeExecute(function(){applicationCache.update();o._lastCheck=sb_gt();sj_cook.set(r,u,o._lastCheck.toString())},"probe for manifest update")})}return e.prototype.shouldCheckForUpdate=function(){var r,u,f;return n.isBingEnabledCache?(r=!0,appcacheConfig.ReduceLoadEnabled&&(u=sj_cook.get(t,i),u!=="1"&&(f=(sb_gt()-this._lastCheck)/6e4,r=f>=appcacheConfig.TimeToRefresh)),this._config.th&&ClientTestHooks.isTesthookParamSet("disableAppCache"))?!1:r:!1},e.prototype.onUpdateReady=function(){appcacheConfig.ReduceLoadEnabled&&sj_cook.get(t,i)==="1"&&sj_cook.set(t,i,"0",!0,"/");this.logReloadAttempt();this._isReloadSuppressed?this._pendingReload=!0:this.reload()},e.prototype.reload=function(){this._host.reloadWebView(!1)},e.prototype.logReloadAttempt=function(){this._appCacheInstrumentationHelper.instrumentSuperFreshUpdate(this._isReloadSuppressed)},e}();n.SuperFreshAppCache=e}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i,r;(function(t){function u(t,i,r,u,f,e){var s,h=function(n){s&&f.unregister(s);SharedLogHelper.LogError(t,e,n);u&&u(n)},o,c;try{o=i();o?(f&&(s=f.register(function(){return n.safeExecute(function(){return o.cancel()},t+" cancellation")},!1)),c=function(i){s&&f.unregister(s);r&&n.safeExecute(function(){return r(i)},t+" completion")},o.done?o.done(c,h):o.then(c,h)):h(new Error("No promise returned"))}catch(l){h(l)}}function f(n,i,r){var f,e,o,u=[],s=function(n){f=n;o=!0;u.forEach(function(t){return t(n)});u=null};return function(h){o?h(f):(u.push(h),e||(e=!0,t.safeChain(n,function(){return i()},function(n){return s(r?r(n):n)},function(){return s(null)})))}}function r(t,i,r,u){i.completed=!0;i.result=r;i.pendingCallbacks.forEach(function(t){return n.safeExecute(function(){return t(r)},u)});i.pendingCallbacks=null}function e(){i={}}function o(){var n=[];for(var t in i)i[t].completed||n.push(t);n.forEach(function(n){return delete i[n]})}function s(u,f,e,o,s,h,c){return function(l,a){var y=e(l),v=i[y],p;v||(v={started:!1,completed:!1,result:null,pendingCallbacks:[]},i[y]=v);v.completed?a(v.result):(v.pendingCallbacks.push(a),v.started||(v.started=!0,p=function(){t.safeChain(u,function(){return f(l)},function(n){return r(y,v,o?o(n):n,u)},function(t){n.isCancellation(t)?r(y,v,null,u):c?(c-=1,p()):r(y,v,s,u)},null,h)},p()))}}t.safeChain=u;t.safeChainWithCaching=f;var i={};t.clearGlobalCache=e;t.clearPendingItemsFromCache=o;t.safeChainWithGlobalCaching=s})(i=t.Promise||(t.Promise={})),function(n){function t(n,t,i){for(var u,f,e={},r=0,o=n;r<o.length;r++)u=o[r],f=t[u],f&&(e[u]=i(f));return e}function i(n){for(var t in n)if(n[t])return!1;return!0}n.map=t;n.isEmpty=i}(r=t.Map||(t.Map={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(t){function e(){return!!i}function o(){return i&&i.selectableItems}function s(){return i&&i.selectedItem}function f(n,t){var r=_ge(n.id),f;t?r.classList.add(u):r.classList.remove(u);f=t?"true":"false";i&&i.page?i.page.render(function(){return r.setAttribute("aria-selected",f)}):r.setAttribute("aria-selected",f)}function h(n){i&&(i.selectedItem&&(i.selectedItem.selected=!1,f(i.selectedItem,!1)),i.selectedItem=n,i.selectedItem&&(i.selectedItem.selected=!0,f(i.selectedItem,!0)))}function c(n,t,i,r,u,f){a(t,i,l(n,r),u,f)}function l(t,i){return t.map(function(t){var u={id:t.verb,text:t.displayName,isSeparator:!t.verb,selected:!1,isDefault:t.isDefault};return u.isSeparator||(u.click=function(u,f){i(t.verb,u,f);n.safeExecute(function(){return t.executeAsync()},"verb.executeAsync",undefined,t.verb);r()}),u})}function a(t,u,f,e,o){var s,l,h,c,a;if(r(),f.length>0){for(s=_d.createElement("div"),s.id="contextMenu",s.className="contextMenu",s.style.top="1px",s.style.left="1px",s.style.visibility="hidden",s.setAttribute("role","listbox"),l=function(n){var i,t,r;n.isSeparator?(i=_d.createElement("hr"),i.className="divider",s.appendChild(i)):(t=_d.createElement("div"),t.id=n.id,r=n.isDefault?'<span class="highlighted">'+n.text+"<\/span>":n.text,t.innerHTML=r,t.setAttribute("role","listitem"),t.setAttribute("aria-label",n.text),t.className="contextMenuItem",t.addEventListener("mouseup",function(t){t.button==0&&n.click(1,null)}),s.appendChild(t))},h=0,c=f;h<c.length;h++)a=c[h],l(a);_d.body.appendChild(s);i={contextMenuElement:s,selectableItems:f.filter(function(n){return!n.isSeparator}),selectedItem:null,page:e,onDismiss:o};sb_st(function(){return n.safeExecute(function(){var r,o;if(i&&i.contextMenuElement){var n=i.contextMenuElement,f=13,e=2*f;t-=f;u-=f;r=n.offsetWidth+e;r>n.parentElement.offsetWidth&&(r=n.parentElement.offsetWidth,n.style.width=r-e+"px");o=n.offsetHeight+e;n.style.left=n.parentElement.offsetWidth-t<r?n.parentElement.offsetWidth-r+"px":t+"px";n.style.top=n.parentElement.offsetHeight-u<o?n.parentElement.offsetHeight-o+"px":u+"px";n.style.visibility=""}},"renderContextMenu")},0)}}function r(){i&&(i.contextMenuElement&&_d.body.removeChild(i.contextMenuElement),i.onDismiss&&i.onDismiss(),i=null)}var i,u;t.isContextMenuVisible=e;t.getSelectableItems=o;t.getSelectedItem=s;u="sa_hv";t.select=h;t.showContextMenu=c;t.dismiss=r;_d.body.addEventListener("mouseup",r);_w.addEventListener("blur",r);sj_evt.bind("ajax.threshold.pageStart",r)})(i=t.ContextMenus||(t.ContextMenus={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={}))