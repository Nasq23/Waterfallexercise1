var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},AutoSuggest;(function(n){function i(n,t,i,r,u,f){var e=sj_gx(),o,s;if(e.open(i?"POST":"GET",n,!0),t)for(o in t)e.setRequestHeader(o,t[o]);u&&(s=u.register(function(){return e.abort()},!1));e.onreadystatechange=function(){e.readyState==4&&f()&&(e.onreadystatechange=function(){},s&&u.unregister(s),r&&r({responseText:e.responseText,contentType:e.getResponseHeader("content-type")||"",status:e.status}))};e.withCredentials!==undefined&&(e.withCredentials=!0);e.send(i)}function u(n){var t=n.IconContent;return t?t[0]=="S"?{content:t.slice(1),type:1}:{content:t,type:2}:n.Icon?{content:n.Icon,type:0}:null}var t,r;n.fetchUrl=i;t=function(){function t(n,t,i){t===void 0&&(t=0);i===void 0&&(i=!0);this._config=n;this._delay=t;this._validateResponseType=i}return t.prototype.getDataSource=function(){return undefined},t.prototype.getBaseUrl=function(){return undefined},t.prototype.getPostBody=function(){return undefined},t.prototype.onBeforeFetchUrl=function(){},t.prototype.createUrl=function(t){return decodeURIComponent(this.getBaseUrl())+(t?n.encodeQueryParameter(t.queryToFetch.toLowerCase()):"")},t.prototype.addParamsToUrl=function(n,t){if(t)for(var i in t)n+="&"+i+"="+t[i];return n},t.prototype.fetch=function(t,i,r,u,f,e,o){var h=this,s,c;if(n.isDataSourceEnabled(this.getDataSource(),t,this._config))if(s=this.addParamsToUrl(this.createUrl(t),e),c=this.getPostBody(t)||"",this._timer&&(sb_ct(this._timer),this._timer=null),this._delay>0&&!t.isFormulatedQuery)this._timer=sb_st(function(){return n.safeExecute(function(){sb_ct(h._timer);h._timer=null;h.onBeforeFetchUrl(r,s);h.fetchUrl(s,o,c,i,u,f)},"fetchDelay")},this._delay);else{this.onBeforeFetchUrl(r,s);this.fetchUrl(s,o,c,i,u,f)}},t.prototype.fetchUrl=function(t,r,u,f,e,o){var s=this;i(t,r,u,function(i){var r=i.responseText,o=i.contentType,u=i.status,e;u==200&&(s._config.th&&r&&(r=r.replace(new RegExp("<!--[^]*?-->","gm"),"")),r&&(!s._validateResponseType||o.includes("json"))&&(e=n.safeExecute(function(){return JSON.parse(r)},"parseWebProviderResponse",null,t)));f(s.getDataSource(),e,u==200?n.DataSourceStateFor200Response:u.toString())},this._delay>0?e:null,o)},t}();n.JsonDataProvider=t;r=function(t){function i(n,i,r){var u=t.call(this,n)||this;return u._instrumentationHelper=i,u._responseCacheManager=r,u}return __extends(i,t),i.prototype.getDataSource=function(){return n.WebDataSource},i.prototype.getBaseUrl=function(){return this._config.u},i.prototype.onBeforeFetchUrl=function(n,t){this._instrumentationHelper.instrumentSnRProviderFetchUrl(n,t)},i.prototype.fetch=function(i,r,u,f,e,o,s){var a=this,h=o,c=s,l;o&&this._config.passIGinHeader&&(c=Object.assign({},s),h=Object.assign({},o),h[n.Service.QueryParams.ImpressionGuid]&&(c[n.Service.Headers.ImpressionGuid]=h[n.Service.QueryParams.ImpressionGuid],delete h[n.Service.QueryParams.ImpressionGuid]));l=r;l=function(n,t,i,u){a.processResourceResponse(t);r(n,t,i,u)};this._responseCacheManager?this.fetchWithCache(i,l,u,f,e,h,c):t.prototype.fetch.call(this,i,l,u,f,e,h,c)},i.prototype.fetchWithCache=function(i,r,u,f,e,o,s){var a=this,v=!1,h,c,y,p,l;if(o&&o[n.Service.QueryParams.RequestElToken]=="1"&&(v=!0),h=i.getCacheKey(),c=this._responseCacheManager.tryGet(h),c&&!v){y=this.addParamsToUrl(this.createUrl(i),o);this.onBeforeFetchUrl(u,y);r(this.getDataSource(),c,n.DataSourceStateFor200Response,!0)}else p=function(){return!0},l=r,l=function(n,t,i){a.responseIsValidForCaching(i,t)&&a._responseCacheManager.put(h,t);e()&&r(n,t,i,!1)},t.prototype.fetch.call(this,i,l,u,f,p,o,s)},i.prototype.responseIsValidForCaching=function(t,i){return t==n.DataSourceStateFor200Response&&i!=null},i.prototype.processResourceResponse=function(n){var t,i;n&&(t=n.Resources,t)&&(this._downloadedStylesResources?this.updateWithDownloadedResources(t):this._downloadedStylesResources=t.Styles,i={Styles:t.Styles,Scripts:null},JsonInject.WriteHeadAndBeforeContentResources(i))},i.prototype.updateWithDownloadedResources=function(n){var t,i;for(t in n.Styles)for(i in n.Styles[t])this._downloadedStylesResources[t][i]?delete n.Styles[t][i]:this._downloadedStylesResources[t][i]=n.Styles[t][i]},i}(t);n.AsSuggestionsDataProvider=r;n.getIconFromOnlineResponse=u})(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function e(n,t,i,u,f){typeof indexedDB!="undefined"&&new r(n,f,t,i,u)}function o(n,t,i,u,f){typeof indexedDB!="undefined"&&new r(n,f,t,i,u)}function s(n,t,i,u,f,e){typeof indexedDB!="undefined"&&new r(n,e,t,i,u,f)}function h(n,t,i,u,f,e){typeof indexedDB!="undefined"&&new r(n,e,t,i,u,f)}function c(n,t,r){i(n,"deleteDatabase requested");try{var f=indexedDB.deleteDatabase(n);f.onsuccess=function(){i(n,"deleteDatabase completed");t&&t()};f.onerror=u("deleteDatabase.onError",function(t){SharedLogHelper.LogError("deleteDB",n,t);r&&r(t)})}catch(e){r&&r(e)}}function u(n,t){return function(i){var r=n;try{r+=" "+i.target.error.name}catch(u){}t(new Error(r))}}var f,i,r;(function(n){n.StorageNotAvailable="X";n.TimedOut="T";n.ErrorWhenQueryingDb="E";n.QuerySucceeded="R"})(f=t.StorageState||(t.StorageState={}));t.instanceWithNumberKeys=e;t.instanceWithStringKeys=o;t.instanceWithNumberKeysAndSecondaryKey=s;t.instanceWithStringKeysAndSecondaryKey=h;i=sa_config.th&&ClientTestHooks.isTesthookParamSet("dbTrace")?function(t,i){return n.log("["+t+"] "+i)}:function(){};t.deleteDatabase=c;t.handleErrorEvent=u;r=function(){function t(n,r,f,e,o,s){var h=this,c;this._databaseName=n;this.onClosed=o;this._secondaryIndex=s;this._closePending=!1;this._storeName=n+"Store";i(this._databaseName,"open requested");try{c=indexedDB.open(n,r||1)}catch(l){e(new Error("IndexedDbClientSideStorage.const: Could not open database"));return}c.onsuccess=function(n){h._database=n.target.result;t._allInstances.push(h);i(h._databaseName,"open completed");f(h)};c.onupgradeneeded=function(n){var t,r;i(h._databaseName,"upgrading");t=n.target.result;t.objectStoreNames.contains(h._storeName)&&t.deleteObjectStore(h._storeName);r=t.createObjectStore(h._storeName);h._secondaryIndex&&r.createIndex(h._secondaryIndex,h._secondaryIndex,{unique:!1})};c.onerror=u("open.onError",e);c.onblocked=u("open.onBlocked",e)}return t.prototype.put=function(n,t,i,r){this.safeDbOperation("put",n.toString(),"readwrite",i,function(i,r,u){var f=i.put(t,n);f.onsuccess=r;f.onerror=u},r)},t.prototype.putMultiple=function(n,t,i){this.safeDbOperation("putMultiple",n.length.toString(),"readwrite",t,function(t,i,r){var u=0,f=function(){if(u<n.length){var e=t.put(n[u].value,n[u].key);u+=1;e.onsuccess=u==n.length?i:f;e.onerror=r}};f()},i)},t.prototype.getValue=function(n,t,i){this.safeDbOperation("getValue",n.toString(),"readonly",function(n){return t(n.target.result)},function(t,i,r){var u=t.get(n);u.onsuccess=i;u.onerror=r},i)},t.prototype.getRange=function(n,t,i,r){var u=this;this.safeDbOperation("getRange","["+n+", "+t+")","readonly",i,function(i,r,f){var e=IDBKeyRange.bound(n,t,!1,!0);u.queryFromCursor(i.openCursor(e),r,f)},r)},t.prototype.getRangeOnSecondaryKey=function(n,t,i,r){var u=this;this._secondaryIndex?this.safeDbOperation("getRangeOnSecondaryKey","["+n+", "+t+")","readonly",i,function(i,r,f){var e=i.index(u._secondaryIndex),o=IDBKeyRange.bound(n,t,!1,!0);u.queryFromCursor(e.openCursor(o),r,f)},r):r(new Error("getRangeOnSecondaryKey: Index name is missing"))},t.prototype.removeRange=function(n,t,i,r){var u=this;this.safeDbOperation("removeRange","["+n+","+t+"]","readwrite",i,function(i,r,f){var e=IDBKeyRange.bound(n,t,!1,!0);u.removeFromCursor(i.openCursor(e),r,f)},r)},t.prototype.removeRangeOnSecondaryKey=function(n,t,i,r){var u=this;this._secondaryIndex?this.safeDbOperation("removeRangeOnSecondaryKey","["+n+","+t+"]","readwrite",i,function(i,r,f){var e=i.index(u._secondaryIndex),o=IDBKeyRange.bound(n,t,!1,!0);u.removeFromCursor(e.openCursor(o),r,f)},r):r(new Error("removeRangeOnSecondaryKey: Index name is missing"))},t.prototype.getAll=function(n,t){var i=this;this.safeDbOperation("getAll",null,"readonly",n,function(n,t,r){return i.queryFromCursor(n.openCursor(),t,r)},t)},t.prototype.close=function(){i(this._databaseName,"close requested");this.innerClose()},t.prototype.innerClose=function(){var f,e,r,u,o;if(t._requestsInProgress>0)i(this._databaseName,"delaying close because of "+t._requestsInProgress+" requests in progress"),this._closePending=!0;else for(f=function(t){t._database&&(n.safeExecute(function(){return t._database.close()},e._databaseName+".close"),i(t._databaseName,"close completed"),t._database=null,t.onClosed())},e=this,r=0,u=t._allInstances;r<u.length;r++)o=u[r],f(o)},t.prototype.queryFromCursor=function(n,t,i){var r=[];n.onsuccess=function(n){var i=n.target.result;i&&r.push({key:i.primaryKey,value:i.value});i&&r.length!=sa_config.maxIndexedDBCursorIterations?i["continue"]():t(r)};n.onerror=i},t.prototype.removeFromCursor=function(n,t,i){var r=0;n.onsuccess=function(n){var i=n.target.result;i&&(i["delete"](),r+=1);i&&r!=sa_config.maxIndexedDBCursorIterations?i["continue"]():t(null)};n.onerror=i},t.prototype.safeDbOperation=function(n,r,f,e,o,s){var h=this,l,c,a;i(this._databaseName,n+" requested"+(r?" "+r:""));t._requestsInProgress+=1;l=function(u){i(h._databaseName,n+" completed "+(r?r+" ":""));t._requestsInProgress-=1;e(u);h._closePending&&t._requestsInProgress==0&&h.innerClose()};c=function(n){t._requestsInProgress-=1;s(n);h._closePending&&t._requestsInProgress==0&&h.innerClose()};try{this._database?(a=this._database.transaction(this._storeName,f).objectStore(this._storeName),o(a,l,u(n+".onError",c))):c(new Error(n+" Database not initialized"))}catch(v){c(v)}},t}();r._requestsInProgress=0;r._allInstances=[]})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function i(n,t,i,r,u,f,e,o){var s=this;this._config=n;this._storageFactory=t;this.createResponse=i;this.dataPopulated=r;this.getDataSourceState=u;this._dataSource=f;this._queryType=e;this._storageOpenInProgress=!1;this._pendingQueries=[];o&&(o.bindAppVisible(function(){return s.initStorage()}),o.bindDismissed(function(){return s._pendingQueries=[]}),o.bindAppHidden(function(){return s.teardownStorage()}))}return i.prototype.teardownStorage=function(){this._storage&&this._storage.close()},i.prototype.initStorage=function(){var n=this;!this._storageOpenInProgress&&this.dataPopulated()&&(this._storageOpenInProgress=!0,this._storageFactory(function(t){n._storage=t;n._storageOpenInProgress=!1;n._pendingQueries.forEach(function(n){return n()});n._pendingQueries=[]},function(t){n.onError(t,"open storage");n._storageOpenInProgress=!1;n._pendingQueries.forEach(function(n){return n()});n._pendingQueries=[]},function(){return n._storage=null}))},i.prototype.onError=function(n,t){t!="open storage"&&SharedLogHelper.LogError(t,this._dataSource,n);this.teardownStorage()},i.prototype.reloadStorage=function(){this.teardownStorage();this.initStorage()},i.prototype.isReady=function(){return!!this._storage},i.prototype.getKey=function(n){return n.queryToFetch?n.queryToFetch.toLocaleLowerCase():""},i.prototype.fetch=function(i,r,u,f,e){var s=this,o;n.isDataSourceEnabled(this._dataSource,i,this._config)&&(o=function(n,u){var f=u==t.StorageState.QuerySucceeded;e()&&r(s._dataSource,s.createResponse(i,n,f),s.getDataSourceState(u))},this.innerQueryStorage(this._queryType,this.getKey(i),function(n){return o(n,t.StorageState.QuerySucceeded)},function(){return o(null,t.StorageState.ErrorWhenQueryingDb)},function(){return o(null,t.StorageState.StorageNotAvailable)},function(){return o(null,t.StorageState.TimedOut)}))},i.prototype.withStorage=function(n){return this._storage?(n(this._storage),!0):!1},i.prototype.getMaxKey=function(n){return n.slice(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)},i.prototype.queryStorage=function(n,t,i,r,u){this.innerQueryStorage(0,n,t,i,r,u)},i.prototype.innerQueryStorage=function(t,i,r,u,f,e){var h=this,s=null,o=!1,c=!0,a=function(){if(c)if(c=!1,h._storage){var n=function(n){s&&sb_ct(s);h.onError(n,"query");o||(o=!0,u())};t==0?h._storage.getValue(i,function(n){s&&sb_ct(s);o||(o=!0,r(n))},n):i?h._storage.getRange(i,h.getMaxKey(i),function(n){s&&sb_ct(s);o||(o=!0,r(n))},n):h._storage.getAll(function(n){s&&sb_ct(s);o||(o=!0,r(n))},n)}else s&&sb_ct(s),o||(o=!0,u())},l;if(this._storage)a();else if(this.initStorage(),this._storageOpenInProgress)this._pendingQueries.push(a);else{f();return}l=i?this._config.indexedDBTimeout:this._config.latencyTimeoutForZeroInput;l&&(s=sb_st(function(){return n.safeExecute(function(){c=!1;o||(o=!0,e())},"innerQueryStorage")},l))},i}();t.StorageBasedDataProvider=i})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function i(n,t,i,r){this._config=n;this._host=t;this._instrumentationHelper=i;this._temporaryMessageHandler=r}return i.prototype.parse=function(i,r,u,f,e,o,s){var l=this,a=[],d,h,c,g;if(this._config.mruCandidatesEnabled){var v=[],y=[],p=[],w=[],b=[],k=[];if(f&&f.Suggestions)for(d=function(u){var f,e;u.handoffType==2?t.isApp(u.type)?(f=u,v.push(f.id),w.push(f)):t.isSetting(u.type)?(f=u,y.push(f.id),b.push(f)):t.isFileOrFolder(u.type)&&(f=u,p.push(f.id),k.push(f)):n.isBrowserOnline()&&(e=n.safeExecute(function(){return l.parseMRUWebSuggestion(i,u,r)},"parseMRUWebSuggestion"),e&&a.push(e))},h=0,c=f.Suggestions;h<c.length;h++)g=c[h],d(g);t.lookupById(i,t.DataSources.MRUApps,null,v,w,function(n){return[n.id]},t.DataSources.MRUSettings,null,y,b,function(n){return n.id},e,r,o,s,function(n,t,u,f){return l.parseIdLookupResponse(i,r,n,t,u,f)},t.DataSources.MRUFilesAndFolders,p,k,function(n){return n.id},this._config,this._instrumentationHelper)}o(n.MRUDataSource,a,f)},i.prototype.parseIdLookupResponse=function(i,r,u,f,e,o){var s=this,h;e.length==1&&(h=function(n){return s.setupRemoveFromHistoryContextMenu(n,u,s._host),u.appContextData&&(n.appContext=u.appContextData.appContext,n.query=u.appContextData.query,n.text=i.queryToFetch?HitHighlightingParser.addMarkers(u.appContextData.textWithoutHH,i.queryToFetch):u.appContextData.textWithoutHH),s.setRankingSignals(n,u),!0},n.safeExecute(function(){return t.parseLocalSuggestion(i,e[0],f,r,s._host,s._config,s._temporaryMessageHandler,u.type,s._instrumentationHelper,o,h)},"parseLocalSuggestion "+f))},i.prototype.setRankingSignals=function(n,t){n.hc=t.hc;n.highConfidenceMetaSuggestionScore=t.highConfidenceMetaSuggestionScore;n.prefetchConfidenceScore=t.prefetchConfidenceScore;n.fromHistory=!0},i.prototype.parseMRUWebSuggestion=function(i,r,u){var f=t.createSuggestion(i.queryToFetch?HitHighlightingParser.addMarkers(r.textWithoutHH,i.queryToFetch):r.textWithoutHH,null,r.icon,r.type,r.query,n.InstrumentedItem.createInstrumentedItem(u),r.handoffType,u,!1),e,o,s;f.secondaryText=r.secondaryText;f.secondaryTextClass=t.CssClass_Annotation;this.setRankingSignals(f,r);switch(f.handoffType){case 5:case 4:if(!t.isCortanaEnabledCache)return null;e=r;t.setCat1SuggestionProperties(f,i,u,e.actionUri,e.taskFrame,e.confidence,e.source,this._host,this._config);break;case 10:if(!t.isCortanaEnabledCache)return null;o=r;t.setCat3SuggestionProperties(f,i,u,null,null,null,null,o.taskFrame,null,this._host,null,this._config);break;case 1:s=r;t.setUrlSuggestionProperties(f,i,u,s.url,this._host);break;default:return SharedLogHelper.LogError("parseMruWebSuggestion",null,new Error("Unexpected handoff type: "+r.handoffType)),null}return t.isValidSuggestion(f,"parseMruWebSuggestion")?(this.setupRemoveFromHistoryContextMenu(f,r,this._host),f):null},i.prototype.setupRemoveFromHistoryContextMenu=function(n,i,r){var u=this;i.remove&&t.setExtraVerbs(n,function(){if(!i.remove)return[];if(!n.removeIcon&&n.duplicates&&n.duplicates.some(function(n){return!n.fromHistory}))return[];var f={verb:t.Verbs.RemoveFromDeviceHistory,displayName:r.getLocString(t.Verbs.RemoveFromDeviceHistory),executeAsync:function(){return i.remove(function(){r.setQuery(null,!1,!0);u._temporaryMessageHandler.showTemporaryMessage(r.getLocString("RemovedFromDeviceHistory",HitHighlightingParser.removeMarkers(n.text)),{content:t.CortanaFontIcons.Info,type:2})}),delete i.remove,t.createVoidPromise()}};return[f]})},i}();t.MruParser=i})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){var i="LastUpdated",r=function(t){function r(r,u,f,e,o,s,h,c,l,a){var v=this;u&&u.bindItemLaunch(function(n,t,i){return v.onLaunch(n,t,i)});r.th&&ClientTestHooks.isTesthookParamSet("clearMru")&&sb_st(function(){return n.ClientSideStorage.deleteDatabase(c)},0);var y,p=function(t,r,u){return f(c,function(i){t(i);(!n.isValidDate(y)||n.getTimeDiffInDays(y)>=1)&&(y=new Date,v.prune())},r,u,i)},w=function(n,t,i){return v.createMruResponse(n,t,i)},b=function(){return!0},k=function(t){return t==n.ClientSideStorage.StorageState.QuerySucceeded?undefined:t};return e.bindClearMRURequested(function(t){v.teardownStorage();n.ClientSideStorage.deleteDatabase(c,function(){return t(!0)},function(){return t(!1)})}),v=t.call(this,r,p,w,b,k,n.MRUDataSource,1,e)||this,v.candidatesEnabled=l,v.loggingEnabled=a,v._rankingSignalKeyGenerator=o,v.getGroupType=h,v._suggestionKeyGenerator=s,v._pendingWrites=[],v}return __extends(r,t),r.prototype.shouldStoreSuggestions=function(){return this._config.mruCandidatesEnabled&&(!this.candidatesEnabled||this.candidatesEnabled())},r.prototype.createMruResponse=function(n,t,i){var c=this,f,s,u,o,h;if(t=t||[],f=this.getKey(n),this._lastKey=i?f:null,s=t.filter(function(n){return n.key==f})[0],this._valueForLastKey=s?s.value:null,u={},this._config.mruSignalsEnabled&&this._valueForLastKey&&(u.RankingSignals=this._valueForLastKey.RankingSignals,u.WebRankingSignalsCache=this._valueForLastKey.WebRankingSignalsCache,u.EngagementSignalsCache=this._valueForLastKey.EngagementSignalsCache,u.SuppressedGroupsCache=this._valueForLastKey.SuppressedGroupsCache),this.shouldStoreSuggestions()){var e=[],a=this.getOldestDateToKeep(),v=function(n,t){var f,i,u,o;if(t.Suggestions)for(f=function(i){var u=r.getLastLaunchTime(t,i,y._suggestionKeyGenerator);u&&u>=a&&(e.push({lastLaunchTime:u,suggestionData:i}),i.remove=function(t){return c.remove(n,i,t)})},i=0,u=t.Suggestions;i<u.length;i++)o=u[i],f(o)},y=this;for(o=0,h=t;o<h.length;o++){var l=h[o],p=l.key,w=l.value;v(p,w)}e.length>0&&(u.Suggestions=[],e.sort(function(n,t){return t.lastLaunchTime-n.lastLaunchTime}),e.forEach(function(n){return c.addIfNotPresent(u.Suggestions,n.suggestionData,!0)}),f?f.length<=this._config.mruLengthA?u.Suggestions.splice(this._config.maxMruA):f.length<=this._config.mruLengthB&&u.Suggestions.splice(this._config.maxMruB):u.Suggestions.splice(this._config.maxMruZeroInput))}return u},r.removeRankerSignals=function(n,t){return n=="highConfidenceMetaSuggestionScore"||n=="prefetchConfidenceScore"?undefined:t},r.prototype.addIfNotPresent=function(n,t,i){var e=JSON.stringify(t,r.removeRankerSignals),u=n.filter(function(n){return JSON.stringify(n,r.removeRankerSignals)==e})[0],f;u?i&&(f=u.remove,u.remove=function(n){return f(function(){return t.remove(n)})}):n.push(t)},r.prototype.onAfterWrite=function(){if(this._writing=!1,this._pendingWrites.length>0){var n=this._pendingWrites.shift();n()}else this._tearDownPending&&this.teardownStorage()},r.prototype.teardownStorage=function(){this._writing?this._tearDownPending=!0:(this._tearDownPending=!1,t.prototype.teardownStorage.call(this))},r.prototype.onLaunch=function(t,i,r){var u=this,e,f;if(!this.loggingEnabled||this.loggingEnabled()){if(this._writing){this._pendingWrites.push(function(){return u.onLaunch(t,i,r)});return}this._writing=!0;e=r?r[n.WebDataSource]:null;f=this.getKey(i);this._lastKey==f?this.updateAndSaveLaunchData(f,this._valueForLastKey,t,e):this.queryStorage(f,function(n){return u.updateAndSaveLaunchData(f,n,t,e)},function(){return u.onAfterWrite()},function(){return u.onAfterWrite()},function(){return u.onAfterWrite()})}},r.prototype.remove=function(n,t,i){var r=this;if(this._writing){this._pendingWrites.push(function(){return r.remove(n,t,i)});return}this._writing=!0;this._lastKey==n?this.removeAndSaveLaunchData(n,this._valueForLastKey,t,i):this.queryStorage(n,function(u){return r.removeAndSaveLaunchData(n,u,t,i)},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()})},r.getUnixTime=function(n){return n||(n=new Date),Math.round(n.getTime()/1e3)},r.prototype.createOrUpdateDbEntry=function(n,t,i,u){var f,e;return t?(t.LastUpdated=r.getUnixTime(),t.RankingSignals=t.RankingSignals||{}):t={LastUpdated:r.getUnixTime(),RankingSignals:{}},f=this._rankingSignalKeyGenerator(i),t.RankingSignals[f]?(t.RankingSignals[f].prefixLaunchCount+=1,t.RankingSignals[f].lastLaunchTime=t.LastUpdated):t.RankingSignals[f]={prefixLaunchCount:1,lastLaunchTime:t.LastUpdated},this.getGroupType&&(t.RankingSignals[f].groupType=this.getGroupType(i,this._config)),this._config.mruSignalsEnabled&&u&&(t.WebRankingSignalsCache=u.rankingSignals,t.EngagementSignalsCache=u.engagementSignals,t.SuppressedGroupsCache=u.suppressedGroups),this.shouldStoreSuggestions()&&(e=i.getMruData(),e&&n&&(t.Suggestions||(t.Suggestions=[]),this.addIfNotPresent(t.Suggestions,e,!1)),t.Suggestions&&t.Suggestions.forEach(function(n){return delete n.remove})),t},r.prototype.getOldestDateToKeep=function(){var n=new Date;return n.setDate(n.getDate()-this._config.mruMaxAgeInDays),r.getUnixTime(n)},r.prototype.updateAndSaveLaunchData=function(t,i,u,f){var e=this;if(i=n.safeExecute(function(){return e.createOrUpdateDbEntry(t,i,u,f)},"createOrUpdateDbEntry"),!i){this.onAfterWrite();return}this._suggestionKeyGenerator&&r.removeOldLaunches(i,this.getOldestDateToKeep(),this._suggestionKeyGenerator);this._lastKey=t;this._valueForLastKey=i;this.withStorage(function(n){return n.put(t,i,function(){return e.onAfterWrite()},function(n){e.onError(n,"updateAndSaveLaunchData");e.onAfterWrite()})})||this.onAfterWrite()},r.prototype.removeAndSaveLaunchData=function(n,t,i,r){var u=this,e,f;if(!t){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("MRU entry not present"));this.onAfterWrite();return}if(e=JSON.stringify(i),f=(t.Suggestions||[]).findIndex(function(n){return JSON.stringify(n)==e}),f==-1){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("Suggestion not present in MRU"));this.onAfterWrite();return}t.Suggestions.splice(f,1);t.Suggestions.forEach(function(n){return delete n.remove});this._lastKey=n;this._valueForLastKey=t;this.withStorage(function(i){return i.put(n,t,function(){r&&r();u.onAfterWrite()},function(n){u.onError(n,"removeAndSaveLaunchData");u.onAfterWrite()})})||this.onAfterWrite()},r.getLastLaunchTime=function(n,t,i){if(n.RankingSignals){var r=n.RankingSignals[i(t)];if(r)return r.lastLaunchTime}return undefined},r.removeOldLaunches=function(n,t,i){var f,e,o,u;if(n.Suggestions)for(f=n.Suggestions.length-1;f>=0;--f)u=r.getLastLaunchTime(n,n.Suggestions[f],i),(!u||u<t)&&n.Suggestions.splice(f,1);if(n.RankingSignals)for(e in n.RankingSignals)o=n.RankingSignals[e],o&&(u=o.lastLaunchTime,(!u||u<t)&&delete n.RankingSignals[e])},r.prototype.prune=function(n){var t=this;if(this._writing){this._pendingWrites.push(function(){return t.prune(n)});return}this._writing=!0;this.withStorage(function(i){return i.removeRangeOnSecondaryKey(0,t.getOldestDateToKeep(),function(){n&&n();t.onAfterWrite()},function(n){t.onError(n,"MRUDataProvider prune");t.onAfterWrite()})})||this.onAfterWrite()},r}(n.ClientSideStorage.StorageBasedDataProvider);t.MRUDataProvider=r})(t=n.MRU||(n.MRU={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(i){function gt(n){r||h();var t=r[n];if(!t)throw new Error("Unsupported data source: "+n);return t}function ni(n){return r||h(),!!r[n]}function h(){var i=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getUserSID(),e=l(1,i),n=l(0,i),o=(t.isMobileCache?"\"System.Kind\" != ANY ARRAY['Movie', 'Picture', 'RecordedTV', 'Video', 'Music', 'link', 'program', 'folder', 'calendar', 'game', 'web history', 'feed', 'contact', 'task', 'journal', 'note', 'instantmessage']":"\"System.Kind\" != ANY ARRAY['Movie', 'Picture', 'RecordedTV', 'Video', 'Music', 'link', 'program', 'calendar', 'game', 'web history', 'feed', 'contact', 'task', 'journal', 'note', 'instantmessage']")+" AND "+e,s="SCOPE = 'winrt://{"+i+"}/LS/Microsoft.MicrosoftEdge_8wekyb3d8bbwe/spartan history'",h="\"System.Kind\" = SOME ARRAY['Movie', 'Picture', 'RecordedTV', 'Video', 'Music'] AND "+e,c="\"System.Kind\" != ANY ARRAY['Movie', 'Picture', 'RecordedTV', 'Video', 'Music', 'link', 'program', 'folder', 'calendar', 'game', 'web history', 'feed', 'contact', 'task', 'journal', 'note', 'instantmessage'] AND "+n,a="\"System.Kind\" = SOME ARRAY['folder'] AND "+n,v="\"System.Kind\" = SOME ARRAY['Music'] AND "+n,y="\"System.Kind\" = SOME ARRAY['Picture'] AND "+n,p="\"System.Kind\" = SOME ARRAY['Movie', 'RecordedTV', 'Video'] AND "+n;r={};r[t.DataSources.LocalDocumentsAndFolders]={selectFields:f.concat(w),filterFields:k,mostRelevantProps:b,kindClause:o,sortClause:u,searchOptions:3};r[t.DataSources.LocalMedia]={selectFields:f.concat(d),filterFields:nt,mostRelevantProps:g,kindClause:h,sortClause:u,searchOptions:3};r[t.DataSources.EdgeBrowsingHistory]={selectFields:tt,filterFields:rt,mostRelevantProps:it,kindClause:s,sortClause:ut,searchOptions:7};r[t.DataSources.MyStuffDocuments]={selectFields:f.concat(ft),filterFields:ot,mostRelevantProps:et,kindClause:c,sortClause:u,searchOptions:3};r[t.DataSources.MyStuffFolders]={selectFields:f.concat(st),filterFields:ct,mostRelevantProps:ht,kindClause:a,sortClause:u,searchOptions:3};r[t.DataSources.MyStuffPhotos]={selectFields:f.concat(lt),filterFields:vt,mostRelevantProps:at,kindClause:y,sortClause:u,searchOptions:3};r[t.DataSources.MyStuffVideos]={selectFields:f.concat(yt),filterFields:wt,mostRelevantProps:pt,kindClause:p,sortClause:u,searchOptions:3};r[t.DataSources.MyStuffMusic]={selectFields:f.concat(bt),filterFields:dt,mostRelevantProps:kt,kindClause:v,sortClause:u,searchOptions:3}}function ti(n,t,i){return oi(n).then(function(r){return ii(n,r,t,i)})}function ii(n,t,i,r){var u=gt(r);return"SELECT TOP "+i+" "+ui(u.selectFields)+" FROM SystemIndex WHERE "+fi(u,n,t,u.searchOptions)+" ORDER BY "+u.sortClause}function ri(n){return{displayName:n.displayName,id:n.id,kind:n.kind,equals:function(t){return n.equals(t)},getProperty:function(t){return n.getMarkedProperty(t)},getMarkedProperty:function(t){return n.getMarkedProperty(t)},propertyHits:n.propertyHits,rankScore:n.rankScore,url:n.getProperty("System.Link.TargetUrl"),title:n.getProperty("System.Title"),visitCount:n.getProperty("System.History.VisitCount"),dateVisited:n.getProperty("System.Link.DateVisited")}}function ui(n){return n.map(function(n){return n=="System.ParsingPath"?"path":'"'+n+'"'}).join(",")}function fi(n,t,i,r){return"WITH ("+n.mostRelevantProps.join(", ")+") AS #MRProps ("+si(n,t,i,r)+") AND "+n.kindClause}function ei(n,t){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.tokenize(n,t)}function oi(n){return SearchAppWrapper.CortanaApp.queryFormulationView.getLinguisticDataAsync(n)}function si(t,i,r,u){var a=[i],h,f,e,c,v,o,s,l,y;for(r.alternatives&&r.alternatives.forEach(function(n){return a.push(n)}),h=a.map(function(n){return li(n)}),e=0,c=t.filterFields;e<c.length;e++){for(v=c[e],o=!1,s=0,l=h;s<l.length;s++)y=l[s],f?f+=o?" OR ":" OR (":f="(",f+=n.formatString(v,[y]),o=!0;o&&(f+=")")}return(u&2)==2&&(f=hi(u,r,i,h,f)),f}function hi(t,i,r,u,f){for(var d,o,h,y,c,e,l,b,g,nt=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getLCIDStringForText(r),tt=ci(t),a=!1,v=0,k=tt;v<k.length;v++){for(d=k[v],o=!1,h=0,y=u;h<y.length;h++){var it=y[h],p=[],w=ei(it,i.language);if((t&4)==0||w.length<=s)for(c=0;c<Math.min(w.length,s);++c)p.push(w[c]);if(p.length>1){for(e="",l=0,b=p;l<b.length;l++)g=b[l],e&&(e+=" AND "),e+='"'+g+(a?'*"':'"');f?f+=o?" OR ":" OR (":f="(";f+=n.formatString(d,[e,nt]);o=!0}}o&&(f+=")");a=!a}return f}function ci(n){var t=[];return t.push("CONTAINS(#MRProps, '{0}', {1}) RANK BY COERCION(ABSOLUTE, 600)"),(n&1)==1&&t.push("CONTAINS(#MRProps, '{0}', {1}) RANK BY COERCION(ABSOLUTE, 550)"),t}function e(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getFolderPathFromKnownFolderIdGuid(n)}function c(n,t){return n=n.replace(/'/g,"''"),n=n.replace(/"/g," "),t>=2&&(n=n.replace(/%/g,"[%]"),n=n.replace(/_/g,"[_]"),n=n.replace(/\[/g,"[[]"),t==3?(n=n.replace(/\*/g,"%"),n=n.replace(/\?/g,"_")):(n=n.replace(/\*/g," "),n=n.replace(/\?/g," "))),n}function o(n){return c(n,1)}function li(n){return c(n,2)}function l(n,i){var r="NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['hidden'] AND NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['system'] AND NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['link']",h,u;if(r+=t.isMobileCache?" AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['stream']":" AND (System.Shell.SFGAOFlagsStrings = SOME ARRAY['stream'] OR (System.Shell.SFGAOFlagsStrings = SOME ARRAY['fileanc'] AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['folder']) OR (System.Shell.SFGAOFlagsStrings = SOME ARRAY['storageanc'] AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['folder']))",r+=" AND System.Shell.OmitFromView != 'true'",t.isMobileCache)return h=e(y),u=o(h),r+" AND (Scope = 'file:"+u+"') AND (Scope <> 'file:"+u+"\\AppData') AND (Scope <> 'mapi15://')";var l=e(p),w=e(a),b=e(v),c=o(l),f=o(w),k=o(b),s="csc://{"+i+"}";switch(n){case 0:return r+=" AND (Scope = 'file://' or Scope = '"+s+"')",r+" AND (Scope <> 'file:"+f+"\\AppData') AND (Scope <> 'file:"+c+"\\Default\\AppData') AND (Scope <> 'file:"+c+"\\Administrator\\AppData') AND (Scope <> 'file:"+k+"') AND (Scope <> 'mapi15://')";case 1:return r+=" AND ((Scope = 'file:"+f+"') AND (Scope <> 'file:"+f+"\\AppData') AND (Scope <> 'mapi15://')",r+=" OR (Scope = '"+s+"')",r+")";case 2:return r+(" AND (Scope = 'file://' or Scope = '"+s+"') AND (Scope <> 'mapi15://')");default:throw new Error("Unknown DeviceSearchScenario: "+n);}}var a="{5E6C858F-0E22-4760-9AFE-EA3317B67173}",v="{905e63b6-c1bf-494e-b29c-65b732d3d21a}",y="{DFDF76A2-C82A-4D63-906A-5644AC457385}",p="{0762D272-C50A-4BB0-A382-697DCD729B80}",s=3,u='"System.Search.Rank" DESC, "System.DateModified" DESC, "System.ItemNameDisplay" ASC',f=["System.Kind","System.Search.Rank","System.ParsingPath","System.DateCreated","System.DateModified","System.Search.QueryPropertyHits","System.ItemNameDisplay","System.ItemFolderPathDisplay","System.FileExtension","System.ItemType",],w=[],b=["System.ItemNameDisplay",],k=["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.ItemNameDisplay LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 995)","CONTAINS(System.ItemNameDisplay, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 899)","CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)",],d=["System.Music.Artist","System.Music.AlbumTitle",],g=["System.ItemNameDisplay","System.Music.Artist","System.Music.AlbumTitle",],nt=["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 990)","System.ItemNameDisplay LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 980)","CONTAINS(System.ItemNameDisplay, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 970)","CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 960)","System.Title = '{0}' RANK BY COERCION(ABSOLUTE, 890)","System.Title LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 880)","CONTAINS(System.Title, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 870)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 860)","System.Music.Artist = '{0}' RANK BY COERCION(ABSOLUTE, 790)","CONTAINS(System.Music.Artist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 760)","System.Music.AlbumTitle = '{0}' RANK BY COERCION(ABSOLUTE, 690)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 660)",],tt=["System.ItemNameDisplay","System.Search.QueryPropertyHits","System.Kind","System.Search.Rank","System.Link.TargetUrl","System.Title","System.History.VisitCount","System.Link.DateVisited",],it=["System.Link.TargetUrl","System.Title",],rt=["(System.Link.TargetUrl LIKE 'http%' AND CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 1000))","(System.Link.TargetUrl LIKE 'http%' AND CONTAINS(System.Link.TargetUrl, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 995))",],ut='"System.History.VisitCount" DESC, "System.Link.DateVisited" DESC, "System.Title" ASC',ft=["System.Search.AutoSummary",],et=["System.ItemNameDisplay","System.Keywords","System.Title",],ot=["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.ItemNameDisplay LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 995)","CONTAINS(System.ItemNameDisplay, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 899)","CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","System.Title = '{0}' RANK BY COERCION(ABSOLUTE, 980)","System.Title LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 975)","CONTAINS(System.Title, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 880)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","System.Keywords = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Keywords LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 955)","CONTAINS(System.Keywords, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Search.Contents, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 545)",],st=[],ht=["System.ItemNameDisplay",],ct=["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.ItemNameDisplay LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 995)","CONTAINS(System.ItemNameDisplay, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 899)","CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)",],lt=[],at=["System.ItemNameDisplay","System.Keywords","System.ItemFolderPathDisplay",],vt=["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.ItemNameDisplay LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 995)","CONTAINS(System.ItemNameDisplay, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 899)","CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","System.Title = '{0}' RANK BY COERCION(ABSOLUTE, 980)","System.Title LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 975)","CONTAINS(System.Title, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 880)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","System.Keywords = '{0}' RANK BY COERCION(ABSOLUTE, 940)","System.Keywords LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 935)","CONTAINS(System.Keywords, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 840)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",],yt=[],pt=["System.ItemNameDisplay","System.Title","System.Keywords","System.ItemFolderPathDisplay",],wt=["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.ItemNameDisplay LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 995)","CONTAINS(System.ItemNameDisplay, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 899)","CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","System.Title = '{0}' RANK BY COERCION(ABSOLUTE, 980)","System.Title LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 975)","CONTAINS(System.Title, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 880)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","System.Music.AlbumTitle = '{0}' RANK BY COERCION(ABSOLUTE, 970)","System.Music.AlbumTitle LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 965)","CONTAINS(System.Music.AlbumTitle, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 870)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 865)","System.Music.AlbumArtist = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Music.AlbumArtist LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 955)","CONTAINS(System.Music.AlbumArtist, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Music.AlbumArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","System.Music.Artist = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Music.Artist LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 955)","CONTAINS(System.Music.Artist, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Music.Artist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","System.Music.Genre = '{0}' RANK BY COERCION(ABSOLUTE, 950)","System.Music.Genre LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 945)","CONTAINS(System.Music.Genre, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 850)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)","System.Keywords = '{0}' RANK BY COERCION(ABSOLUTE, 940)","System.Keywords LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 935)","CONTAINS(System.Keywords, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 840)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",],bt=["System.Music.AlbumTitle","System.Music.Artist","System.Title",],kt=["System.ItemNameDisplay","System.Title","System.Music.AlbumTitle",],dt=["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.ItemNameDisplay LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 995)","CONTAINS(System.ItemNameDisplay, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 899)","CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","System.Title = '{0}' RANK BY COERCION(ABSOLUTE, 980)","System.Title LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 975)","CONTAINS(System.Title, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 880)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","System.Music.AlbumTitle = '{0}' RANK BY COERCION(ABSOLUTE, 970)","System.Music.AlbumTitle LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 965)","CONTAINS(System.Music.AlbumTitle, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 870)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 865)","System.Music.AlbumArtist = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Music.AlbumArtist LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 955)","CONTAINS(System.Music.AlbumArtist, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Music.AlbumArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","System.Music.Artist = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Music.Artist LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 955)","CONTAINS(System.Music.Artist, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Music.Artist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","System.Music.Genre = '{0}' RANK BY COERCION(ABSOLUTE, 950)","System.Music.Genre LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 945)","CONTAINS(System.Music.Genre, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 850)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)","System.Keywords = '{0}' RANK BY COERCION(ABSOLUTE, 940)","System.Keywords LIKE '{0}%' RANK BY COERCION(ABSOLUTE, 935)","CONTAINS(System.Keywords, '\"{0}\"') RANK BY COERCION(ABSOLUTE, 840)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",],r;i.dataSourceSupported=ni;i.generateIndexerQueryAsync=ti;i.toBrowsingHistoryItem=ri})(i=t.IndexerQueryGenerator||(t.IndexerQueryGenerator={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function s(n,i,r,u,f,e){var o=u?r+" "+i:r;return t.Promise.safeChainWithGlobalCaching("getIcon",function(i){return n.getImageAsync(t.getImageSizeValue(i))},function(n){return n+"_"+i},function(n){return t.toIcon(n,"getIcon",f,e,o)},f,o)}function i(n,i,r,u,f,e){return{deviceItem:n,getIcon:s(n,n.id,r,!t.localDataSourceMayContainPII(r),u,f),icon:e?u:null,suggestionType:i}}function e(n,t,i){return{deviceItem:n,icon:i,suggestionType:t}}function r(i,r,u){switch(i){case"picture":return r&&n.contains(h,r.toLowerCase())?t.LocalSuggestionTypes.Document:t.LocalSuggestionTypes.Photo;case"video":return r&&n.contains(c,r.toLowerCase())?t.LocalSuggestionTypes.Document:t.LocalSuggestionTypes.Video;case"movie":case"recordedtv":return t.LocalSuggestionTypes.Video;case"music":return t.LocalSuggestionTypes.Music;case"folder":return t.LocalSuggestionTypes.Folder;default:return u}}function o(i,r,u,f,e,o,s,h,c){n.safeExecute(function(){var n,l,v,a,y;if(i.length==0)r({});else{if(n={},l=i.slice(0),h)for(v=i.length-1;v>=0;--v)a=i[v],h.hasOwnProperty(a)&&(n[a]=h[a],c&&n[a]&&(n[a].suggestionType=c),l.splice(v,1));l.length==0?r(n):(y=t.localDataSourceMayContainPII(f)?f:f+" "+l,t.Promise.safeChain(e,function(){return o(l)},function(u){var e=t.Map.map(l,u,function(n){return s(n)}),f;if(h&&l.forEach(function(n){return h[n]=e[n]}),l.length!=i.length)for(f in n)n.hasOwnProperty(f)&&(e[f]=n[f]);r(e)},function(){return r({})},u,y))}},"resolveIdsWithCache",null,f,function(){return r({})})}function ht(n,t){if(!t.launchArguments||st.test(n.query))return!0;var i=t.id.toLowerCase();return g.some(function(n){return i.includes(n)})?!0:!1}function nt(t,i,r,u){var f;if(i.queryToFetch.length>=r.filterCICandidatesPrefixLength&&!r.filterCICandidatesLogisticRegression&&!r.filterCIGrammar||!t.rawIndexResponse||t.rawIndexResponse.length==0)return!1;var o=t.displayName.toLocaleLowerCase(),e=i.queryToFetch.toLocaleLowerCase(),s=null;if(r.filterCIGrammar&&(f=n.safeExecute(function(){return JSON.parse(t.rawIndexResponse)},"parseConstraintIndexMetaData"),f&&f.Parses&&f.Parses.length>0&&f.Parses[0].SubParses&&f.Parses[0].SubParses.length>1&&f.Parses[0].SubParses[0].Interpretation&&f.Parses[0].SubParses[0].Interpretation==="regex"&&e.length>=f.Parses[0].SubParses[0].QueryEnd)){if(e.length===f.Parses[0].SubParses[0].QueryEnd)return!0;e=e.substr(f.Parses[0].SubParses[0].QueryEnd+1)}return e.length<r.filterCICandidatesPrefixLength&&!tt(e,o)&&(s=HitHighlightingParser.addMarkers(o,e).includes(HitHighlightingParser.startMarker),!s)?!0:r.filterCICandidatesLogisticRegression&&vt(o,e,t,u,r.filterCICandidatesPrefixLength,s)?!0:!1}function vt(t,i,r,u,f,e){var o=n.safeExecute(function(){return JSON.parse(r.rawIndexResponse)},"parseConstraintIndexMetaData"),s;if(!i||!o||!o.MatchScore||!o.Parses||o.Parses.length==0||!o.Parses[0].Entities||o.Parses[0].Entities.length==0||!o.Query||(s=o.Query,e===null&&(e=HitHighlightingParser.addMarkers(t,i).includes(HitHighlightingParser.startMarker)),e)||s.startsWith(i))return!1;var h=u?1:0,c=n.getEditDistanceIgnoreCase(i,t),l=1-c/Math.max(i.length,t.length),a=.03614106*h+-.62339747*(1-h)+-3.80866838*(o.MatchScore/64e3)+.09512757*(o.Parses[0].Entities[0].EntityScore/64e3)+3.8874507*l+.10408701*i.length+.0167873558*t.length+-.5890491,v=1/(1+Math.exp(-a));return v<.4?!0:!1}function tt(n,t){var r,i;if(!!t&&t.length==0||(r=t.split(" "),n.length!=r.length))return!1;for(i=0;i<r.length;i++)if(r[i].length==0||r[i][0]!=n[i])return!1;return!0}function it(n){var i=n.id.toLowerCase(),t;if(i.startsWith("http:")||i.startsWith("https:"))return 1;if(i.startsWith("file:"))return 0;if(t=n.filePath,t){if(t=t.toLowerCase(),t.startsWith("http:")||t.startsWith("https:"))return 1;if(t.startsWith("file:"))return 0}return 2}function rt(n,i){if(i.dataSource==t.DataSources.LocalApps){if(n.kind=="document")return t.LocalSuggestionTypes.StartMenuDocument;var r=it(n);if(r==0)return t.LocalSuggestionTypes.StartMenuDocument;if(r==1)return t.LocalSuggestionTypes.StartMenuUrl}return i.getSuggestionType(n)}function ut(i,r,u,f,e){var b,s,p,a,w,c,o,v,l,h;if(t.isMobileCache)return!1;if(t.isApp(f))return(b=u.id,n.contains(ct,b))?!0:nt(u,r,i,!0)?!0:(s=u.kind,s&&(s=s.toLowerCase(),s!="program"&&s!="unknown"))?!0:e!=t.DataSources.LocalApps&&it(u)!=2?!0:(p=u.extension,p&&p.toLowerCase()==".chm")?!0:!1;if(t.isSetting(f))return nt(u,r,i,!1)?!0:!1;if(f==t.LocalSuggestionTypes.BrowsingHistory)return(a=u,w=a.url,n.olderThan2Weeks(a.dateVisited)||n.isBingSearchUrl(w))?!0:r.queryToFetch?n.getProtocol(r.fixedUrl||r.queryToFetch)==0&&n.contains(a.propertyHits,"System.Title")?!1:!n.matchesOnDomain(w,r):!1;if(t.isItemWithFileMetadata(f)){if((c=u,e==t.DataSources.MyStuffDocuments&&c.propertyHits.length==1&&c.propertyHits[0]=="System.Search.Contents"&&(!i.minLengthForContentMatch||r.queryToFetch.length<i.minLengthForContentMatch))||(o=c.id,o&&(o.includes("\\.")||o.includes("/.")||(o=o.toLowerCase(),at.some(function(n){return o.includes(n)}))))||(v=c.extension,v&&!r.queryToFetch.toLowerCase().includes(v.toLowerCase())&&n.contains(lt,v.toLowerCase())))return!0;if(f==t.LocalSuggestionTypes.CommandLine){if(l=u,h=l.displayName.split(" ")[0].toLowerCase(),h.includes("\\")||h.indexOf(":")==1)return!1;var y=l.id.toLowerCase(),k=y.lastIndexOf("."),d=y.lastIndexOf("\\"),tt=l.kind=="folder"||k<0||k<d;if(tt&&!h.includes("%")||![".exe",".com"].some(function(n){return h.includes(n)})&&(et.some(function(n){return y.includes(n)})||!l.launchArguments&&g.some(function(n){return y.includes(n)})||n.contains(ot,h)))return!0}return!1}return!1}var h,c,ft,u;t.getIcon=s;h=[".dwg",".ai",".psd"];c=[".ts"];t.getSuggestionTypeFromKindAndExtension=r;var l={getResultsContainer:function(n){return n.apps},dataSource:t.DataSources.LocalApps,getSuggestionType:function(){return t.LocalSuggestionTypes.App},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,r,u){return i(n,r,u,t.ScopeConfig[t.Scope.Apps].icon,n.isImmersive?n.logoBackgroundColor:undefined)},supportsEmptyQuery:!0},a={getResultsContainer:function(n){return n.settings},dataSource:t.DataSources.LocalSettings,getSuggestionType:function(){return t.LocalSuggestionTypes.Setting},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,r,u){if(t.isModernSetting(n)){var f=n.glyph,o=f?{content:f,type:1}:t.ScopeConfig[t.Scope.Settings].icon;return e(n,r,o)}return i(n,r,u,t.ScopeConfig[t.Scope.Settings].icon)},supportsEmptyQuery:!1},v=[l,a,{getResultsContainer:function(n){return n.media},dataSource:t.DataSources.LocalMedia,getSuggestionType:function(n){return r(n.kind,n.extension,t.LocalSuggestionTypes.Document)},maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},{getResultsContainer:function(n){return n.files},dataSource:t.DataSources.LocalDocumentsAndFolders,getSuggestionType:function(n){return r(n.kind,n.extension,t.LocalSuggestionTypes.Document)},maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},{getResultsContainer:function(n){return n.powerBi},dataSource:t.DataSources.PowerBi,getSuggestionType:function(){return t.LocalSuggestionTypes.PowerBi},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,i){return e(n,i,{content:t.CortanaFontIcons.PowerBILogo,type:2})},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.browsingHistory},dataSource:t.DataSources.EdgeBrowsingHistory,getSuggestionType:function(){return t.LocalSuggestionTypes.BrowsingHistory},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,t){return e(n,t,null)},supportsEmptyQuery:!0},{getResultsContainer:function(n){return n.experimentalProvider?n.experimentalProvider[0]:undefined},dataSource:t.DataSources.Experimental,getSuggestionType:function(){return t.LocalSuggestionTypes.Experimental},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,getGroupDisplayName:function(n){return n.getFolderName()},supportsEmptyQuery:!1},],y=[{getResultsContainer:function(n){return n.files},dataSource:t.DataSources.MyStuffDocuments,getSuggestionType:function(){return t.LocalSuggestionTypes.Document},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,r,u){return i(n,r,u,t.ScopeConfig[t.Scope.Documents].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.folders},dataSource:t.DataSources.MyStuffFolders,getSuggestionType:function(){return t.LocalSuggestionTypes.Folder},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,r,u){return i(n,r,u,t.ScopeConfig[t.Scope.Folders].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.pictures},dataSource:t.DataSources.MyStuffPhotos,getSuggestionType:function(n){return r(n.kind,n.extension,t.LocalSuggestionTypes.Photo)},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,r,u){return i(n,r,u,t.ScopeConfig[t.Scope.Photos].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.video},dataSource:t.DataSources.MyStuffVideos,getSuggestionType:function(n){return r(n.kind,n.extension,t.LocalSuggestionTypes.Video)},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,r,u){return i(n,r,u,t.ScopeConfig[t.Scope.Videos].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.music},dataSource:t.DataSources.MyStuffMusic,getSuggestionType:function(){return t.LocalSuggestionTypes.Music},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(n,r,u){return i(n,r,u,t.ScopeConfig[t.Scope.Music].icon,null,!0)},supportsEmptyQuery:!1},],p=[{getResultsContainer:function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.startPathCompletionQuery(n.originalQuery,"")},dataSource:t.DataSources.PathCompletion,getSuggestionType:function(){return t.LocalSuggestionTypes.PathCompletion},maxUpTo3chars:15,maxAfter3chars:15,maxAfter8charsOrInL2ZeroInput:15,customCancellation:function(){return SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastPathCompletionQuery()},supportsEmptyQuery:!1},{getResultsContainer:function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getRecentAppsAsync()},getResults:function(n){return n},dataSource:t.DataSources.LocalRecentApps,getSuggestionType:function(){return t.LocalSuggestionTypes.App},maxUpTo3chars:undefined,maxAfter3chars:undefined,maxAfter8charsOrInL2ZeroInput:undefined,customCreateLocalResponseSuggestion:function(n,r,u){return i(n,r,u,t.ScopeConfig[t.Scope.Apps].icon,n.isImmersive?n.logoBackgroundColor:undefined)},supportsEmptyQuery:!0}],w=[{getResultsContainer:function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.startCommandLineQuery(n.originalQuery,"")},dataSource:t.DataSources.CommandLine,getSuggestionType:function(){return t.LocalSuggestionTypes.CommandLine},customCancellation:function(){return SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastCommandLineQuery()},supportsEmptyQuery:!1},];t.LocalDataProviderDataSources=v.concat(y).concat(p).concat(w).map(function(n){return n.dataSource});var f={suggestions:[]},b={},k={},d={};var et=["\\system32\\user.exe","\\system32\\sidebar.exe","\\system32\\at.exe","\\system32\\change.exe","\\system32\\control.exe","\\system32\\find.exe","\\system32\\net.exe","\\system32\\share.exe","\\system32\\rundll32.exe","\\system32\\append.exe","\\system32\\choice.exe","\\system32\\clip.exe","\\system32\\comp.exe","\\system32\\compact.exe","\\system32\\consent.exe","\\system32\\convert.exe","\\system32\\format.exe","\\system32\\graphics.com","\\system32\\label.exe","\\system32\\mem.exe","\\system32\\mode.com","\\system32\\more.com","\\system32\\recover.exe","\\system32\\replace.exe","\\system32\\reset.exe","\\system32\\shadow.exe","\\system32\\sort.exe","\\system32\\tree.com","\\system32\\webcam.exe","\\system32\\systemsettings.exe","\\system32\\command.com","\\system32\\tabtip.exe","\\system32\\services.exe","\\system32\\help.exe","\\system32\\where.exe","\\system32\\skydrive.exe","\\system32\\calc.exe","\\system32\\fc.exe","\\accessories\\wordpad.exe",],g=["\\system32\\finger.exe","\\system32\\ping.exe","\\system32\\print.exe","\\system32\\shutdown.exe","\\system32\\expand.exe","\\system32\\tskill.exe","\\system32\\reg.exe","\\system32\\sc.exe",],ot=["uninstall","outlook","excel","skype","nero","onenote","lync","vmware","firefox","itunes","photoshop","print","opera","visio","thunderbird","smartscreen"],st=/[\/\.\-\\]/;t.isRealCommand=ht;var ct=["Microsoft.Cortana_8wekyb3d8bbwe!CortanaUI","Microsoft.Windows.Cortana_cw5n1h2txyewy!CortanaUI",],lt=[".dll",".pdb",".obj",".bin",".etl",".bak",".config",".resx",".manifest",".ini",".searchconnector-ms",".settingcontent-ms",".vstx",".vssx",".ms-one-stub",],at=["/visio content/",];t.isInitials=tt;t.getSuggestionTypeOverride=rt;t.isSuppressed=ut;ft=function(){function e(n,t){this._config=n;t.bindAppHidden(function(){b={};k={};d={}})}return e.prototype.fetch=function(i,r,f,e,o){var a=this,h,c,it,b,rt,s,k,ut,d,ot,st,g,ft,nt,ht,ct,tt,et,l;if(e&&e.register(function(){return t.Promise.clearPendingItemsFromCache()},!1),h=[],c=v.filter(function(t){return n.isDataSourceEnabled(t.dataSource,i,a._config)}),t.IndexerQueryGenerator&&(h=h.concat(c.filter(function(n){return t.IndexerQueryGenerator.dataSourceSupported(n.dataSource)})),c=c.filter(function(n){return!t.IndexerQueryGenerator.dataSourceSupported(n.dataSource)})),c.length>0){if(!i.queryToFetch&&!c.every(function(n){return n.supportsEmptyQuery}))throw new Error(u);if(e&&e.register(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastDeviceQuery()},!1),it=n.safeExecute(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.startDeviceQuery(i.queryToFetch)},"startDeviceQuery",null,i.queryToFetch),it)for(b=0,rt=c;b<rt.length;b++)l=rt[b],this.searchFolderWithMultipleResults(i,l,it,r,o);else this.emptyFetch(c,r)}if(s=y.filter(function(t){return n.isDataSourceEnabled(t.dataSource,i,a._config)}),!i.taskFrame&&t.IndexerQueryGenerator&&(h=h.concat(s.filter(function(n){return t.IndexerQueryGenerator.dataSourceSupported(n.dataSource)})),s=s.filter(function(n){return!t.IndexerQueryGenerator.dataSourceSupported(n.dataSource)})),s.length>0){if(!i.queryToFetch&&!s.every(function(n){return n.supportsEmptyQuery}))throw new Error(u);t.Promise.safeChain("executeSearchAsync",function(){return SearchAppWrapper.CortanaApp.searchResultsView.executeSearchAsync(i.queryToFetch,i.taskFrame)},function(n){var t,u,f;if(o())if(n)for(t=0,u=s;t<u.length;t++)f=u[t],a.searchFolderWithMultipleResults(i,f,n,r,o);else a.emptyFetch(s,r)},function(){return a.emptyFetch(s,r)},null,i.taskFrame?i.queryToFetch+"\n"+i.taskFrame:i.queryToFetch)}if(h.length>0){if(!i.queryToFetch&&!h.every(function(n){return n.supportsEmptyQuery}))throw new Error(u);for(k=0,ut=h;k<ut.length;k++)l=ut[k],this.searchFolderWithMultipleResults(i,l,null,r,o)}if(d=p.filter(function(t){return n.isDataSourceEnabled(t.dataSource,i,a._config)}),d.length>0){if(!i.queryToFetch&&!d.every(function(n){return n.supportsEmptyQuery}))throw new Error(u);for(ot=function(n){e&&n.customCancellation&&e.register(function(){return n.customCancellation()},!0);st.searchFolderWithMultipleResults(i,n,i,r,o)},st=this,g=0,ft=d;g<ft.length;g++)l=ft[g],ot(l)}if(nt=w.filter(function(t){return n.isDataSourceEnabled(t.dataSource,i,a._config)}),nt.length>0){if(!i.queryToFetch&&!nt.every(function(n){return n.supportsEmptyQuery}))throw new Error(u);for(ht=function(n){e&&n.customCancellation&&e.register(function(){return n.customCancellation()},!0);ct.searchFolderWithSingleResult(i,n,i,r,o)},ct=this,tt=0,et=nt;tt<et.length;tt++)l=et[tt],ht(l)}i.taskFrame&&n.safeExecute(function(){return SearchAppWrapper.CortanaApp.searchResultsView.setTaskFrame(i.originalQuery,"")},"reset task frame")},e.prototype.emptyFetch=function(n,t){for(var u,i=0,r=n;i<r.length;i++)u=r[i],this.logProviderFailure(u.dataSource),t(u.dataSource,f,e.getDataSourceState(0))},e.prototype.getMax=function(n,i){return n.scope!=t.Scope.All?n.queryToFetch?i.maxAfter8charsOrInL2ZeroInput*2:i.maxAfter8charsOrInL2ZeroInput:n.queryToFetch.length>8?i.maxAfter8charsOrInL2ZeroInput:n.queryToFetch.length>3?i.maxAfter3chars:i.maxUpTo3chars},e.prototype.toLocalResponse=function(n,t,r,u){var h,c,l,e,a,f,o,s;for(u&&(c=r,c.getGroupDisplayName&&(h=c.getGroupDisplayName(u))),l=[],e=0,a=t;e<a.length;e++)f=a[e],o=rt(f,r),ut(this._config,n,f,o,r.dataSource)||(s=void 0,s=r.customCreateLocalResponseSuggestion?r.customCreateLocalResponseSuggestion(f,o,r.dataSource):i(f,o,r.dataSource),h&&(s.groupDisplayName=h),l.push(s));return{suggestions:l}},e.prototype.getResults=function(n,t,i,r){if(r.getResults)return r.getResults(i);var u=i,f=this._config.enableCISpeller&&u.getItemsAsyncWithSpeller,e=this.enableSpellCorrection(n);return f?u.getItemsAsyncWithSpeller(0,t,e):i.getItemsAsync(0,t)},e.prototype.enableSpellCorrection=function(){return this._config.cISpellerValue},e.prototype.searchFolderWithMultipleResults=function(i,r,u,o,s){var l=this,h=r.dataSource,y=this.getMax(i,r),a=!u,v,c;if(a)v=function(){return t.IndexerQueryGenerator.generateIndexerQueryAsync(i.queryToFetch,y,h).then(function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(n)})};else{if(c=n.safeExecute(function(){return r.getResultsContainer(u)},"getResultsContainer "+h),!c){o(h,f,null);return}v=function(){return l.getResults(i,y,c,r)}}t.Promise.safeChain(a?"queryWindowsSearchIndexerAsync":"getItemsAsync",v,function(n){var u,f,v;s()&&(u=n.resultSet,f=void 0,u?f=n.state:u=n,a&&h==t.DataSources.EdgeBrowsingHistory&&(u=u.map(function(n){return t.IndexerQueryGenerator.toBrowsingHistoryItem(n)})),v=e.getDataSourceState(f),o(h,l.toLocalResponse(i,u,r,c),v))},function(t){n.isCancellation(t)||l.logProviderFailure(h);o(h,f,null)},null,h+" "+i.queryToFetch)},e.prototype.searchFolderWithSingleResult=function(i,r,u,e,o){var h=this,s=r.dataSource,c=n.safeExecute(function(){return r.getResultsContainer(u)},"getResultsContainer "+s);c?t.Promise.safeChain("tryGetResultAsync "+s,function(){return c.tryGetResultAsync()},function(n){o()&&e(s,h.toLocalResponse(i,n?[n]:[],r,null),null)},function(t){n.isCancellation(t)||h.logProviderFailure(s);e(s,f,null)},null,i.queryToFetch):e(s,f,null)},e.prototype.logProviderFailure=function(i){var r=t.providerFailureLogName(i);r&&SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure&&n.safeExecute(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(r,"ErrorForTopHit")},"logProviderFailure")},e.getDataSourceState=function(n){switch(n){case 0:return t.LocalProviderIndexerState.Unknown;case 1:return t.LocalProviderIndexerState.NotIndexed;case 2:return t.LocalProviderIndexerState.PartiallyIndexed}return undefined},e.getApps=function(n,t,i,r,u,f){o(t,i,r,u,"findAppsAsync",function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findAppsAsync(n)},function(n){return l.customCreateLocalResponseSuggestion(n,f,u)},n.cacheAppItems?b:null,f)},e.getSettings=function(n,t,i,r,u,f,e){o(t,i,r,u,"findSettingsAsync",function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findSettingsAsync(n)},function(n){return a.customCreateLocalResponseSuggestion(n,f,u)},n.cacheSettingItems&&!e?k:null,f)},e.getFiles=function(n,u,f,e){o(n,u,f,e,"findFilesAsync",function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findFilesAsync(n)},function(n){var u=r(n.kind,n.extension,t.LocalSuggestionTypes.Document);return i(n,u,e)},d,null)},e}();t.LocalDataProvider=ft;u="Local provider doesn't support empty query"})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var u="showScopesL2",i="block",f="none",r="DismissCount",e=1,o=function(){function o(i,r,u,e,o,s){var h=this,c;(this._config=i,this._host=r,this._page=u,this._instHelper=e,this._sequenceNumberReader=o,this._storage=s,this._topHitPresent=!1,this._paneIsEmpty=!0,this._forceRenderingAdvancedOptionBelowScopes=!1,this._rootElement=_ge("root"),this._topHitHeaderElement=_ge("topHitHeader"),this._searchScopesL2Element=_ge("searchScopesL2"),this._suggestionsList=_ge("suggestionsList"),i.scopesOrder.length!=0)&&(this._host.bindAppHidden(function(){return h._scopeTiles=null}),i.searchBoxFocusEvents?(this._host.bindSearchBoxLostFocus(function(){h.isScopesL2Visible()&&h.select(null,!1)}),this._host.bindSearchBoxGotFocus(function(){h.isScopesL2Visible()&&h.select(h._selectedL2Scope,!1)})):(c=SearchAppWrapper.CortanaApp.searchBox,c.addEventListener("keydown",function(n){h.isScopesL2Visible()&&n.keyCode==9&&h.getSelectedItem()&&h.select(null,!1)}),sj_be(_w,"keydown",function(n){h.isScopesL2Visible()&&n.keyCode==9&&h.getSelectedItem()&&h.select(null,!1)}),sj_be(_w,"focus",function(){h.isScopesL2Visible()&&!h.getSelectedItem()&&h.select(h._selectedL2Scope,!1)})),this._host.bindQueryChangedOrInitialized(function(n){h.isScopesL2Visible()&&(!h._currentQuery||h._currentQuery.originalQuery!=n.originalQuery)&&h.hideL2()}),this._host.bindDismissed(function(){h._advancedOptionsBottom=null;h._advancedOptionsTop=null;h.hideL2()}),this._host.bindKeyDown(function(i){var u=n.getCurrentActiveElement(),r;t.isScopeTile(u)&&(i==39||i==37)&&(r=h.findNextScopeTileToFocus(u,i==39),r&&r.focus())}),this._rootElement.addEventListener("transitionend",function(n){n.target==h._searchScopesL2Element&&(h.isScopesL2Visible()?(h._topHitHeaderElement.style.display=f,h._suggestionsList.style.display=f):h._searchScopesL2Element.style.display=f)}))}return o.prototype.findNextScopeTileToFocus=function(n,i){var f=this.isScopesL2Visible()?this._searchScopesL2Element:this._topHitHeaderElement,r=[].slice.call(f.getElementsByClassName(t.CssClass_ScopeTile)),u=r.indexOf(n);return i?r[u+1]:r[u-1]},o.prototype.render=function(n,i,r,u,f){if(this._currentQuery=n,n&&n.fullPartialQuery){var e=t.getScopeFromTaskFrame(n.parsedTaskFrame,n.scope);this.innerRender(n.scope,e,n,i,r,u,f)}else this._lastRenderedTopHitHeader=null,this._page.updateTopHitHeaderView(!1,null,null,null,null,null,null)},o.prototype.getScopeToolTip=function(n,i){var u=t.ScopeConfig[n],f=t.getScopeDisplayName(u,this._host),r;if(i){if(n==t.Scope.All)return null;r="RemovingScopeNarratorText2"}else r=n==t.Scope.All?"AddingScopeNarratorTextAll2":"AddingScopeNarratorText";return this._host.getLocString(r,f.toLocaleLowerCase())},o.prototype.getScopeDescription=function(n){var t=this.getSources(n);return t?t.join(this._host.getLocString("Comma")+" "):null},o.prototype.getSources=function(i){var r;switch(i){case t.Scope.All:return n.isBingEnabledCache?(r=[this._host.getLocString("MostRelevantOnThisPC"),t.getScopeDisplayName(t.ScopeConfig[t.Scope.Web],this._host)],t.isCortanaEnabledCache&&(this._config.substratePeopleEnabled||this._config.substrateEmailsEnabled||this._config.substrateDocumentsEnabled)&&r.push(this._host.getLocString("CloudServices"))):r=[this._host.getLocString("MostRelevantOnThisPC")],r;case t.Scope.Apps:return n.isBingEnabledCache?[this._host.getLocString("Installed"),this._host.getLocString("StoreGroup")]:[this._host.getLocString("Installed")];case t.Scope.Calendar:return[this._host.getLocString("Business")];case t.Scope.Emails:return r=[],n.contains(this._config.enabledDataSources,t.DataSources.SubstrateSearchConsumer)&&r.push(this._host.getLocString("Personal")),n.contains(this._config.enabledDataSources,t.DataSources.SubstrateSearchEnterprise)&&r.push(this._host.getLocString("Business")),r;case t.Scope.People:return r=[],n.contains(this._config.enabledDataSources,t.DataSources.SubstrateSuggestionsConsumer)&&r.push(this._host.getLocString("Personal")),n.contains(this._config.enabledDataSources,t.DataSources.SubstrateSuggestionsEnterprise)&&r.push(this._host.getLocString("Business")),r;case t.Scope.Settings:return[this._host.getLocString("SystemSettingsAnnotation"),this._host.getLocString("ControlPanelAnnotation")];case t.Scope.Web:return n.isBingEnabledCache?(r=[this._host.getLocString("SearchSuggestions"),this._host.getLocString("Websites"),this._host.getLocString("Answers")],t.isCortanaEnabledCache&&this._config.substrateBookmarksEnabled&&r.push(this._host.getLocString("Bookmarks"))):r=[],n.isDataSourceEnabled(t.DataSources.EdgeBrowsingHistory,null,this._config)&&r.push(this._host.getLocString("EdgeHistoryGroup")),r;default:return t.isFileOrFolderScope(i)?(r=n.isBingEnabledCache?[this._host.getLocString("ThisPC"),t.OneDriveSource]:[this._host.getLocString("ThisPC")],t.isCortanaEnabledCache&&i==t.Scope.Documents&&this._config.substrateDocumentsEnabled&&r.push(this._host.getLocString("OneDriveForBusiness"),t.SharePointSource),r):null}},o.prototype.selectScope=function(n){var r,i,u,t;for(this._selectedScope&&(this._selectedScope.tabindex=-1,this._selectedScope.narratorText=this.getScopeToolTip(this._selectedScope.type,!1)),r=!1,i=0,u=this._scopeTiles;i<u.length;i++)t=u[i],t.selected=t.type==n,t.selected&&(r=!0,t.tabindex=1,this._selectedScope=t,t.narratorText=this.getScopeToolTip(n,!0));r||(this._selectedScope=null)},o.prototype.innerRender=function(n,i,r,u,f,e,o){var a=this;this._topHitPresent=u;this._paneIsEmpty=f;this._config.scopesOrder.length>0&&(!this._scopeTiles||t.scopeListRequiresUpdate)&&(t.scopeListRequiresUpdate=!1,this.init());this._scopeTiles&&this.selectScope(n);var s=t.ScopeConfig[i],c=this.getHeaderText(i,s),v=r.showProgressBar?o:!e,l=!r||!r.queryToFetch,h=f&&v?this.getEmptyQueryMessage(l,i,s):"",y=i!=t.Scope.All||!l;if(s.showO365upsell()||!this._lastRenderedTopHitHeader||this._lastRenderedTopHitHeader.scope!=n||this._lastRenderedTopHitHeader.message!=h||this._lastRenderedTopHitHeader.headerText!=c)this._lastRenderedTopHitHeader={scope:n,headerText:c,message:h};else return;this._page.updateTopHitHeaderView(y,c,h,h?s.icon:null,this.getScopeBarElements(),function(){return a.navigateScopesL2("ScopesMore")},s.showO365upsell()?this.getAdvancedOptions(this._sequenceNumberReader.getSequenceNumber(),0):[])},o.prototype.getScopeBarElements=function(){var r=this,n,i,u;return this._scopeTiles?(n=this._config.scopesOrder.map(function(n){return r._scopeTiles.find(function(i){return t.Scope[i.type]==n})}).filter(function(n){return!!n}),n.length<this._config.scopesOrder.length&&this._config.backupScope&&(n=n.concat(this._scopeTiles.filter(function(n){return t.Scope[n.type]==r._config.backupScope}))),i=n.some(function(n){return n.selected}),i||(this._selectedScope?(u=this._scopeTiles.find(function(n){return n.type==r._selectedScope.type}),this._config.replaceLastScope?n[n.length-1]=u:n.push(u),i=!0):n[0].tabindex=1),i&&!n[0].selected&&(n[0].tabindex=-1),n):undefined},o.prototype.navigateScopesL2=function(n){var t=this,r=function(i){i&&t._advancedOptionsBottom.push(i);t.select(t._selectedScope?t._selectedScope:t._scopeTilesL2[0],!1);t.showL2();t._host.setFocusInSearchBox(n);t._instHelper.logClientInstEvent("Select",n,"ScopesL2Opened",null);t._forceRenderingAdvancedOptionBelowScopes=!1},i=this._sequenceNumberReader.getSequenceNumber();this._advancedOptionsBottom=this.getAdvancedOptions(i,1);this._advancedOptionsTop=this.getAdvancedOptions(i,2);this.getIndexingOptions(!1,i,r)},o.prototype.showL2=function(){var n=this;this._topHitHeaderElement.style.display=i;this._searchScopesL2Element.style.display=i;sb_st(function(){return n._rootElement.classList.add(u)},0)},o.prototype.hideL2=function(){var n=this;this._topHitHeaderElement.style.display=i;this._searchScopesL2Element.style.display=i;this._suggestionsList.style.display=i;this._advancedOptionsTop=[];this._advancedOptionsBottom=[];this.select(null,!1);sb_st(function(){return n._rootElement.classList.remove(u)},0)},o.prototype.getHeaderText=function(n,i){if(n!=t.Scope.All){var r=t.getScopeDisplayName(i,this._host);if(r)return this._topHitPresent?this._host.getLocString("BestMatchFor",r.toLocaleLowerCase()):this._paneIsEmpty?r:null}return this._host.getLocString("BestMatch")},o.prototype.getEmptyQueryMessage=function(n,i,r){if(r.showO365upsell())return"";if(n){if(i==t.Scope.Web)return this._host.getLocString("EmptyScopeMessageWeb");if(i!=t.Scope.All){var u=t.getScopeDisplayName(r,this._host);if(u)return this._host.getLocString("EmptyScopeMessage",u.toLocaleLowerCase())}return""}return this._host.getLocString("NoResults",this._currentQuery.queryToFetch)},o.prototype.init=function(){var u,i,r;this._scopeTiles=[];this._scopeTilesL2=[];for(u in t.ScopeConfig)(i=parseInt(u),r=t.ScopeConfig[i],r.prefixesLocString&&t.isScopeEnabled(i,r,this._config))&&((i!=t.Scope.All||n.contains(this._config.scopesOrder,"All"))&&this._scopeTiles.push(this.createScopeElement(i,r,!1)),this._scopeTilesL2.push(this.createScopeElement(i,r,!0)));this._scopeTilesL2.sort(function(n,i){return n.type==t.Scope.All?-1:i.type==t.Scope.All?1:n.text.localeCompare(i.text)})},o.prototype.createScopeElement=function(n,i,r){var u=this;return{id:"scope"+n,type:n,text:t.getScopeDisplayName(i,this._host),description:r?this.getScopeDescription(n,i):null,icon:n==t.Scope.All?{content:t.SegoeFontIcons.ViewAll,type:1}:i.icon,click:function(){return u.clickHandler(n,u.isScopesL2Visible()?"scopesL2":"scopeBar")},selected:!1,tabindex:-1,narratorText:this.getScopeToolTip(n,!1)}},o.prototype.clickHandler=function(n,i){var o=t.getScopeDisplayName(t.ScopeConfig[n],this._host),f,r=this._currentQuery,u=r.scope,e;if(this._scopeTiles.some(function(n){return n.type==u})||(u=t.Scope.All),o&&u!=n)f=(n==t.Scope.All?"":o.toLocaleLowerCase()+": ")+r.queryToFetch,this.innerRender(n,n,r,this._topHitPresent,this._paneIsEmpty,!0,!1),this._page.updateTopResultsView([]),this._page.updateGroupsView([]),this.hideL2();else if(this.isScopesL2Visible())this.select(this._selectedScope,!1),this.hideL2();else if(u!=t.Scope.All)f=r.queryToFetch,n=t.Scope.All,this.innerRender(n,n,r,this._topHitPresent,this._paneIsEmpty,!0,!1);else{this.setFocusInSearchBox("scope clickHandler noop");return}e=t.Scope[n];this._instHelper.logClientInstEvent("Select",i,"ScopeChanged",null,{Scope:e});u!=n&&this._host.setQuery(f,!0,!1);this.setFocusInSearchBox("scope clickHandler "+e)},o.prototype.setFocusInSearchBox=function(t){this._host.setFocusInSearchBox(t);var i=n.getCurrentActiveElement();i&&i.blur()},o.prototype.isScopesL2Visible=function(){return this._rootElement.classList.contains(u)},o.prototype.getSelectableItems=function(){return this._scopeTilesL2},o.prototype.getSelectedItem=function(){return this._selectedL2Scope&&this._selectedL2Scope.selected?this._selectedL2Scope:null},o.prototype.select=function(n,t){var f=this,r,e,i,u;if(t){SharedLogHelper.LogError("selectScope",null,new Error("Can't update search box value when selecting scope"));return}if(this._scopeTilesL2){for(r=0,e=this._scopeTilesL2;r<e.length;r++)i=e[r],u=n?i.type==n.type:!1,i.selected=u,i.tabindex=u?1:-1,u&&(this._selectedL2Scope=i);this._page.updateSearchScopesL2View(this._scopeTilesL2,function(){f.hideL2();var n="ScopesL2";f._host.setFocusInSearchBox(n);f._instHelper.logClientInstEvent("Unselect",n,n+"Closed",null)},this._advancedOptionsTop,this._advancedOptionsBottom)}this._selectedL2Scope&&this._selectedL2Scope.selected&&this.scrollTo(this._selectedL2Scope)},o.prototype.allowUnselectedState=function(){return!1},o.prototype.onAfterKeyDown=function(){},o.prototype.scrollTo=function(n){var t=this._searchScopesL2Element.firstChild,i=_ge(n.id);i&&(n==this._scopeTilesL2[0]?t.scrollTop=0:this._page.scrollToElement(i,t,t.offsetHeight))},o.prototype.getOffice365Option=function(n){var i=this;return this.getAdvancedOption(t.SyntheticQSCodes.Substrate_ConnectO365Account,n,"Office365UpsellMessage","ConnectOffice365Account",function(){return i._host.launchWebContent(_w.location.origin+"/account/permissions/provider?provider=Office365")})},o.prototype.getCortanaSignInOption=function(i){var r=this;return this.getAdvancedOption(t.SyntheticQSCodes.ScopesDrawer_SignInToCortana,i,n.contains(this._config.enabledDataSources,t.DataSources.SubstrateSuggestionsEnterprise)||n.contains(this._config.enabledDataSources,t.DataSources.SubstrateSearchEnterprise)?"SignInToSeeResults":"SeeResultsFromOneDrive","SignInToCortana",function(){r._config.cortanaCapabilitiesAvailable?r._host.launchUrl("ms-cortana://CapabilitiesPrompt/?RequestedCapabilities=Personalization"):r._host.launchUrl("ms-cortana://StartMode=Coobe")})},o.prototype.getCommunicationConsentOption=function(n){var i=this;return this.getAdvancedOption(t.SyntheticQSCodes.Substrate_CommunicationConsent,n,"CommunicationConsentUpsellMessage","Enable",function(){return i._host.launchUrl("ms-cortana://CapabilitiesPrompt/?RequestedCapabilities=People,Email")})},o.prototype.getAdvancedOption=function(i,u,f,e,o){var s=this,h=n.InstrumentedItem.getNonSuggestionInstrumentedItem(i,t.SyntheticQSCodes.KValues),c,l;return this._instHelper.instrumentSyntheticInstrumentedItem(u,i,h),c=function(){s._instHelper.onItemClick(u);s._storage.removeItem(r);o()},l=function(){var n=parseInt(s._storage.getItem(r))||0;s._storage.setItem(r,(n+1).toString());s._forceRenderingAdvancedOptionBelowScopes=!0;s.navigateScopesL2("DismissUpsell_"+i)},{heading:this._host.getLocString(f),text:this._host.getLocString(e),instItem:h,click:c,dismissIcon:{content:t.CortanaFontIcons.Cancel,type:2},dismissAction:l}},o.prototype.getAdvancedOptions=function(i,u){var o=[];if(n.isBingEnabledCache){var f=void 0,s=parseInt(this._storage.getItem(r))||0,h=this._config.renderAdvancedOptionsOnTop&&s<e&&!this._forceRenderingAdvancedOptionBelowScopes;(u==0||u==(h?2:1))&&(t.isSignedInWithMSA?(n.contains(this._config.enabledDataSources,t.DataSources.SubstrateSuggestionsEnterprise)||n.contains(this._config.enabledDataSources,t.DataSources.SubstrateSearchEnterprise))&&(t.isSubstrateO365AccountConnected?n.contains(t.availableCortanaCapabilities,t.CortanaCapabilities.Contacts)&&n.contains(t.availableCortanaCapabilities,t.CortanaCapabilities.Email)||(f=this.getCommunicationConsentOption(i)):f=this.getOffice365Option(i)):f=this.getCortanaSignInOption(i));f&&o.push(f)}return o},o.prototype.getIndexingOptions=function(i,r,u){var f=this;t.LocalDataProvider.getSettings(this._config,[t.IndexingOptionsSettingId,t.ChangeHowWindowsSearchesSettingId],function(e){var o=e[t.IndexingOptionsSettingId],h=e[t.ChangeHowWindowsSearchesSettingId],s,c;o&&h?(s=n.InstrumentedItem.getNonSuggestionInstrumentedItem(t.SyntheticQSCodes.ScopesDrawer_IndexingOptions,t.SyntheticQSCodes.KValues),f._instHelper.instrumentSyntheticInstrumentedItem(r,t.SyntheticQSCodes.ScopesDrawer_IndexingOptions,s),c={heading:h.deviceItem.displayName,text:o.deviceItem.displayName,instItem:s,click:function(){f._instHelper.onItemClick(r);f._host.launchDeviceItem(o.deviceItem,t.DataSources.LocalSettings)}},u(c)):i?u(null):f.getIndexingOptions(!0,r,u)},null,t.DataSources.LocalSettings,null,!0)},o}();t.ScopesViewModel=o})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function i(n,t){var i=HitHighlightingParser.removeMarkers(n.text),r;!i.includes(t.queryToFetch)&&i.toLowerCase().startsWith(t.queryToFetch.toLowerCase())&&(r=t.queryToFetch+i.substr(t.queryToFetch.length),n.text=HitHighlightingParser.addMarkers(r,t.queryToFetch));!n.query.includes(t.queryToFetch)&&n.query.toLowerCase().startsWith(t.queryToFetch.toLowerCase())&&(n.query=t.queryToFetch+n.query.substr(t.queryToFetch.length))}function r(n,r,u,f,e,o,s,h){if(n.actionUri=f,n.confidence=o,n.source=s,n.handoffType==4){var c=n.query.toLowerCase()==r.queryToFetch.toLowerCase();n.updateFromQuery=function(i){return c?(n.query=i.queryToFetch,n.text=HitHighlightingParser.addMarkers(n.query,i.queryToFetch),n.narratorText=t.getNarratorText(n),!0):!1};n.click=function(){return h.launchCat1MyStuff(n.query,e)}}else n.secondaryTextClass=t.CssClass_Action,n.click=function(){return h.launchCat1(n.query,f,e)};n.getIcon||t.isValidIcon(n.icon)||(n.icon={type:3});i(n,r);n.narratorText=t.getNarratorText(n);n.getMruData=function(){return{type:n.type,handoffType:n.handoffType,hc:n.hc,highConfidenceMetaSuggestionScore:n.highConfidenceMetaSuggestionScore,prefetchConfidenceScore:n.prefetchConfidenceScore,query:n.query,textWithoutHH:HitHighlightingParser.removeMarkers(n.text),secondaryText:n.secondaryText,icon:n.getIcon?null:n.icon,actionUri:f,taskFrame:e,confidence:o,source:s}}}function u(n,r,u,f,e,o,s,h,c,l,a){if(n.isAnswer=!0,n.answerHtml=f&&f.Content?f.Content.HTML:null,n.answerHtml){var v=JsonInject.GetResourceKeys([f]);v&&(n.executeScript=function(){return JsonInject.WriteAfterContentResources(JsonInject.FilterResources(c,v))})}n.handoffType==10?(n.secondaryTextClass=t.CssClass_Action,i(n,r),t.isValidIcon(n.icon)||(n.icon={type:3}),n.click=function(){return l.launchCat2or3a(n.query,h)},n.allowedInGroups=!n.answerHtml,n.answerHtml||(n.getMruData=function(){return{type:n.type,handoffType:n.handoffType,hc:n.hc,highConfidenceMetaSuggestionScore:n.highConfidenceMetaSuggestionScore,prefetchConfidenceScore:n.prefetchConfidenceScore,query:n.query,textWithoutHH:HitHighlightingParser.removeMarkers(n.text),secondaryText:n.secondaryText,icon:n.getIcon?null:n.icon,taskFrame:h}})):(t.isValidIcon(n.icon)||(n.icon={content:t.CortanaFontIcons.Search,type:2}),o&&(n.secondaryIcon={content:o,type:0}),n.answerHtml||(n.text.includes(HitHighlightingParser.startMarker)||(n.text=HitHighlightingParser.addMarkers(n.text,r.originalQuery)),e?(n.additionalInfoTextFor3LinesTemplate=e,n.additionalInfoText=" - "+e):n.secondaryText||n.secondaryIcon||(n.secondaryText=l.getLocString("SearchTheWeb"))),n.click=function(){return l.launchSearch(n.query,a.getSearchUrl(r.fullPartialQuery,n.query,n.type,s),!1)},n.allowedInGroups=!!n.additionalInfoText||n.autoOpenPreviewPaneWhenOnTopHit);n.narratorText=t.getNarratorText(n)}function f(n,i,r,u,f){n.url=u;n.tooltip=u+"\n\n"+n.secondaryText;t.isValidIcon(n.icon)||(n.getIcon=f.getEdgeIcon);n.click=function(){return f.launchUrl(u)};n.narratorText=t.getNarratorText(n,f.getLocString("DirectNavSuggestion"));n.getMruData=function(){return{type:n.type,handoffType:n.handoffType,hc:n.hc,highConfidenceMetaSuggestionScore:n.highConfidenceMetaSuggestionScore,prefetchConfidenceScore:n.prefetchConfidenceScore,query:n.query,textWithoutHH:HitHighlightingParser.removeMarkers(n.text),secondaryText:n.secondaryText,icon:n.getIcon?null:n.icon,url:u}}}var e=function(){function i(n,t,i,r,u,f){this._config=n;this._host=t;this._instrumentationHelper=i;this._navigationHelper=r;this._temporaryMessageHandler=u;this._webSignalsCache=f}return i.prototype.parse=function(n,t,i,r,u,f,e){this.parseOnlineSuggestions(n,t,r,u,f,e,i)},i.prototype.parseOnlineSuggestions=function(i,r,u,f,e,o,s){var c=this,h,a,k;if(!u){n.isDataSourceEnabled(n.WebDataSource,i,this._config)&&e(n.WebDataSource,[],null);n.isDataSourceEnabled(t.DataSources.BingApps,i,this._config)&&e(t.DataSources.BingApps,[],null);n.isDataSourceEnabled(t.DataSources.BingSettings,i,this._config)&&e(t.DataSources.BingSettings,[],null);return}u.ELToken&&this._host.shouldRequestEltoken()&&this._host.setElToken(u.ELToken);var v=[],y=[],p=[],l=[],w=[],b=n.isDataSourceEnabled(n.WebDataSource,i,this._config);n.safeExecute(function(){for(var e,o=function(t){var o=t.Attributes,h=o.appId,f,e;if(h)return y.push(t),h.split(";").forEach(function(t){n.contains(l,t)||l.push(t)}),"continue";if(f=o.settingId,f)return p.push(t),w.push(f),"continue";b&&(e=n.safeExecute(function(){return c.parseOnlineSuggestion(i,t,r,u.Resources,s)},"parseOnlineSuggestion"),e&&v.push(e))},t=0,f=u.Suggestions;t<f.length;t++)e=f[t],o(e)},"parseOnlineSuggestions");b&&(h=null,a=null,u.RankingSignals&&(h=n.safeExecute(function(){return n.parseWebEngagementSignals(u.RankingSignals,c._config)},"parseWebEngagementSignals"),a=n.safeExecute(function(){return t.parseWebSuppresionSignals(u.RankingSignals,i)},"parseWebSuppressionSignals")),this._webSignalsCache&&this._webSignalsCache.updateCacheData(i.queryToFetch,h),k={rankingSignals:u.RankingSignals,engagementSignals:h,suppressedGroups:a,webTopResultRoutingType:u.PrefixRoutingType},e(n.WebDataSource,v,k));t.lookupById(i,t.DataSources.BingApps,null,l,y,function(n){return n.Attributes.appId.split(";")},t.DataSources.BingSettings,null,w,p,function(n){return n.Attributes.settingId},f,r,e,o,function(n,t,f,e){return c.parseIdLookupResponse(u,i,r,n,t,f,e)},null,null,null,null,this._config,this._instrumentationHelper)},i.prototype.parseIdLookupResponse=function(i,u,f,e,o,s,h){var c=this,l,a;if(e.Attributes.stype!=t.OnlineSuggestionTypes.Store||!(s.length>0)){if(s.length!=1){l=n.safeExecute(function(){return c.parseOnlineSuggestion(u,e,f,i.Resources,o)},"parseOnlineSuggestion "+o);l&&h.push(l);return}a=function(n){var i=e.Attributes;return c.compliesWithMinVersion(i.appMinVersion,n.deviceItem.version)?(n.appContext=i.appContext,c.setRankingSignals(n,e),e.Text&&i.query&&(!t.isApp(n.type)||n.appContext)&&(n.text=e.Text,n.query=i.query),e.SecondaryText&&(n.secondaryText=e.SecondaryText),n.handoffType==5&&r(n,u,f,i.actionUri,i.taskFrame,parseFloat(i.confidence),parseInt(i.source),c._host,c._config),!0):!1};n.safeExecute(function(){return t.parseLocalSuggestion(u,s[0],o,f,c._host,c._config,c._temporaryMessageHandler,e.Attributes.stype,c._instrumentationHelper,h,a)},"parseLocalSuggestion "+o)}},i.prototype.parseOnlineSuggestion=function(i,e,o,s,h){var p=this,l=e.Attributes,v=l.stype,y,c,a;if(l.appId&&v!=t.OnlineSuggestionTypes.Store||l.settingId)return null;if(y=n.InstrumentedItem.createInstrumentedItem(o),c=t.createSuggestion(e.Text,null,n.getIconFromOnlineResponse(e),v,l.query,y,null,o,!1),e.ChildSuggestions&&(c.calculateChildSuggestions=function(){return p.calculateRelatedSuggestions(c,i,e,h)}),c.secondaryText=e.SecondaryText,c.secondaryTextClass=t.CssClass_Annotation,this.setRankingSignals(c,e),c.autoOpenPreviewPaneWhenOnTopHit=l.openPP==="1",l.isAnswer==="1"){if(!l.url&&!t.isCortanaEnabledCache)return null;c.handoffType=l.url?l.isVertical==="1"?9:0:10;c.signals=e.Signals;u(c,i,o,e.InstantAnswer,l.additionalInfoText,l.secondaryIconUrl,l.url,l.taskFrame,s,this._host,this._navigationHelper,this._config);l.noHeightRestriction==="1"&&(c.suggestionClass="noHeightRestriction")}else if(l.taskFrame){if(!t.isCortanaEnabledCache)return null;c.handoffType=l.actionUri.startsWith("action://FindMyStuff/")?4:5;r(c,i,o,l.actionUri,l.taskFrame,parseFloat(l.confidence),parseInt(l.source),this._host,this._config)}else if(c.type==t.OnlineSuggestionTypes.Store)c.handoffType=3,this.setStoreSuggestionProperties(c,i,o,l);else{if(!l.url)return null;c.type==t.OnlineSuggestionTypes.DirectNav||c.type==t.OnlineSuggestionTypes.Deeplink?(a=n.prettyPrintUrl(l.query,i.queryToFetch),a!=c.query&&(c.query=a,c.text=i.queryToFetch?HitHighlightingParser.addMarkers(a,i.queryToFetch):a),c.handoffType=1,f(c,i,o,l.url,this._host)):(c.handoffType=0,this.setWebSearchSuggestionProperties(c,i,o,l.url))}return t.isValidSuggestion(c,"parseOnlineSuggestion")?c:null},i.prototype.setStoreSuggestionProperties=function(n,i,r,u){var e=this,f;n.icon.bgColor=u.bgColor=="transparent"?this._host.getAccentColor():u.bgColor;n.secondaryTextClass=t.CssClass_Action;f=parseFloat(u.avgRating);n.stars=this.getStars(f);n.catalogScore=parseFloat(u.catalogScore);n.avgRating=f;n.ratingCount=parseInt(u.ratingCount);n.click=function(){return e._host.launchStorePdp(u.productId)};n.narratorText=t.getNarratorText(n)},i.prototype.getStars=function(n){for(var r="",i=1;i<=5;++i)if(n>=i-.25)r+=t.CortanaFontIcons.FavoriteStarFill;else if(n>=i-.75){r+=t.CortanaFontIcons.HalfStarLeft;break}return r},i.prototype.setRankingSignals=function(n,t){var i=t.Attributes;n.hc=i.hc==="1";n.highConfidenceSuggestionScore=i.hcs;n.highConfidenceMetaSuggestionScore=t.HighConfidenceMetaSuggestionScore;n.prefetchConfidenceScore=t.PrefetchConfidenceScore;n.isPrefetch=i.pc==="1";n.previewPaneScenario=i.pvw;n.suggestionLogMeta=i.lm},i.prototype.compliesWithMinVersion=function(n,t){var r,u,i,f,e;if(!n)return!0;if(!t)return!1;for(r=n.split("."),u=t.split(".");r.length>u.length;)u.push("0");for(i=0;i<r.length;++i){if(f=u[i],e=r[i],f<e)return!1;if(f>e)return!0}return!0},i.prototype.setWebSearchSuggestionProperties=function(n,i,r,u){var f=this;t.isValidIcon(n.icon)||(n.icon={content:n.type==t.OnlineSuggestionTypes.SearchHistory?t.CortanaFontIcons.History:t.CortanaFontIcons.Search,type:2});i.queryToFetch||(n.text=HitHighlightingParser.addMarkers(n.text));n.secondaryText||(n.secondaryText=this._host.getLocString("SearchTheWeb"));n.click=function(){return f._host.launchSearch(n.query,f._navigationHelper.getSearchUrl(i.fullPartialQuery,n.query,n.type,u),n.useRaf)};n.narratorText=t.getNarratorText(n);n.type==t.OnlineSuggestionTypes.SearchHistory&&t.setExtraVerbs(n,function(){var n={verb:"ManageSearchHistory",displayName:f._host.getLocString("ManageSearchHistory"),executeAsync:function(){return SearchAppWrapper.CortanaApp.launcher.launchUriAsync("https://www.bing.com/profile/history?fsi=1&FORM=WNSHIS")}};return[n]})},i.prototype.calculateRelatedSuggestions=function(i,r,u,f){var s,h,o,e;for(i.childSuggestions=[],s=0,h=u.ChildSuggestions;s<h.length;s++)o=h[s],e=t.createSuggestion(o.Text,null,n.getIconFromOnlineResponse(o),o.Type,o.Query,n.InstrumentedItem.createInstrumentedItem(i.sequenceNumber),0,i.sequenceNumber,!1),e.groupType=n.GroupType.Related,e.parent=i,e.tooltip=o.SecondaryText,e.rankingScore=o.RankingScore,e.category=o.Category,e.isAnswer=!0,this.setWebSearchSuggestionProperties(e,r,i.sequenceNumber,o.Url),e.secondaryText=null,t.isValidSuggestion(e,"calculateRelatedSuggestions")&&i.childSuggestions.push(e);i.childSuggestions.length>0&&this._instrumentationHelper.instrumentDataSource(i.sequenceNumber,f,i.childSuggestions,null)},i}();t.OnlineSuggestionsParser=e;t.adjustCasing=i;t.setCat1SuggestionProperties=r;t.setCat3SuggestionProperties=u;t.setUrlSuggestionProperties=f})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function c(n){return n?[n]:[]}function rt(n){if(n){var t=n.lastIndexOf(".");if(t>=0)return n.substring(t)}return""}function l(t){var i;return t&&(i=typeof t=="string"||typeof t=="number"?new Date(t):t()),n.isValidDate(i)?i:null}function ut(i,r,u,f,e){i.click=n.doubleClickGuardedHandler(function(){return t.OutlookDeeplinkUtilities.launchItem(f,r,u,e)})}function ft(n,i,r,u,f,e,o){w(n,function(){var n=[];return ThresholdUtilities.createPromise(function(s){t.LocalDataProvider.getApps(e,it,function(e){var a=!t.Map.isEmpty(e);if(a){var h=t.OutlookDeeplinkUtilities.getLauncherPreference(f),c="Outlook",l=Object.keys(e);l.length==1&&(c=e[l[0]].deviceItem.displayName);n.push({verb:"OpenInOutlookWeb",displayName:o.getLocString("OpenIn","Outlook Web"),executeAsync:function(){return ThresholdUtilities.createPromise(function(){u?t.OutlookDeeplinkUtilities.launchOutlookWebLink(u,f):t.OutlookDeeplinkUtilities.launchOutlookWeb(r,f)})},isDefault:h==1});n.push({verb:"LaunchOutlookNative",displayName:o.getLocString("OpenIn",c),executeAsync:function(){return ThresholdUtilities.createPromise(function(n,r){return t.OutlookDeeplinkUtilities.launchOutlookNative(i,f,n,r)})},isDefault:h==0})}s(n)},null,t.DataSources.LocalApps,null)})})}function a(i){if(i){var r=n.getDate();if(r.getDate()==i.getDate()&&r.getMonth()==i.getMonth()&&r.getFullYear()==i.getFullYear())return i.toLocaleTimeString(t.uiLanguageCache,{hour:"numeric",minute:"numeric"})}return null}function u(n,i,r,u,f,e,o,s){var h=l(r),v,c;h&&(v=h.toLocaleDateString(),c=a(h),c||(c=h.toLocaleString(t.uiLanguageCache,{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})));i.tooltip=st(i.path,f,e,o,c,s);i.secondaryTextClass=t.CssClass_Annotation;v?(i.secondaryText=s.getLocString("LastModifiedAnnotation",v),i.additionalInfoTextFor3LinesTemplate=u):i.secondaryText=u;i.narratorText=t.getNarratorText(i);t.isPhotoOrVideo(i.type)&&(i.suggestionClass=t.isL2(n)?"bigIcon biggerIcon":"bigIcon")}function v(n,i,r,u,f,e){e||(u.additionalInfoTextFor3LinesTemplate=f);t.isL2(r)||n.separateGroupsBySourceOnL1?u.sourceForGroup=f:u.additionalInfoText=i.getLocString("InfoTextWithSource"," -",f)}function et(n,i,r,u,f){return n?t.Promise.safeChainWithGlobalCaching("getImageWithLiveTokenAsync",function(){return SearchAppWrapper.CortanaApp.getImageWithLiveTokenAsync(r)},function(){return f},function(n){return t.toIcon(n,"getImageWithLiveTokenAsync",i)},i,null,3):y(i,u,f)}function y(n,i,r){return t.Promise.safeChainWithGlobalCaching("getIconForTypeAsync",function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getIconForTypeAsync(i,t.getImageSizeValue(n))},function(n){return n+"_"+r},function(i){return t.toIcon(i,"getIconForTypeAsync",n)},n)}function p(n){return n!=null&&(n.type==3||!!n.content||!!n.className)}function i(n,t,i){i===void 0&&(i=!0);var r=n.mayContainPII;return n.text?n.query?!n.handoffType&&n.handoffType!==0?(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing handoff type")),!1):n.type?i&&!n.getIcon&&!p(n.icon)?(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing icon")),!1):!0:(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing suggestion type")),!1):(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing query")),!1):(SharedLogHelper.LogError(t,r?"":n.deviceItem?n.deviceItem.id:"",new Error("Missing text")),!1)}function r(n,i){var r=n.getExtraVerbs;n.getExtraVerbs=function(){var n=r?r():[],u=i();return t.joinVerbsWithSeparator(n,u)}}function w(n,i){var r=n.getExtraVerbsAsync;n.getExtraVerbsAsync=r?function(){return ThresholdUtilities.createPromise(function(n){return r().then(function(r){return i().then(function(i){return n(t.joinVerbsWithSeparator(r,i))})})})}:i}function f(n){return SearchAppWrapper.CortanaApp.launcher.launchUriAsync(n)}function ot(n){var i,t;if(n&&typeof n=="object"&&n.length){for(i="",t=0;t<n.length;t++)i+=n[t],t!=n.length-1&&(i+=", ");return i}return n}function st(n,t,i,r,u,f){var e=n;return t&&(e+="\n\n"+t),i&&r&&(e=i+" - "+r+"\n\n"+e),u&&(e+="\n\n"+f.getLocString("LastModifiedAnnotation",u)),e}function ht(i,r,u,f,e,o,s,h,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){var ut=!1;r&&n.isDataSourceEnabled(r,i,it)&&t.LocalDataProvider.getApps(it,f,function(t){var u,s,i,f,h;if(y()){for(rt.instrumentResponseReceived(p,r,n.DataSourceStateFor200Response,ut),u=[],s=function(i){n.safeExecute(function(){return k(i,r,o(i).map(function(n){return t[n]}).filter(function(n){return!!n}),u)},"parseApp "+r)},i=0,f=e;i<f.length;i++)h=f[i],s(h);w(r,u,null)}},b,r,u);s&&n.isDataSourceEnabled(s,i,it)&&t.LocalDataProvider.getSettings(it,l,function(t){var u,e,i,f,o;if(y()){for(rt.instrumentResponseReceived(p,s,n.DataSourceStateFor200Response,ut),u=[],e=function(i){n.safeExecute(function(){return k(i,s,c(t[v(i)]),u)},"parseSetting "+r)},i=0,f=a;i<f.length;i++)o=f[i],e(o);w(s,u,null)}},b,s,h);d&&n.isDataSourceEnabled(d,i,it)&&t.LocalDataProvider.getFiles(g,function(t){var r,f,i,u,e;if(y()){for(rt.instrumentResponseReceived(p,d,n.DataSourceStateFor200Response,ut),r=[],f=function(i){n.safeExecute(function(){return k(i,d,c(t[tt(i)]),r)},"parseFile "+d)},i=0,u=nt;i<u.length;i++)e=u[i],f(e);w(d,r,null)}},b,d)}function ct(n,i){return t.isMobileCache?null:n.id==t.EdgeAppId?i.getLocString("MicrosoftRecommendedBrowser"):n.isImmersive?n.isTrustedApp?i.getLocString("TrustedWindowsAppAnnotation"):i.getLocString("WindowsAppAnnotation"):i.getLocString("DesktopAppAnnotation")}function lt(n,i){return t.isModernSetting(n)?i.getLocString("SystemSettingsAnnotation"):i.getLocString("ControlPanelAnnotation")}function at(i,r,f,e,o){var v=t.getAppItem(r),c,p,s,w,g,h,l,nt,ht,tt,b,a,y,it,rt;if(v){r.secondaryText=ct(v,o);r.secondaryTextClass=t.CssClass_Annotation;r.narratorText=t.getNarratorText(r);return}if(t.isSetting(r.type)){r.secondaryText=lt(r.deviceItem,o);r.secondaryTextClass=t.CssClass_Annotation;r.narratorText=t.getNarratorText(r);return}if(r.type==t.LocalSuggestionTypes.StartMenuUrl&&(v=r.deviceItem,v)){c=v.id;r.narratorText=t.getNarratorText(r,o.getLocString("DirectNavSuggestion"));r.tooltip=r.query+"\n\n"+c;r.url=c;return}if(p=t.getBrowsingHistoryItem(r),p){var c=p.url,d=n.prettyPrintUrl(c,i.queryToFetch),ut=i.queryToFetch?HitHighlightingParser.addMarkers(d,i.queryToFetch):d,h=p.title;h?(r.text=i.queryToFetch?HitHighlightingParser.addMarkers(h,i.queryToFetch):h,r.secondaryText=ut):r.text=ut;r.query=d;r.narratorText=t.getNarratorText(r,o.getLocString("DirectNavSuggestion"));r.template=1;r.tooltip=h+"\n\n"+c;r.suggestionClass="force1LineOutsideTopResult";r.secondaryTextClass=t.CssClass_Annotation;r.url=c;return}if(s=t.getFileItem(r),s){w=void 0;f==t.DataSources.LocalApps?w=s.id:(g=n.safeExecute(function(){return s.getProperty("System.ItemFolderPathDisplay")},"getPath"),w=g?g+"\\"+r.deviceItem.displayName:r.deviceItem.displayName);l=r;l.path=w;var ft=void 0,et=void 0,st=void 0;f==t.DataSources.MyStuffDocuments&&n.contains(s.propertyHits,"System.Search.Contents")?(ft=n.safeExecute(function(){return s.getProperty("System.Search.AutoSummary")},"getTextContent"),s.propertyHits.length==1&&(r.matchedOnlyOnContent=!0)):r.type==t.LocalSuggestionTypes.Music&&f!=t.DataSources.MRUFilesAndFolders&&(et=ot(n.safeExecute(function(){return s.getProperty("System.Music.Artist")},"getArtist",undefined,f)),st=n.safeExecute(function(){return s.getProperty("System.Music.AlbumTitle")},"getAlbumTitle",undefined,f),f==t.DataSources.MyStuffMusic&&(h=n.safeExecute(function(){return s.getProperty("System.Title")},"getTitle",undefined,f),h&&(r.text=h)));u(i,l,function(){return s.lastModifiedDate},s.itemTypeDisplayName,ft,et,st,o);pt(r,o);return}if(r.type==t.LocalSuggestionTypes.PathCompletion||r.type==t.LocalSuggestionTypes.CommandLine){if(l=r,r.type!=t.LocalSuggestionTypes.PathCompletion&&r.deviceItem.launchArguments||(l.path=r.deviceItem.id),nt=r.deviceItem,ht=nt.kind,ht=="program"){k(r,o);return}if(tt=vt(nt),tt){u(i,l,null,tt,null,null,null,o);return}r.type==t.LocalSuggestionTypes.CommandLine&&k(r,o);return}if(b=t.getPowerBiItem(r),b){a=void 0;switch(b.resultType){case 1:a=o.getLocString("PowerBIDashboard");break;case 3:a=o.getLocString("PowerBIContentPack");break;default:a=b.modelDisplayName}r.additionalInfoTextFor3LinesTemplate=a;r.additionalInfoText=o.getLocString("InfoTextWithSource"," -",a);r.narratorText=t.getNarratorText(r);return}if(y=t.getNamedItem(r),y){it=y.secondaryContent;rt=y.source;r.secondaryText=it[0];r.additionalInfoTextFor3LinesTemplate=it[1];r.additionalInfoText=o.getLocString("InfoTextWithSource"," -",rt);r.tooltip=r.query+"\n"+y.secondaryContent.join("\n")+"\n"+rt;return}throw new Error("Unexpected type: "+r.type);}function vt(n){if(n.launchArguments)return null;var t=n.itemTypeDisplayName;return t&&t[0]!="."?t:null}function e(i,r,u,f){for(var h,w,c,v,p,e,y,o,l,a=[],s=0;s<r.length-1;++s)if(!t.isPhotoOrVideo(r[s].type))for(h=s+1;h<r.length;++h)if(r[s].type==r[h].type&&r[s].text.toLocaleLowerCase()==r[h].text.toLocaleLowerCase()){a[s]=!0;a[h]=!0;break}if(a.length!=0)for(w=r.filter(function(n,t){return a[t]}),c=f.getLocString("InfoTextWithSource"),v=0,p=w;v<p.length;v++)if(e=p[v],e.path){if(y=e.path.lastIndexOf("\\"),y==-1)return;if(o=e.path.slice(e.path.lastIndexOf("\\",y-1)+1,y),l=e.handoffType==2?null:e.additionalInfoTextFor3LinesTemplate,l){if(o.endsWith(":"))return;e.additionalInfoTextFor3LinesTemplate=o+" ("+l+")"}else e.additionalInfoTextFor3LinesTemplate||!e.secondaryText?e.additionalInfoTextFor3LinesTemplate=e.additionalInfoTextFor3LinesTemplate?n.formatString(c,[e.additionalInfoTextFor3LinesTemplate,o]):o:e.secondaryText=n.formatString(c,[e.secondaryText,o]);e.additionalInfoText=l&&!e.sourceForGroup?n.formatString(c,[" -",o+" ("+l+")"]):n.formatString(c,[" -",o]);e.narratorText=t.getNarratorText(e)}}function k(n,i){n.secondaryText=i.getLocString("RunCommandPrompt");n.secondaryTextClass=t.CssClass_Action;n.narratorText=t.getNarratorText(n)}function yt(n){return n==t.LocalSuggestionTypes.BrowsingHistory}function d(r,u,f,e,o,s,h,c,l,a,y){var it=u.deviceItem.kind,g=t.localDataSourceMayContainPII(f),k,w,nt,tt,d;if(!c){SharedLogHelper.LogError("parseLocalSuggestion"+f,g?"":u.deviceItem.displayName||u.deviceItem.id,new Error("Unrecognized kind: "+it));return}if(k=c==t.LocalSuggestionTypes.StartMenuUrl||c==t.LocalSuggestionTypes.BrowsingHistory?1:2,n.isSuggestionTypeEnabled(f,c,k,r,s)){var b=yt(c)?null:u.deviceItem.displayName,rt=b&&r.queryToFetch?HitHighlightingParser.addMarkers(b,r.queryToFetch):b,p=t.createSuggestion(rt,u.getIcon,u.icon,c,b,n.InstrumentedItem.createInstrumentedItem(e),k,e,g);p.deviceItem=u.deviceItem;at(r,p,f,s,o);u.groupDisplayName&&(p.groupDisplayName=u.groupDisplayName);w=t.getAppItem(p);w?(p.click=function(){return o.launchAppItem(w,f,p.appContext)},s.maxJLcm&&wt(p,w,s,o,h,e,f,l,r),r.queryToFetch&&w.isImmersive&&s.topHitChildGroups[n.GroupType.VCDExamples]&&gt(p,w,s,o,e,f,l,r)):(nt=t.getBrowsingHistoryItem(p),nt?(tt=p.url,p.click=function(){return o.launchUrl(tt)},p.getIcon=o.getEdgeIcon):p.click=function(){return o.launchDeviceItem(p.deviceItem,f)});w||t.isSetting(p.type)||t.isFileOrFolder(p.type)?p.getMruData=function(){var n={type:p.type,handoffType:p.handoffType,hc:p.hc,highConfidenceMetaSuggestionScore:p.highConfidenceMetaSuggestionScore,prefetchConfidenceScore:p.prefetchConfidenceScore,id:u.deviceItem.id};return p.appContext&&(n.appContextData={appContext:p.appContext,query:p.query,textWithoutHH:HitHighlightingParser.removeMarkers(p.text)}),n}:(d=t.getCommandLineItem(p),d?p.hc=t.isRealCommand(p,d):c==t.LocalSuggestionTypes.PowerBi&&(p.hc=u.deviceItem.rankScore>900));(s.setSourceForLocalDocumentsL1&&!t.isL2(r)||s.setSourceForLocalDocumentsL2&&t.isL2(r))&&t.getGroupType(p,s)==n.GroupType.Documents&&v(s,o,r,p,o.getLocString("ThisPC"),!0);s.th&&ClientTestHooks.isTesthookParamSet("forceRemoveIcon")&&t.setRemoveIcon(p);i(p,"parseLocalSuggestion "+f)&&y(p)&&a.push(p)}}function pt(n,i){r(n,function(){var r,u;return n.duplicates&&(r=n.duplicates.filter(function(n){return n.handoffType==7||n.handoffType==8})[0],r)?(u=[],u.push({verb:"OpenInOneDrive"+(r.handoffType==8?"ForBusiness":""),displayName:i.getLocString("OpenIn",r.handoffType==8?i.getLocString("OneDriveForBusiness"):t.OneDriveSource),executeAsync:function(){return f(r.url)}}),r.locationUrl&&u.push({verb:"OpenFileLocationInOneDrive"+(r.handoffType==8?"ForBusiness":""),displayName:i.getLocString("OpenFileLocationIn",r.handoffType==8?i.getLocString("OneDriveForBusiness"):t.OneDriveSource),executeAsync:function(){return f(r.locationUrl)}}),u):[]})}function wt(i,u,f,e,s,c,l,a,v){var p=u.id,w=u.filePath,y=tt[p],k,b;if(!y&&w){k=w.toLowerCase();for(b in h)if(k.includes(b)){y=h[b];break}}y&&y.length==0||(i.calculateChildSuggestions=function(){return bt(p,w,i,u,y,e,s,c,l,a,f,v)},f.maxJLcm&&r(i,function(){var r=[],h,c;return i.calculateChildSuggestions&&i.calculateChildSuggestions(),i.childSuggestions&&(h=!1,i.childSuggestions.filter(function(i){return i.type==t.LocalSuggestionTypes.JumpListItem&&!i.displayed&&i.groupType==n.GroupType.JumpListTasks}).slice(0,f.maxJLcm).forEach(function(n){h=!0;var i={verb:"JumpListTask_"+p+"_"+n.text,displayName:n.text,executeAsync:function(){return o(u,n,e,s),t.createVoidPromise()}};r.push(i)}),c=!1,i.childSuggestions.filter(function(i){return i.type==t.LocalSuggestionTypes.JumpListItem&&!i.displayed&&i.groupType!=n.GroupType.JumpListTasks}).slice(0,f.maxJLcm).forEach(function(n,i){var f,l;h&&!c&&(f={verb:null,displayName:null,executeAsync:null},r.push(f));c=!0;l={verb:"JumpList_"+p+"_"+i,displayName:n.text,executeAsync:function(){return o(u,n,e,s),t.createVoidPromise()}};r.push(l)})),r}))}function bt(r,u,f,s,h,c,l,a,v,y,p,w){var d,k,rt,b,ut,tt,it,ft;if(f.calculateChildSuggestions=null,d=s.jumpList,d&&d.length!=0){for(k=u||"",rt=k.indexOf("}"),k=k.substr(rt+1),b=[],ut=function(u){var v,y,e;if(h&&!n.contains(h,u.type))return"continue";var p=nt(u.type),w=p!=n.GroupType.JumpListTasks,d=function(){var v,h,y;if(g(e))return"continue";v=function(n,i){return t.getIcon(e,r+"_"+e.path+"_"+e.displayName,"jumpList",!w)(n,function(u){u?i(u):t.getIcon(s,r,"jumpList fallback",!f.mayContainPII)(n,i)})};h=t.createSuggestion(e.displayName,v,null,t.LocalSuggestionTypes.JumpListItem,e.displayName,n.InstrumentedItem.createInstrumentedItem(a),2,f.sequenceNumber,w);h.click=function(){return o(s,h,c,l)};h.jumpListItem=e;h.groupType=p;h.groupDisplayName=u.name;h.getMruData=function(){return f.getMruData()};h.parent=f;h.additionalInfoTextFor3LinesTemplate=e.path;h.tooltip=e.description;y=k&&e.path.endsWith(k);y||(h.path=e.path);i(h,"calculateJumpListSuggestions")&&(b.push(h),kt(s,h,c,l))};for(v=0,y=u.items;v<y.length;v++)e=y[v],d()},tt=0,it=d;tt<it.length;tt++)ft=it[tt],ut(ft);b.length>0&&(f.childSuggestions=f.childSuggestions?f.childSuggestions.concat(b):b,e(w,b,p,c),y.instrumentDataSource(a,v,b,null))}}function g(t){return t.displayName?n.olderThan2Weeks(t.lastAccessed)?!0:!1:!0}function nt(t){switch(t){case 0:return n.GroupType.JumpListTasks;case 1:return n.GroupType.JumpListPinned;case 2:return n.GroupType.JumpListRecent;case 3:return n.GroupType.JumpListFrequent;default:return n.GroupType.JumpListCustom}}function o(n,i,r,u){t.Promise.safeChain("launchJumpList",function(){return i.jumpListItem.launchAsync()},null,function(){i.jumpListItem.deleteAsync&&t.DialogBox?t.DialogBox.show(r.getLocString("JumpListItemUnavailableDeleteConfirmation"),[{text:r.getLocString("Cancel"),selected:!0,action:function(){return r.setFocusInSearchBox("jumpListItemDialogBoxCancel")}},{text:r.getLocString("Remove"),selected:!1,action:function(){s(n,i,r,u);r.setFocusInSearchBox("jumpListItemUnavailable")}}]):(u.showTemporaryMessage(r.getLocString("JumpListItemUnavailable"),{content:t.CortanaFontIcons.Info,type:2}),s(n,i,r,u),r.setFocusInSearchBox("jumpListItemUnavailable"))})}function s(n,i,r,u){var f=function(){return dt(i)},e;i.jumpListItem.deleteAsync?(e=i.parent.childSuggestions.length==1,t.Promise.safeChain("deleteJumpList",function(){return i.jumpListItem.deleteAsync()},function(){n.getJumpListAsync&&t.Promise.safeChain("getJumpListAsync",function(){return n.getJumpListAsync()},function(n){e&&n.some(function(n){return nt(n.type)==i.groupType&&n.items.some(function(n){return!g(n)})})?f():(r.setQuery(null,!1,!0),u.showTemporaryMessage(r.getLocString("RemovedFromList",i.text),{content:t.CortanaFontIcons.Info,type:2}))},f)},f)):f()}function kt(n,i,u,f){i.jumpListItem.deleteAsync&&r(i,function(){var r={verb:t.Verbs.RemoveFromThisList,displayName:u.getLocString(t.Verbs.RemoveFromThisList),executeAsync:function(){return s(n,i,u,f),t.createVoidPromise()}};return[r]})}function dt(n){var t=_ge(n.id);t.classList.add("b_hide");n.suppressed=!0}function gt(r,u,f,e,o,s,h,c){var v=u.voiceCommandExamples,a,y,p;if(v&&v.length!=0){var w=t.getIcon(u,u.id,"vcdExample",!r.mayContainPII),l=[],b=function(u){var f=t.createSuggestion(HitHighlightingParser.addMarkers(u,c.queryToFetch),w,null,t.LocalSuggestionTypes.VCDExample,u,n.InstrumentedItem.createInstrumentedItem(o),5,r.sequenceNumber,!1);f.click=function(){return e.launchVoiceFlow(u)};f.groupType=n.GroupType.VCDExamples;f.getMruData=function(){return r.getMruData()};f.parent=r;i(f,"calculateVCDExamplesSuggestions")&&l.push(f)};for(a=0,y=v;a<y.length;a++)p=y[a],b(p);l.length>0&&(r.childSuggestions=r.childSuggestions?r.childSuggestions.concat(l):l,h.instrumentDataSource(o,s,l,null))}}var tt={"Microsoft.Windows.Explorer":[],"Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge":[0],"Microsoft.InternetExplorer.Default":[0],Chrome:[0],"360browser":[0]},h={skype:[],outlook:[0],"360browser":[0],chrome:[0],iexplore:[0],opera:[0],firefox:[0],safari:[0]},it=["Microsoft.Office.OUTLOOK.EXE.15","Microsoft.Office.OUTLOOK.EXE.16","{6D809377-6AF0-444B-8957-A3773F02200E}Microsoft OfficeOffice15OUTLOOK.EXE","{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}Microsoft OfficeOffice15OUTLOOK.EXE"],b;t.getFileExtension=rt;t.toDate=l;t.setCalendarAndEmailClickHandler=ut;t.setCalendarAndEmailContextItems=ft;t.getTodayTimeString=a;t.setFileTemplate=u;t.setSource=v;t.getOneDriveSuggestionIcon=et;t.getIconForTypeAsync=y;t.isValidIcon=p;t.isValidSuggestion=i;t.setExtraVerbs=r;t.setExtraVerbsAsync=w;t.getLaunchUrlContextMenuAction=f;b=function(){function i(n,t,i,r,u,f){this._config=n;this._host=t;this._instrumentationHelper=i;this._navigationHelper=r;this._temporaryMessageHandler=u;this._ciDataLoader=f}return i.prototype.parse=function(i,r,u,f,o,s){for(var v,y,p,h=this,c=[],w=function(t){n.safeExecute(function(){return d(i,t,u,r,h._host,h._config,h._temporaryMessageHandler,t.suggestionType,h._instrumentationHelper,c,function(){return!0})},"parseLocalSuggestion "+u)},l=0,a=f.suggestions;l<a.length;l++)v=a[l],w(v);t.isFileOrFolderLocalDataSource(u,this._config)&&e(i,c,this._config,this._host);y=u==t.DataSources.LocalApps||u==t.DataSources.LocalSettings;p=this._ciDataLoader&&y?{rankerExtraInfo:{ciVersion:this._ciDataLoader.getCurrentCiVersion()}}:null;s(u,c,p)},i}();t.SuggestionsParser=b;t.lookupById=ht;t.decorateLocalFilesAndFoldersAndMediaWithParentFolder=e;t.parseLocalSuggestion=d})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){this._countTasks=0;this._numTasks=-1;this._partialChunkFromPreviousBatch="";this._taskCache={};this._version=-1;this._prefixCount=-1}return t.prototype.getVersion=function(){return this._version},t.prototype.getPrefixCount=function(){return this._prefixCount},t.prototype.parse=function(n){return this.parseLines(this.splitToCompleteData(n))},t.prototype.flush=function(){return this._partialChunkFromPreviousBatch?this.parseLines([this._partialChunkFromPreviousBatch]):[]},t.prototype.splitToCompleteData=function(n){if(n.length>0){var t=n.split("\n").map(function(n){return n.trim()});return t.length>0&&(t[0]=this._partialChunkFromPreviousBatch+t[0],this._partialChunkFromPreviousBatch=t.pop()),t}return[]},t.prototype.parseLines=function(i){for(var f,e=[],o=function(u){var s=i[u],f=n.safeExecute(function(){return JSON.parse(s)},"BCSParser JSON.parse",null,s),o,h,l,c;if(!f)return{value:null};if(r._numTasks==-1)if(o=t.unpackContentHeader(f),o)r._numTasks=o.taskCount,r._version=o.version,r._prefixCount=o.prefixCount;else return SharedLogHelper.LogError("BCSParser unpackContentHeader",s,new Error("Malformed BCS header")),{value:null};else r._countTasks<r._numTasks?(r._countTasks++,h=t.unpackTask(f),h&&(l=Object.keys(f)[0],r._taskCache[+l]=h)):(c=t.unpackPrefix(f,r._taskCache),c&&e.push(c))},r=this,u=0;u<i.length;u++)if(f=o(u),typeof f=="object")return f.value;return e},t.unpackTask=function(n){var i=Object.keys(n)[0],t=n[i];return t&&t.length==2?{id:t[0],type:parseInt(t[1])}:null},t.unpackPrefix=function(n,i){var s=Object.keys(n)[0],r=n[s],f={prefix:s,tasks:[],engagementSignals:{}},u,e,o;if(r.TSK)for(u=0,e=r.TSK;u<e.length;u++)o=e[u],o in i&&f.tasks.push(i[o]);return r.LL&&(f.engagementSignals=t.unPackSignal(r.LL)),f},t.unPackSignal=function(t){for(var i,e,o,u={},r=0,f=t;r<f.length;r++)i=f[r],i.length==3&&(e=n.getEngagementSignalKey(i[0],String(i[1])),o={SuggestionGroup:i[1],ProbSugClickGivenPref:i[2]},u[e]=o);return u},t.unpackContentHeader=function(n){return n.length==3?{version:parseInt(n[0]),taskCount:parseInt(n[1]),prefixCount:parseInt(n[2])}:null},t}();t.BCSParser=i})(i=t.Bcs||(t.Bcs={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(i){var r=sa_config.th&&ClientTestHooks.isTesthookParamSet("bcsPopulationTrace")?n.log:function(){},u=function(){function n(n,i,u,f,e,o,s){var h=this;this._config=i;this._bcsDataReader=u;this._parser=f;this._rowsToSkip=e;this._onLoadingStopped=s;this._progress=e;t.Promise.safeChain("bcsDataReader.tryOpenFileAsync",function(){return u.tryOpenFileAsync(n)},function(n){n?(r("[BCSDataLoader] file available"),o(function(n){h._storage=n;sb_st(function(){return h.loadBatch()},0)})):(r("[BCSDataLoader] file not available"),h.close())},function(){return h.close()})}return n.prototype.cancel=function(){this._cancelRequested=!0},n.prototype.loadBatch=function(){var n=this;if(this._cancelRequested){this.close();return}this._bcsDataReader.readStringAsync?t.Promise.safeChain("bcsDataReader.readStringAsync",function(){return n._bcsDataReader.readStringAsync(n._config.bcsLoaderBatchSize)},function(t){return n.load(t)},function(){return n.close()}):t.Promise.safeChain("bcsDataReader.loadAsync",function(){return n._bcsDataReader.loadAsync(n._config.bcsLoaderBatchSize)},function(t){t<=0?n.load(null):n.load(n._bcsDataReader.readString(t))},function(){return n.close()})},n.prototype.load=function(n){var t=this;if(this._cancelRequested){this.close();return}n?this.addToDatabase(this._parser.parse(n),function(){return t.loadBatch()}):this.addToDatabase(this._parser.flush(),function(){return t.close()})},n.prototype.addToDatabase=function(n,t){var i=this,u;if(!n){this.close();return}this._rowsToSkip&&(n.length>this._rowsToSkip?(n=n.slice(this._rowsToSkip),this._rowsToSkip=0):(this._rowsToSkip-=n.length,n=[]));n.length>0?(u=n.map(function(n){return{key:n.prefix,value:n}}),this._storage.putMultiple(u,function(){if(i._progress+=u.length,r("[BCSDataLoader] "+i._progress),i._cancelRequested){i.close();return}sb_st(function(){return t()},i._config.bcsLoaderIntervalBetweenBatches)},function(n){SharedLogHelper.LogError("BCSDataLoader addToDatabase",null,n);i.close()})):t()},n.prototype.close=function(){this._bcsDataReader&&(this._bcsDataReader.close(),this._bcsDataReader=null);this._storage=null;this._onLoadingStopped&&(this._onLoadingStopped(this._progress),this._onLoadingStopped=null)},n}();i.BCSDataLoader=u})(i=t.Bcs||(t.Bcs={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(i){var o="BingClientStore",a="BingClientStore2",s="bcs_population_status",h=2,e,f,c,r,u,l;(function(n){n.Populated="P";n.NotPopulated="X"})(e||(e={})),function(n){n.LoadingFromClient="C";n.LoadingFromServer="S";n.NotLoading="X"}(f||(f={}));c=e.Populated+f.NotLoading+n.ClientSideStorage.StorageState.QuerySucceeded,function(n){n.Start="S";n.Pause="P";n.Resume="R";n.Complete="C";n.Active="A";n.Inactive="I"}(r||(r={}));u=sa_config.th&&ClientTestHooks.isTesthookParamSet("bcsPopulationTrace")?n.log:function(){};l=function(){function l(n,t,i,r,u,f,e,o){var s=this;this._config=n;this._clientSideStorageFactory=t;this._bcsDataReader=i;this._lightweightStorage=r;this.onDataPopulated=u;this._instrumentationHelper=e;this._status=null;this._allowPopulation=!1;n.th&&ClientTestHooks.isTesthookParamSet("clearBCS")&&(this._status=this.createEmptyStatus(),this.deleteDb(this._status.dbA),this.deleteDb(this._status.dbB));f.bindShown(function(){return s.start()});n.allowBcsPopulationWhenOtherCortanaCanvasIsActive?(f.bindAppVisible(function(){var n=SearchAppWrapper.CortanaApp.entryPoint;n&&n!="WNSSTB"&&s.start()}),f.bindAppHidden(function(){return s.stop()})):f.bindDismissed(function(){return s.stop()});o.bindItemLaunch(function(){return s.stop()})}return l.prototype.start=function(){this._allowPopulation=!0;this.checkStatus()},l.prototype.stop=function(){this._allowPopulation=!1;this._loader&&this._loader.cancel()},l.prototype.dbPopulatedForCurrentLanguage=function(){if(!this._status)return!1;var n=this.getActiveDb();return this.isFullyPopulated(n)&&n.language==t.getCurrentLanguage()},l.prototype.getActiveVersion=function(){return this._status?this.getVersion(this.getActiveDb()):undefined},l.prototype.getDataSourceState=function(n){var i=this.dbPopulatedForCurrentLanguage()?e.Populated:e.NotPopulated,r=this._dbBeingPopulated?this._dbBeingPopulated.source==0?f.LoadingFromClient:f.LoadingFromServer:f.NotLoading,t=i+r+n;return t==c?undefined:t},l.prototype.getActiveBCSStorage=function(n,t,i){this.getStorage(n,t,i,this.getActiveDb(),!0)},l.prototype.getActiveDb=function(){return this._status.activeDb==this._status.dbA.name?this._status.dbA:this._status.dbB},l.prototype.getInactiveDb=function(){return this._status.activeDb==this._status.dbA.name?this._status.dbB:this._status.dbA},l.prototype.resetDbStatus=function(n){n.version=-1;n.language=null;n.source=null;n.populatedRecords=0;n.totalRecords=-1;n.schemaVersion=n.schemaVersion?n.schemaVersion+1:1},l.prototype.deleteDb=function(t){this.resetDbStatus(t);n.ClientSideStorage.deleteDatabase(t.name);t.schemaVersion=0;this.saveStatus()},l.prototype.isFullyPopulated=function(n){return n.totalRecords>0&&n.populatedRecords==n.totalRecords},l.prototype.isPopulationInProgress=function(n){return n.totalRecords>0&&n.populatedRecords>0&&n.populatedRecords<n.totalRecords},l.prototype.createEmptyStatus=function(){var n={dbA:{name:o},dbB:{name:a},activeDb:o,schemaVersion:h};return this.resetDbStatus(n.dbA),this.resetDbStatus(n.dbB),n},l.prototype.checkStatus=function(){var o,c;if(!this._loader&&(this._status||(o=this._lightweightStorage.getItem(s),o&&(c=n.safeExecute(function(){return JSON.parse(o)},"parse BCS metadata"),c.schemaVersion==h&&(this._status=c)),!this._status&&this._allowPopulation&&(this._status=this.createEmptyStatus(),this.saveStatus())),this._allowPopulation)){var i=this.getActiveDb(),f=this.getInactiveDb(),e=t.getCurrentLanguage();n.contains(this._config.blacklistedBcsVersions,f.version)&&this.deleteDb(f);n.contains(this._config.blacklistedBcsVersions,i.version)&&(this.deleteDb(i),f.version==-1||n.contains(this._config.blacklistedBcsVersions,f.version)||(this._status.activeDb=f.name,this.saveStatus(),i=this.getActiveDb(),f=this.getInactiveDb()));this.isFullyPopulated(i)?this.isPopulationInProgress(f)&&f.language==e?(u("[BCSPopulationManager] resuming inactive "+this.getVersion(f)+" "+f.populatedRecords+"/"+f.totalRecords),this.instrument(f,r.Resume),this.load(f)):i.version<this._config.serverBcsVersion||i.language!=e?this._config.serverBcsSupportedMarkets[e]&&!n.contains(this._config.blacklistedBcsVersions,this._config.serverBcsVersion)?(this.resetDbStatus(f),f.version=this._config.serverBcsVersion,f.source=1,f.language=e,u("[BCSPopulationManager] starting inactive "+this.getVersion(f)),this.instrument(f,r.Start),this.saveStatus(),this.load(f)):u("[BCSPopulationManager] no BCS available to upgrade"):u("[BCSPopulationManager] fully populated "+this.getVersion(i)):this.isPopulationInProgress(i)&&i.language==e?(u("[BCSPopulationManager] resuming active "+this.getVersion(i)+" "+i.populatedRecords+"/"+i.totalRecords),this.instrument(i,r.Resume),this.load(i)):e=="en-us"?(this.resetDbStatus(i),i.source=0,i.language=e,u("[BCSPopulationManager] starting active "+this.getVersion(i)),this.instrument(i,r.Start),this.saveStatus(),this.load(i)):this._config.serverBcsSupportedMarkets[e]&&!n.contains(this._config.blacklistedBcsVersions,this._config.serverBcsVersion)?(this.resetDbStatus(i),i.version=this._config.serverBcsVersion,i.source=1,i.language=e,u("[BCSPopulationManager] starting active "+this.getVersion(i)),this.instrument(i,r.Start),this.saveStatus(),this.load(i)):u("[BCSPopulationManager] no BCS available to populate")}},l.prototype.saveStatus=function(){this._lightweightStorage.setItem(s,JSON.stringify(this._status))},l.prototype.getStorage=function(n,t,i,r,u){var f=this,e=function(n){f.deleteDb(r);t(n)};if(u&&!this.isFullyPopulated(r))return t(new Error("Tried to open unpopulated db: "+r.name)),null;this._clientSideStorageFactory(r.name,n,e,i,r.schemaVersion)},l.prototype.load=function(f){var e=this;if(f.source!=1||n.isBingEnabledCache){var s=new i.BCSParser,h,o=function(){h&&h.close();e._dbBeingPopulated=null;e._loader=null},c=function(n){e.getStorage(function(t){h=t;n(t)},function(n){SharedLogHelper.LogError("open storage",f.name,n);o()},function(){e._loader&&e._loader.cancel()},f,!1)},l=function(n){if(f.populatedRecords==n){u("[BCSPopulationManager] pausing "+e.getVersion(f)+" "+f.populatedRecords+"/"+f.totalRecords);e.instrument(f,r.Pause);o();return}f.populatedRecords=n;f.totalRecords=s.getPrefixCount();f.source==0&&(f.version=s.getVersion());e.isFullyPopulated(f)?(u("[BCSPopulationManager] completed "+e.getVersion(f)),e.instrument(f,r.Complete),e._status.activeDb=f.name,e.saveStatus(),t.Promise.safeChain("cleanupFilesAsync",function(){return e._bcsDataReader.cleanupFilesAsync()}),o(),e.onDataPopulated(),sb_st(function(){return e.checkStatus()},0)):(u("[BCSPopulationManager] pausing "+e.getVersion(f)+" "+f.populatedRecords+"/"+f.totalRecords),e.instrument(f,r.Pause),e.saveStatus(),o())};this._dbBeingPopulated=f;this._loader=new i.BCSDataLoader(this.getUrl(f),this._config,this._bcsDataReader,s,f.populatedRecords,c,l)}},l.prototype.getUrl=function(t){return t.source==0?"http://BuiltInBcs":n.getWindowProtocol()+"//"+n.getWindowHost()+"/bcs/"+t.version+"/"+t.language+".js"},l.prototype.getVersion=function(n){return(n.source==0?f.LoadingFromClient:f.LoadingFromServer)+(n.version==-1?"":n.version)},l.prototype.instrument=function(n,t){t+=this._status.activeDb==n.name?r.Active:r.Inactive;this._instrumentationHelper.instrumentBcsPopulationEvent(this.getVersion(n),t)},l}();i.BCSPopulationManager=l})(i=t.Bcs||(t.Bcs={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function i(n,t,i,r){this._config=n;this._host=t;this._instrumentationHelper=i;this._temporaryMessageHandler=r}return i.prototype.parse=function(i,r,u,f,e,o,s){var h=this,c;if(!f){n.isDataSourceEnabled(t.DataSources.BingContentStore,i,this._config)&&o(t.DataSources.BingContentStore,[],null);n.isDataSourceEnabled(t.DataSources.BCSApps,i,this._config)&&o(t.DataSources.BCSApps,[],null);n.isDataSourceEnabled(t.DataSources.BCSSettings,i,this._config)&&o(t.DataSources.BCSSettings,[],null);return}n.isDataSourceEnabled(t.DataSources.BingContentStore,i,this._config)&&(c={engagementSignals:f.engagementSignals,rankerExtraInfo:f.bcsVersion?{bcsVersion:f.bcsVersion}:undefined},o(t.DataSources.BingContentStore,[],c));t.lookupById(i,t.DataSources.BCSApps,t.LocalSuggestionTypes.BCSApp,f.appIds,f.appIds,function(n){return[n]},t.DataSources.BCSSettings,t.LocalSuggestionTypes.BCSSetting,f.settingIds,f.settingIds,function(n){return n},e,r,o,s,function(u,f,e,o){e.length==1&&n.safeExecute(function(){return t.parseLocalSuggestion(i,e[0],f,r,h._host,h._config,h._temporaryMessageHandler,e[0].suggestionType,h._instrumentationHelper,o,function(){return!0})},"parseLocalSuggestion "+f)},null,null,null,null,this._config,this._instrumentationHelper)},i}();t.BCSSuggestionParser=i})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){var i;(function(i){var r=function(r){function u(n,f,e,o,s,h){var l=this,a=function(){return l.reloadStorage()},c=new i.BCSPopulationManager(n,f,SearchAppWrapper.CortanaApp.bcsDataReader,h,a,e,o,s),v=function(n,t,i){return c.getActiveBCSStorage(n,t,i)},y=function(){return c.dbPopulatedForCurrentLanguage()},p=function(n){return c.getDataSourceState(n)},w=function(t,i,r){return u.createBcsResponse(i,r,c.getActiveVersion(),n)};return l=r.call(this,n,v,w,y,p,t.DataSources.BingContentStore,0,e)||this}return __extends(u,r),u.createBcsResponse=function(t,i,r,u){return!t||!i?{appIds:[],settingIds:[],engagementSignals:{},bcsVersion:i?r:undefined}:n.safeExecute(function(){var e=[],o=[],n,f,i;if(t.tasks)for(n=0,f=t.tasks;n<f.length;n++)i=f[n],i.type==1?e.push(i.id):o.push(i.id);return{appIds:e,settingIds:o,engagementSignals:u.enableBcsSignals?t.engagementSignals:undefined,bcsVersion:r}},"createBcsResponse")},u}(n.ClientSideStorage.StorageBasedDataProvider);i.BCSDataProvider=r})(i=t.Bcs||(t.Bcs={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(i,r,u,f){var e=this;f.bindShown(function(){var u,o,f,s;n.isBingEnabledCache&&(u=e.getContstraintIndexInfo(r.lastUrl),e._ciVersion=String(u.version),o=t.getCurrentLanguage(),f=i.ciVersion,f>0&&i.supportedCiMarkets[o]&&(o!=u.language||f>u.version||f<u.version&&n.contains(i.blacklistedCiVersions,u.version))&&(s=e.getUrlForCINotification(f,o),t.Promise.safeChain("constraintIndexDownloader.tryDownloadFromUrlAsync",function(){return r.tryDownloadFromUrlAsync(s)},function(){})))})}return i.prototype.getContstraintIndexInfo=function(n){var r=-1,u="",t,i;return n&&(t=n.split("/"),t.length>1&&(i=t[t.length-1].split("."),u=i.length==2?i[0]:"",r=+t[t.length-2])),{version:r,language:u}},i.prototype.getUrlForCINotification=function(t,i){return n.getWindowProtocol()+"//"+n.getWindowHost()+"/bcs/ci/"+t+"/"+i+".cab"},i.prototype.getCurrentCiVersion=function(){return this._ciVersion},i}();i.ConstraintIndexDataLoader=r})(i=t.ConstraintIndex||(t.ConstraintIndex={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){var i=function(i){function r(n){return i.call(this,n,n.lowQpsDataSourcesFetchDelay)||this}return __extends(r,i),r.prototype.getDataSource=function(){return t.DataSources.MyStuffOneDrive},r.prototype.getBaseUrl=function(){return this._config.myStuffOneDriveRootUrl},r.prototype.getPostBody=function(n){return n.taskFrame},r.prototype.fetch=function(t,r,u,f,e,o,s){var h=Object.assign({},o);delete h[n.Service.QueryParams.ImpressionGuid];i.prototype.fetch.call(this,t,r,u,f,e,h,s)},r}(n.JsonDataProvider);t.MyStuffOneDriveDataProvider=i})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function r(t){return i||(i=_d.createElement("span")),n.safeExecute(function(){return i.innerHTML=t,i.innerText},t,"decodeHtml")}var i,u=function(){function i(n,t){this._config=n;this._host=t}return i.prototype.parse=function(n,i,r,u,f,e){var o=[];u&&(u.Results?(this.addContent(n,o,u.Results.OneDriveDocuments,t.LocalSuggestionTypes.Document,t.Scope.Documents,i),this.addContent(n,o,u.Results.OneDriveFolders,t.LocalSuggestionTypes.Folder,t.Scope.Folders,i),this.addContent(n,o,u.Results.OneDriveImages,t.LocalSuggestionTypes.Photo,t.Scope.Photos,i),this.addContent(n,o,u.Results.OneDriveVideos,t.LocalSuggestionTypes.Video,t.Scope.Videos,i),this.addContent(n,o,u.Results.OneDriveAudio,t.LocalSuggestionTypes.Music,t.Scope.Music,i)):SharedLogHelper.LogError("MyStuffOneDriveParser",null,new Error("Missing Results property")));t.decorateLocalFilesAndFoldersAndMediaWithParentFolder(n,o,this._config,this._host);e(t.DataSources.MyStuffOneDrive,o,null)},i.prototype.addContent=function(i,u,f,e,o,s){var y=this,l,a,p,v;if(f&&n.isSuggestionTypeEnabled(t.DataSources.MyStuffOneDrive,e,7,i,this._config)){var c=t.Scope[o],w=function(f){var l,p,v;if(!f.Content)return SharedLogHelper.LogError("MyStuffOneDriveParser",c,new Error("Missing Content property")),{value:void 0};if(l=f.Content.OneDriveData,!l)return SharedLogHelper.LogError("MyStuffOneDriveParser",c,new Error("Missing OneDriveData property")),{value:void 0};if(p=l.propertyHits.length==1&&l.propertyHits[0]=="TextContent",p&&(!h._config.minLengthForContentMatch||i.queryToFetch.length<h._config.minLengthForContentMatch))return{value:void 0};if(v=l.SeeMore,!v)return SharedLogHelper.LogError("MyStuffOneDriveParser",c,new Error("Missing SeeMore property")),{value:void 0};var w=r(l.Name),nt=HitHighlightingParser.removeMarkers(w),b=t.ScopeConfig[o].icon,tt=t.isMedia(e),it=t.getOneDriveSuggestionIcon(tt,b,l.Thumbnail.replace(":Thumbnail",":Cropped176x176#h=176&w=176"),l.Extension,l.Id),a=t.createSuggestion(w,it,b,e,nt,n.InstrumentedItem.createInstrumentedItem(s),7,s,!0);a.url=v;a.path=l.FullPath;a.matchedOnlyOnContent=p;var k=void 0,d=void 0,g=void 0;e==t.LocalSuggestionTypes.Document&&l.TextContent&&(k=HitHighlightingParser.removeMarkers(l.TextContent));l.Artist&&(d=HitHighlightingParser.removeMarkers(l.Artist));l.Album&&(g=HitHighlightingParser.removeMarkers(l.Album));t.setFileTemplate(i,a,l.DateModified,null,k,d,g,h._host);t.setSource(h._config,h._host,i,a,t.OneDriveSource);a.click=function(){return y._host.launchUrl(v)};l.LocationUrl&&(a.locationUrl=l.LocationUrl,t.setExtraVerbs(a,function(){var n={verb:"OpenFileLocationInOneDrive",displayName:y._host.getLocString("OpenFileLocationIn",t.OneDriveSource),executeAsync:function(){return t.getLaunchUrlContextMenuAction(l.LocationUrl)}};return[n]}));t.isValidSuggestion(a,"MyStuffOneDriveParser "+c)&&u.push(a)},h=this;for(l=0,a=f;l<a.length;l++)if(p=a[l],v=w(p),typeof v=="object")return v.value}},i}();t.MyStuffOneDriveParser=u})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this._host=n;this._host.bindQueryChangedOrInitialized(function(){t._previousSignals=t._currentSignals;t._previousQuery=t._currentQuery;t._currentSignals=null;t._currentQuery=null});this._host.bindConversationStart(function(){t._previousSignals=null;t._previousQuery=null;t._currentSignals=null;t._currentQuery=null})}return n.prototype.updateCacheData=function(n,t){this._currentQuery=n;this._currentSignals=t},n.prototype.getPreviousEventData=function(n){return this.isPreviousEventQuery(this._previousQuery,n)?this._previousSignals:null},n.prototype.isPreviousEventQuery=function(n,t){return n&&t&&n.length==t.length-1&&t.startsWith(n)},n}();n.WebSignalsCache=t})(t=n.Cache||(n.Cache={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(t){function l(t,f){e=t;c=f;var o=_ge("dialogBox");if(!o){n.log("DialogBox wrapper element not found");return}sj_be(o,"click",function(n){var u=n.target.id,t=i.filter(function(n){return n.id==u}).shift();t?(t.action&&t.action(),r()):u=="dialog_overlay"&&r();sj_sp(n)},!0);f.bindKeyDown(function(n){var f,e,t,o,r,i;switch(n){case 39:for(t=u(),e=!1,r=0,i=void 0;i=t[r];r++)if(e){f=i;break}else if(e=i.selected==!0,e&&r+1==t.length){f=t[0];break}break;case 37:for(t=u(),o=void 0,r=0,i=void 0;i=t[r];r++){if(i.selected==!0){f=o?o:t[t.length-1];break}o=i}}f&&h(f)})}function a(n,t){i=[];var r;if(t.length==0)throw new Error("DialogBox: Empty buttons array");i=t.map(function(n,t){var i=n;return i.id="dialog_b"+t,i.narratorText=i.text,i.selected&&(r=i.id),i});e.updateDialogBox(!0,n,i);r&&sb_st(function(){return _ge(r).focus()},0);f=!0}function r(){f&&(e.updateDialogBox(!1),f=!1)}function o(){return f}function u(){return i.forEach(function(n){return n.selected=_ge(n.id)==_d.activeElement}),i}function s(){return u().filter(function(n){return n.selected}).shift()}function h(n){for(var r,t=0,u=i;t<u.length;t++)r=u[t],r.selected=r.id==n.id,r.selected&&_ge(n.id).focus()}function v(){if(o()){var n=s();n&&(n.action&&n.action(),r())}}var i=[],e,c,f=!1;sj_be(sj_b,"keydown",function(n){if(n.keyCode==9&&o()){var t=u();t.length>0&&t[t.length-1].selected&&r();sj_sp(n)}},!0);t.init=l;t.show=a;t.hide=r;t.isVisible=o;t.getSelectableItems=u;t.getSelectedItem=s;t.select=h;t.submit=v})(i=t.DialogBox||(t.DialogBox={}))})(t=n.Windows||(n.Windows={}))}(AutoSuggest||(AutoSuggest={}))