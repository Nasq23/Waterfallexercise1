var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},AutoSuggest;(function(n){var t;(function(t){function u(t,i,r){if(i==n.GroupType.EdgeHistory&&!r)return!1;var u=HitHighlightingParser.removeMarkers(t.text),f=u?u.length:0;return t.additionalInfoText&&!r&&(f+=t.additionalInfoText.length),f>(r?ct:lt)}function d(t){return t==n.GroupType.EdgeHistory}function g(n){for(var i,r={topResults:n.topResults.slice(0),groups:[]},t=0,u=n.groups;t<u.length;t++)i=u[t],r.groups.push({type:i.type,suggestions:i.suggestions.slice(0)});return r}function nt(n,r){if(n.isAnswer)return ot;if(n.grid)return(r?t.IconSize_GridLayout:t.IconSize_GridLayout_Medium)+2*i;var u=n.hasAdditionalInfoText&&n.hasSecondaryText?et:!n.hasAdditionalInfoText&&!n.hasSecondaryText?ut:ft;return n.wrapsToTwoLines&&(u+=y),u<v&&(u=v),u}function vt(n,i){if(t.uses3lineTemplate(i))return nt({wrapsToTwoLines:!1,hasSecondaryText:!0,hasAdditionalInfoText:!0,isAnswer:!1,isSuppressed:n.isSuppressed,grid:!1},null);if(n.isSuppressed)return 0;var r=it;return n.wrapsToTwoLines&&(r+=y),n.hasSecondaryText&&(r+=e-1),r}function yt(n,i){var r=a,u,f;return i.type&&t.isPhotoOrVideo(i.type)?(u=Math.ceil(i.suggestions.length/(t.isL2(n)?b:k)),f=t.isL2(n)?p:w,r+=f*u,r+=2*o):i.suggestions.forEach(function(n){return r+=vt(n,i.type)}),r}function pt(n){switch(n){case 0:return t.SearchServiceStatus.ContinuePending;case 7:return t.SearchServiceStatus.Disabled;case 1:return t.SearchServiceStatus.PausePending;case 2:return t.SearchServiceStatus.Paused;case 4:return t.SearchServiceStatus.StartPending;case 5:return t.SearchServiceStatus.StopPending;case 6:return t.SearchServiceStatus.Stopped}return undefined}function s(n,t){return n.length>0&&t.length>0?n.concat(at).concat(t):n.length>0?n:t.length>0?t:[]}var h=4,c=6,f=8,i=12,l=1,r=20,e=16,it=r+2*f,a=16+2*f,rt=a,v=60,ut=r+2*i,ft=r+e+h+2*i,et=r+2*(e+h)+2*i,ot=80+2*i,st=f,y=r,ht=48,o=1,p=t.IconSize_GridLayout+2*(c+l),w=t.IconSize_GridLayout_Medium+2*(c+l),b=3,k=4,ct=39,lt=42,at={verb:null,displayName:null,executeAsync:null},tt;t.wrapsToTwoLines=u;t.joinVerbsWithSeparator=s;tt=function(i){function r(r,u,f,e,o,s,h,c,l){var a=i.call(this,r,u,e,o,h)||this,v;return a._host=u,a._autoComplete=f,a._navigationHelper=s,a._scopesViewModel=c,a._previewPane=l,a._pendingSubmitSequenceNumber=-1,a._pendingSubmitModifierKeys=null,a._resultsCounter={topResults:[],groups:[]},a._pendingSuggestionsInExistingGroups=[],a._pendingSuggestionsInMissingGroups=[],h.setContextMenuHandler(function(t,i){return n.safeExecute(function(){return a.showContextMenu(t,i.pageX,i.pageY)},"contextMenuHandler")}),h.setSuggestionClickHandler(function(t){return n.safeExecute(function(){return a.click(t)},"suggestionClickHandler")}),h.setRemoveSuggestionClickHandler(function(t,i){return n.safeExecute(function(){return a.remove(t,i)},"removeSuggestionClickHandler")}),h.setOpenPreviewPaneClickHandler(function(t,i){return n.safeExecute(function(){return a.openPreviewPane(t,i)},"openPreviewPaneClickHandler")}),a._previewPane&&a._previewPane.bindItemLaunch(function(n,t,i){return a.onPreviewPaneItemClick(n,t,i)}),u.bindKeyUp(function(n,t,i){return a.onKeyUp(n,t,i)}),u.bindCursorPositionUpdated(function(n){return a.onCursorPositionChanged(n)}),u.bindShown(function(){!t.isMobileCache&&SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSearchServiceStatusAsync&&t.Promise.safeChain("getSearchServiceStatusAsync",function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSearchServiceStatusAsync()},function(n){a._instrumentationHelper.setSearchServiceStatus(pt(n));n!=0&&n!=4&&n!=3&&n!=7&&a.showIndexingMessage(!1)})}),u.bindDismissed(function(){a._pendingSuggestionsInExistingGroups=[];a._pendingSuggestionsInMissingGroups=[];a.removeProgressBar();t.ContextMenus.dismiss();a._page.updateStartMenu([]);a._previewPane&&a._previewPane.reset();a._page.hideTemporaryMessage();a.hideIndexingMessage();t.DialogBox&&t.DialogBox.hide();a._scopesViewModel.render(null,!1,!0,!1,!0)}),h.bindOnNarratorLaunch(function(n){for(var t,u=a.getSelectableItems(),i=0,r=u;i<r.length;i++)if(t=r[i],t.id==n){a.select(t,!1);a.submit(!1,t.sequenceNumber,function(){},null,!0);break}}),r.searchBoxFocusEvents?(u.bindSearchBoxGotFocus(function(){t.ContextMenus.dismiss();var i=n.getCurrentActiveElement();i&&i.blur();a.toggleSelectedSuggestionState(!0)}),u.bindSearchBoxLostFocus(function(){var i=t.isScopeTile(n.getCurrentActiveElement());i?sb_st(function(){SearchAppWrapper.CortanaApp.searchBox.hasFocus||a.toggleSelectedSuggestionState(!1)},75):a.toggleSelectedSuggestionState(!1)})):(v=SearchAppWrapper.CortanaApp.searchBox,v.addEventListener("keydown",function(n){n.keyCode==9&&a._selectedItem&&a.toggleSelectedSuggestionState(!1)})),sj_evt.bind("CortanaPaneWidthSet",function(n){return a.onPaneWidthSet(n[1])}),sj_be(_ge("qfContainer"),"scroll",t.ContextMenus.dismiss),a}return __extends(r,i),r.prototype.onPaneWidthSet=function(n){k=Math.floor((n-2*o)/w);b=Math.floor((n-2*o)/p)},r.prototype.toggleSelectedSuggestionState=function(n){this._selectedItem&&(this._selectedItem.selected=n,this.renderSelection(this._selectedItem))},r.prototype.update=function(n,r,u,f,e,o,s,h,c){var a=this,l;return this._config.startMenuPrototypeEnabled&&this._partialQuery.scope==t.Scope.Apps&&!this._partialQuery.queryToFetch&&e.length?(this.getMockedStartMenuGroupsAsync(f,e,function(n){return a._page.updateStartMenu(n)}),0):(l=i.prototype.update.call(this,n,r,u,f,e,o,s,h,c),(l===0||c)&&this.removeProgressBar(),this._config.previewPaneIcon==4&&(this._root||(this._root=_ge("root")),r.some(function(n){return t.supportsPreview(n)})?this._root.classList.contains("ppChevronMin")||this._root.classList.add("ppChevronMin"):this._root.classList.contains("ppChevronMin")&&this._root.classList.remove("ppChevronMin")),l)},r.prototype.getMockedStartMenuGroupsAsync=function(i,r,u){var f={},l=r.length,h="&#ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),o,c,s,e;for(h.unshift(t.CortanaFontIcons.Recent),h.push(t.SegoeFontIcons.Globe),h.forEach(function(n){return f[n]=[]}),o=0,c=r;o<c.length;o++)s=c[o],e=s.text[0].toLocaleUpperCase(),isNaN(parseFloat(e))||(e="#"),this.setupIcon(i,s,!1,function(){l--;l==0&&u(Object.keys(f).map(function(t){var r=!f[t].length,u="st_gr_"+t;return{id:u,cssClasses:r?"disabled":"",type:n.GroupType.Apps,text:t,suggestions:f[t],instItem:null,sequenceNumber:i,selected:!1,icon:t.startsWith("&#x")?{type:1,content:t}:null,click:function(){if(!r){var n=_ge("startMenu");n.classList.toggle("onlyGroups");n.scrollTop=_ge(u).offsetTop-n.offsetTop}}}}),Object.keys(f))}),f[e]=f[e]||[],f[e].push(s)},r.prototype.removeProgressBar=function(){this._config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),this._page.setProgressIndicatorVisibility(!1))},r.prototype.resetPendingSubmitSequenceNumber=function(){this._pendingSubmitSequenceNumber=null;this._stopFurtherProcessing=null;this._pendingSubmitModifierKeys=null},r.prototype.onCursorPositionChanged=function(n){this._partialQuery&&(this._partialQuery.cursorPosition=n.cursorPosition)},r.prototype.onAfterKeyDown=function(i,r,u){if(i!=13&&(this._page.hideTemporaryMessage(),this.resetPendingSubmitSequenceNumber()),(!t.DialogBox||!t.DialogBox.isVisible())&&!this._scopesViewModel.isScopesL2Visible()){if(!u&&n.isContextMenuKey(i,r.shiftKey,!1)){this.tryShowContextMenu();return}if(t.ContextMenus.isContextMenuVisible()){n.isUpOrDownKey(i)||i==13||t.ContextMenus.dismiss();return}if(this._previewPane){var f=this._selectedItem&&!this.isGroup(this._selectedItem)?this._selectedItem:null;this._previewPane.onAfterKeyDown(i,this._partialQuery,f,this)}n.isUpOrDownKey(i)&&this._selectedItem&&(this._selectedItem==this.topResults[0]?this._page.scrollToTop():this._page.scrollTo(this._selectedItem))}},r.prototype.onKeyUp=function(i,r,u){if(i==9&&this._selectedItem&&!this._config.searchBoxFocusEvents){var f=n.getCurrentActiveElement();this.toggleSelectedSuggestionState(t.isBodyOrSuggestion(f));return}if(!u&&n.isContextMenuKey(i,r.shiftKey,!0)){this.tryShowContextMenu();return}},r.prototype.tryShowContextMenu=function(){var n=this._selectedItem&&!this.isGroup(this._selectedItem)?this._selectedItem:null,t;n&&(t=_ge(n.id),this.showContextMenu(n,120,t.offsetTop+this._page.getScrollTop()+24))},r.prototype.onQueryChanged=function(r,u){var c=this,l,e,o,s,a,v,h,y,f;if(t.DialogBox&&t.DialogBox.hide(),this._page.updateStartMenu([]),this._config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),r.showProgressBar?this._progressTimer=sb_st(function(){return n.safeExecute(function(){c._progressTimer&&(c._page.setProgressIndicatorVisibility(!0),c._progressTimer=null)},"showProgress")},250):this._page.setProgressIndicatorVisibility(!1)),i.prototype.onQueryChanged.call(this,r,u),t.ContextMenus.dismiss(),!this._partialQuery||!this._partialQuery.equals(r)){if(this._page.hideTemporaryMessage(),this._partialQuery&&this._partialQuery.scope!=r.scope&&(this._turnOnIndexingInstItem||this.hideIndexingMessage()),l=this._partialQuery?this._partialQuery.queryToFetch:"",e=r.queryToFetch,this._previewPane)this._previewPane.onQueryChanged(this._partialQuery,r,this);for(this._partialQuery=r,o=!1,s=0,a=this.topResults;s<a.length;s++)f=a[s],f.updateFromQuery?f.updateFromQuery(r)&&(o=!0):e.length>l.length&&e.startsWith(l)&&f.query&&f.query.toLowerCase().includes(r.queryToFetch.toLowerCase())&&(v=f.text.indexOf(HitHighlightingParser.endMarker),v>=0&&v<f.text.length-1&&(f.text=HitHighlightingParser.addMarkers(HitHighlightingParser.removeMarkers(f.text),e),o=!0));if(o){for(h=0,y=this.topResults;h<y.length;h++)f=y[h],n.contains(t.SyntheticQSCodes.SyntheticSuggestionTypesCreatedInAggregator,f.type)&&this._instrumentationHelper.instrumentSyntheticSuggestion(u,f),f.sequenceNumber=u;this.renderTopResults();this._instrumentationHelper.instrumentTopResultRendered(u,this.topResults.map(function(n){return n.type}))}}},r.prototype.onSuggestionsParsed=function(n,i,r,u){(u===t.LocalProviderIndexerState.NotIndexed||u===t.LocalProviderIndexerState.PartiallyIndexed)&&(r==t.DataSources.LocalApps||r==t.DataSources.LocalSettings||n.scope!=t.Scope.All)&&n.scope!=t.Scope.Web&&this.showIndexingMessage(!0)},r.prototype.getSuggestions=function(n){var t=this.getCurrentTopResults();return this.groups.forEach(function(n){return t=t.concat(n.suggestions)}),n&&(this._pendingSuggestionsInExistingGroups.forEach(function(n){return t=t.concat(n.suggestions)}),this._pendingSuggestionsInMissingGroups.forEach(function(n){return t=t.concat(n.suggestions)})),t},r.prototype.getSelectableItems=function(){var n,i,u,r;if(t.DialogBox&&t.DialogBox.isVisible())return t.DialogBox.getSelectableItems();if(t.ContextMenus.isContextMenuVisible())return t.ContextMenus.getSelectableItems();if(this._scopesViewModel.isScopesL2Visible())return this._scopesViewModel.getSelectableItems();if(!this._partialQuery.fullPartialQuery)return[];for(n=this.topResults,i=0,u=this.groups;i<u.length;i++)r=u[i],r.click&&(n=n.concat(r)),n=n.concat(r.suggestions.filter(function(n){return!n.suppressed}));return n},r.prototype.getSelectedItem=function(){return t.DialogBox&&t.DialogBox.isVisible()?t.DialogBox.getSelectedItem():t.ContextMenus.isContextMenuVisible()?t.ContextMenus.getSelectedItem():this._scopesViewModel.isScopesL2Visible()?this._scopesViewModel.getSelectedItem():this._selectedItem},r.prototype.updateSelectionState=function(t){n.contains(this.topResults,t)?this.renderTopResults():this.groups.some(function(i){return n.contains(i.suggestions,t)})&&this.renderGroups()},r.prototype.renderSelection=function(t,i){(t&&n.contains(this.topResults,t)||i&&n.contains(this.topResults,i))&&this.renderTopResults();(t&&this.isGroup(t)&&n.contains(this.groups,t)||t&&this.groups.some(function(i){return n.contains(i.suggestions,t)})||i&&this.isGroup(i)&&n.contains(this.groups,i)||i&&this.groups.some(function(t){return n.contains(t.suggestions,i)}))&&this.renderGroups()},r.prototype.select=function(n,i){var u,r;if(t.DialogBox&&t.DialogBox.isVisible())t.DialogBox.select(n);else if(t.ContextMenus.isContextMenuVisible())t.ContextMenus.select(n);else if(this._scopesViewModel.isScopesL2Visible())this._scopesViewModel.select(n,!1);else{if(u=this._selectedItem,u&&(u.selected=!1),this._previewPane)this._previewPane.onSelectionChanged(this._partialQuery,!this._selectedItem||this.isGroup(this._selectedItem)?null:this._selectedItem,!n||this.isGroup(n)?null:n,this.topResults[0]==n);this._selectedItem=n;n&&(n.selected=!this._config.searchBoxFocusEvents||SearchAppWrapper.CortanaApp.searchBox.hasFocus);this.renderSelection(n,u);i&&(r=n?n.query:null,r&&this._partialQuery.scopePrefix&&(r=this._partialQuery.scopePrefix.trim()+": "+r),this._host.setQuery(r,!1,!1))}},r.prototype.setupIcon=function(t,i,r,u){var f=this,e;i.getIcon&&!i.suppressed?(this._instrumentationHelper.notifyIconPending(t,r,i.instItem.getLayoutKValue(),i.type),e=this._partialQuery,i.getIcon(this.getImageSize(e,i,r),function(o){i.icon=o;var s=function(){t==f._sequenceNumberReader.getSequenceNumber()&&(f._instrumentationHelper.notifyIconReady(t,r,i.instItem.getLayoutKValue(),i.type),r?n.contains(f.topResults,i)&&f.renderTopResults():f.groups.some(function(t){return n.contains(t.suggestions,i)})&&f.renderGroups(),u())};f.populateImageRatio(e,i,s)})):u()},r.prototype.populateImageRatio=function(n,i,r){var f=this,u;i.icon&&i.icon.type==0&&(t.isPhotoOrVideo(i.type)||i.type==t.OnlineSuggestionTypes.Person)?(u=function(n){f.updateRatio(i,n);r()},this.getIconDimensions(i.icon,u)):r()},r.prototype.getIconDimensions=function(n,t){var i=new Image;i.src=n.content;i.onload=function(){return t({height:i.height,width:i.width})}},r.prototype.updateRatio=function(n,t){n.icon.ratio=t.height==t.width?1:t.height>t.width?3:2},r.prototype.getImageSize=function(n,i,r){return n.scope==t.Scope.Apps&&!n.queryToFetch?3:t.isPhotoOrVideo(i.type)?2:r?0:1},r.prototype.allowUnselectedState=function(){return this._scopesViewModel.isScopesL2Visible()?this._scopesViewModel.allowUnselectedState():this.topResults.length==0},r.prototype.isGroup=function(n){return!!n.suggestions},r.prototype.submit=function(i,r,u,f,e){var o,s,h;if(this._scopesViewModel.isScopesL2Visible()){if(o=this._scopesViewModel.getSelectedItem(),o){o.click();return}}else if(t.DialogBox&&t.DialogBox.isVisible()){t.DialogBox.submit();u();return}if(s=t.ContextMenus.getSelectedItem(),h=e?2:i?3:0,s){s.click(h,f);u();return}var c=n.getCurrentActiveElement(),l=!t.isBodyOrSuggestion(c),a=this._host.isRequestFocusAvailable();if(l){a||(c.click(),u());return}if(this._lastUpdatedSequenceNumber!=r&&(!this._selectedItem||this._selectedItem==this.topResults[0])){this._pendingSubmitSequenceNumber=r;this._pendingSubmitModifierKeys=f;this._stopFurtherProcessing=u;return}this._selectedItem?(this._selectedItem.instItem&&this._instrumentationHelper.instrumentCustomGping(h,this._selectedItem.instItem.getHValue(),null,f),this.click(this._selectedItem,f),u()):this.groups.length>0&&this._partialQuery.fullPartialQuery&&this.showDisableEnterMessage()},r.prototype.onPreviewPaneItemClick=function(n,t,i){this._instrumentationHelper.instrumentCustomGping(t,n.instItem.getHValue(),null,null,i);this._instrumentationHelper.onItemClick(n.sequenceNumber,n.sequenceNumber>this._lastUpdatedSequenceNumber,n.instrumentPingBack);this.onSuggestionLaunch(n)},r.prototype.click=function(n,i){if(this._page.hideTemporaryMessage(),n.instItem)this._instrumentationHelper.onItemClick(n.sequenceNumber,n.sequenceNumber>this._lastUpdatedSequenceNumber,this.isGroup(n)?null:n.instrumentPingBack);if(this.isGroup(n)){n.click();return}var r=n;i=i||this._host.getModifierKeyState();i.ctrlKey&&i.shiftKey?this.launchVerb(r,t.Verbs.LaunchAsAdmin):i.shiftKey?this.launchVerb(r,t.Verbs.OpenInNewWindow):r.click();this.onSuggestionLaunch(r)},r.prototype.remove=function(n,i){i.stopPropagation();this._page.hideTemporaryMessage();this._instrumentationHelper.onItemClick(n.sequenceNumber);this.launchVerb(n,t.Verbs.RemoveFromDeviceHistory);this._host.setFocusInSearchBox("remove")},r.prototype.launchVerb=function(n,i){this.getDeviceItemVerbsAsync("launchVerb",n,function(r){for(var o,f=!1,s=function(n){n.verb==i&&(t.Promise.safeChain(i+".executeAsync",function(){return n.executeAsync()}),f=!0)},u=0,e=r;u<e.length;u++)o=e[u],s(o);f||n.click()})||n.click()},r.prototype.showContextMenu=function(n,i,r){var u=this,f=this.getDeviceItemVerbsAsync("showContextMenu",n,function(f){return sb_st(function(){return t.ContextMenus.showContextMenu(u.extendVerbs(f,n),i,r,function(t,i,r){u._instrumentationHelper.onItemClick(n.sequenceNumber);u._instrumentationHelper.instrumentCustomGping(i,n.instItem.getHValue(),t,r)},u._page,function(){u._host.setFocusInSearchBox("contextMenuDismiss")})},0)});f||(this._page.hideTemporaryMessage(),this._host.setFocusInSearchBox("noContextMenu"))},r.prototype.extendVerbs=function(n,i){var r=this;return n.map(function(n){var u,f,e;switch(n.verb){case"StartPin":u="PinnedToStart";break;case"TaskbarPin":u="PinnedToTaskbar";break;case"StartUnpin":u="UnpinnedFromStart";break;case"TaskbarUnpin":u="UnpinnedFromTaskbar";break;case"Tile.Uninstall":f="UninstallConfirmation";u="UninstallationInProgress"}return e=function(n){var f=n();return u?r._page.showTemporaryMessage(r._host.getLocString(u,HitHighlightingParser.removeMarkers(i.text)),{content:t.CortanaFontIcons.Info,type:2}):r._page.hideTemporaryMessage(),f},new t.DeviceItemVerbWrapper(n,function(i){return f&&t.DialogBox?(t.DialogBox.show(r._host.getLocString(f),[{text:n.displayName,action:function(){return e(i)},selected:!1},{text:r._host.getLocString("Cancel"),selected:!0}]),undefined):e(i)})})},r.prototype.getDeviceItemVerbsAsync=function(n,i,r){var f=this,o=t.asJumpListSuggestion(i),u,e;return o?(t.Promise.safeChain("jumpListItem.getVerbsAsync",function(){return o.jumpListItem.getVerbsAsync()},function(n){return f.handleExtraVerbsAsync(n||[],i,u,r)},function(){return f.handleExtraVerbsAsync([],i,u,r)},null,n+" "+i.type),!0):(u=n+" "+i.type,e=t.getItemWithFileMetadata(i),e&&e.canHaveContextMenu)?(t.Promise.safeChain("getVerbsAsync",function(){return e.getVerbsAsync()},function(n){return f.handleExtraVerbsAsync(n||[],i,u,r)},function(){return f.handleExtraVerbsAsync([],i,u,r)},null,u),!0):i.getExtraVerbsAsync?(this.handleExtraVerbsAsync([],i,u,r),!0):i.getExtraVerbs?(this.handleExtraVerbs([],i,r),!0):!1},r.prototype.handleExtraVerbsAsync=function(n,i,r,u){var f=this;n=n.slice(0);i.getExtraVerbsAsync?t.Promise.safeChain("getExtraVerbsAsync",function(){return i.getExtraVerbsAsync()},function(t){return f.handleExtraVerbs(s(n,t),i,u)},function(){return f.handleExtraVerbs(n,i,u)},null,r):this.handleExtraVerbs(n,i,u)},r.prototype.handleExtraVerbs=function(n,t,i){t.getExtraVerbs?i(s(n,t.getExtraVerbs())):i(n)},r.prototype.getGroupHeaderClickAction=function(i,r,u){var f=this,e,o,s;if(!t.isMobileCache&&(e=t.getScope(r,this._config),e!=t.Scope.All))return t.isL2(i)||!t.isScopeEnabled(e,t.ScopeConfig[e],this._config)?[null,null]:[function(){return f._scopesViewModel.clickHandler(e,"groupHeader")},null];switch(r){case n.GroupType.Store:o=function(){return f._host.launchStoreSearch(i.queryToFetch)};break;case n.GroupType.SearchSuggestions:o=function(){return f.launchSearch(i,u)};break;case n.GroupType.PathCompletion:o=function(){return f._host.launchFolder(f.getFolderPathForPathCompletion(i))}}if(o){if(!u)throw"No QS code for: "+n.GroupType[r];return s=n.InstrumentedItem.getNonSuggestionInstrumentedItem(u,t.SyntheticQSCodes.KValues),[o,s]}return[null,null]},r.prototype.getFolderPathForPathCompletion=function(n){return n.queryToFetch.substring(0,this._partialQuery.queryToFetch.lastIndexOf("\\"))},r.prototype.getGroupTitleAndNarratorText=function(i,r,u,f){var s,o,e,h,c;if(r==n.GroupType.PathCompletion)return s=this.getFolderPathForPathCompletion(i)+"\\"+String.fromCharCode(8206),{title:s,narratorText:s};if(u&&(o=u.groupDisplayName,o))return{title:o,narratorText:o};switch(r){case n.GroupType.Command:e=this._host.getLocString("CommandGroup");break;case n.GroupType.Cortana:e=this._host.getLocString("CortanaGroup");break;case n.GroupType.Store:e=this._host.getLocString("StoreGroup");break;case n.GroupType.PowerBi:e=this._host.getLocString("PowerBIGroup");break;case n.GroupType.EdgeHistory:e=this._host.getLocString("EdgeHistoryGroup");break;case n.GroupType.VCDExamples:e=this._host.getLocString("VCDExamplesGroup");break;case n.GroupType.LocalPlaces:e=this._host.getLocString("LocalPlacesGroup");break;case n.GroupType.Related:e=this._host.getLocString("RelatedSuggestionsGroup");break;case n.GroupType.SearchSuggestions:this._config.splitWebGroupIntoSuggestionsAndWebsites&&(e=this._host.getLocString("SearchSuggestions"));break;case n.GroupType.Websites:e=this._host.getLocString("Websites")}if(!e){if(h=t.getScope(r,this._config),h==t.Scope.All)throw new Error("Unknown group type: "+r);c=t.ScopeConfig[h];e=t.getScopeDisplayName(c,this._host)}return{title:e,narratorText:f?this._host.getLocString("AddingScopeNarratorText",e.toLocaleLowerCase()):e}},r.prototype.addGroup=function(i,r,u,f,e){var o,l,a;if(this.groups.some(function(n){return n.type==i&&n.source==r}))throw new Error("Trying to add repeated group "+i);var v=t.GroupHeaderQSCodes[i],y=this.getGroupHeaderClickAction(this._partialQuery,i,v),h=y[0],c=y[1],s=this.getGroupTitleAndNarratorText(this._partialQuery,i,u,h);r&&(s.title+=" - "+r);o="useChevron";l="";switch(this._config.clickableGroupAnnotationStyle){case 1:o="";break;case 2:o="underlineOnHover";break;case 3:o="annotationOnHover";l=this._host.getLocString("GroupHeaderAnnotation")}return t.isTopHitChildGroup(i)&&(o+=" topHitConnectedToGroup"),a={type:i,source:r,id:"gr"+i,text:s.title,annotationText:l,narratorText:s.narratorText,tooltip:h?s.narratorText:null,click:h,suggestions:[],instRegionName:n.GroupType[i],instItem:c,selected:!1,cssClasses:o,sequenceNumber:f},c&&this._instrumentationHelper.instrumentSyntheticInstrumentedItem(f,v,c),this._resultsCounter.groups.push({type:i,suggestions:[]}),this.insertGroup(a,e),a},r.prototype.handlePendingSubmit=function(n){if(this._pendingSubmitSequenceNumber==this._lastUpdatedSequenceNumber)try{if(this.topResults.length==0)(this.groups.length>0||n.length>0)&&this.showDisableEnterMessage();else return this._instrumentationHelper.instrumentCustomGping(0,this.topResults[0].instItem.getHValue(),null,this._pendingSubmitModifierKeys),this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.ctrlKey&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(this.topResults[0],t.Verbs.LaunchAsAdmin):this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(this.topResults[0],t.Verbs.OpenInNewWindow):this.topResults[0].click(),this._stopFurtherProcessing(),0}finally{this.resetPendingSubmitSequenceNumber()}return 1},r.prototype.showDisableEnterMessage=function(){this._page.showTemporaryMessage(this._host.getLocString("EnterOnAmbiguousTopHitMessageText"),{content:t.CortanaFontIcons.Info,type:2})},r.prototype.showIndexingMessage=function(i){var r=this,u;t.isMobileCache||(this._config.showEnableIndexerLink&&!i?(this._turnOnIndexingInstItem=n.InstrumentedItem.getNonSuggestionInstrumentedItem(t.SyntheticQSCodes.IndexingMessage_IndexingOptions,t.SyntheticQSCodes.KValues),u={text:this._host.getLocString("WindowsIndexingDisabledAction"),instItem:this._turnOnIndexingInstItem,click:function(){var n=r._sequenceNumberReader.getSequenceNumber(),i=n>r._lastUpdatedSequenceNumber;i&&r._instrumentationHelper.instrumentSyntheticInstrumentedItem(n,t.SyntheticQSCodes.IndexingMessage_IndexingOptions,r._turnOnIndexingInstItem);r._instrumentationHelper.onItemClick(n,i);r.launchIndexingOptions(!1)}}):this._turnOnIndexingInstItem=null,this._page.showIndexingMessage(i,u))},r.prototype.launchIndexingOptions=function(n){var i=this;t.LocalDataProvider.getSettings(this._config,[t.IndexingOptionsSettingId],function(r){var u=r[t.IndexingOptionsSettingId];u?i._host.launchDeviceItem(u.deviceItem,t.DataSources.LocalSettings):n||i.launchIndexingOptions(!0)},null,t.DataSources.LocalSettings,null,!0)},r.prototype.hideIndexingMessage=function(){t.isMobileCache||(this._turnOnIndexingInstItem=null,this._page.hideIndexingMessage())},r.prototype.getAvailableSpace=function(n){var r=this,i;return t.isL2(this._partialQuery)&&this._partialQuery.queryToFetch?Number.MAX_VALUE:(i=this._page.getSuggestionsContainerHeight(),this._config.extraPadding&&(i-=this._config.extraPadding),this._config.scopesOrder.length>0&&(i-=ht),n.topResults.length!=0&&(i-=rt),n.topResults.forEach(function(n){return i-=nt(n,t.isL2(r._partialQuery))}),n.groups.forEach(function(n){return i-=yt(r._partialQuery,n,r._config)}),n.groups.some(function(n){return n.type&&t.isTopHitChildGroup(n.type)})&&n.groups.some(function(n){return n.type&&!t.isTopHitChildGroup(n.type)})&&(i-=st),i)},r.prototype.canFitSuggestion=function(n,t,i){if(!this._partialQuery.fullPartialQuery)return!0;var f=g(this._resultsCounter),r;return n?(r={type:t,suggestions:[]},f.groups.push(r)):r=f.groups.filter(function(n){return n.type==t})[0],r.suggestions.push({wrapsToTwoLines:i&&u(i,t,!1),isSuppressed:i&&i.suppressed,hasSecondaryText:d(t)}),this.getAvailableSpace(f)>=0},r.prototype.getMaxNumberOfGroupsToFitMinSuggestionsPerGroup=function(){var i,r,u,n,f;if(t.isL2(this._partialQuery)&&this._partialQuery.queryToFetch)return Number.MAX_VALUE;for(i=g(this._resultsCounter),r=0,u=i.groups;r<u.length;r++)for(n=u[r];n.suggestions.length<this._config.minSuggestionsPerGroup;)n.suggestions.push(n.suggestions[0]);while(this.getAvailableSpace(i)>0){for(n={type:undefined,suggestions:[]},f=0;f<this._config.minSuggestionsPerGroup;++f)n.suggestions.push({wrapsToTwoLines:!1,isSuppressed:!1,hasSecondaryText:!1});i.groups.push(n)}return i.groups.length-1},r.prototype.onSuggestionAdded=function(i,r){var s=this,e=t.asChildSuggestion(i),o,f,h;e&&(e.displayed=!0,o=e.parent,e.id=o.id+"_"+o.childSuggestions.indexOf(e),f=t.asJumpListSuggestion(i),f&&f.tooltip===undefined&&t.Promise.safeChain("getJumpListDescription",function(){return f.jumpListItem.getDescriptionAsync()},function(t){f.tooltip=t;s.groups.some(function(t){return n.contains(t.suggestions,f)})&&s.renderGroups()}));this.setRemoveIconForDeviceHistory(i);h=this._resultsCounter.groups.filter(function(n){return n.type==r.type})[0];h.suggestions.push({wrapsToTwoLines:u(i,r.type,!1),isSuppressed:i.suppressed,hasSecondaryText:d(r.type)});t.isPhotoOrVideo(r.type)&&r.suggestions.filter(function(n){return!n.suppressed}).length>0&&(r.cssClasses+=t.isL2(this._partialQuery)?" gridLayout":" gridLayout gridLayoutMedium")},r.prototype.onGroupsCleared=function(){this._pendingSuggestionsInExistingGroups=[];this._pendingSuggestionsInMissingGroups=[];this._resultsCounter.groups=[];this._turnOnIndexingInstItem&&this._instrumentationHelper.instrumentSyntheticInstrumentedItem(this._lastUpdatedSequenceNumber,t.SyntheticQSCodes.IndexingMessage_IndexingOptions,this._turnOnIndexingInstItem)},r.prototype.launchSearch=function(n,t){var i=n.queryToFetch;this._host.launchSearch(i,this._navigationHelper.getSearchUrl(n.fullPartialQuery,i,t),!1)},r.prototype.setRemoveIconForDeviceHistory=function(n){n.getExtraVerbs&&n.getExtraVerbs().some(function(n){return n.verb==t.Verbs.RemoveFromDeviceHistory})&&t.setRemoveIcon(n)},r.prototype.onBeforeRenderTopResults=function(i,r,u,f){var e=this,o,s,h,c;return this.topResults.forEach(function(n){return e.setRemoveIconForDeviceHistory(n)}),o=1,this.topResults.length!=1||this.topResults[0].hasChildSuggestionsDisplayed||r.some(function(n){return!!t.asChildSuggestion(n)})&&(this.topResults[0].hasChildSuggestionsDisplayed=!0,o=0),s=this.getSelectableItems(),this._selectedItem&&n.contains(s,this._selectedItem)&&(this._selectedItem!=i[0]||this.topResults[0]==i[0])||(this.select(s.length>0?this.topResults[0]:null,!1),this._page.scrollToTop()),h=this.topResults.length>0,c=!h&&this.groups.length==0&&!r.some(function(n){return e.canFitSuggestion(!0,t.getGroupType(n,e._config),n)}),this._scopesViewModel.render(this._partialQuery,h,c,u,f),o},r.prototype.isRankable=function(t){var i=this;return t.type!=n.GroupType.SearchSuggestions&&t.type!=n.GroupType.Websites&&!t.suggestions.some(function(n){return n.handoffType==8||n.handoffType==5||i._config.enforceOriginalOrderForTypes[n.type]})},r.prototype.openPreviewPane=function(n,t){t.stopPropagation();this._previewPane.showPreview(this._partialQuery,n,this);this._host.setFocusInSearchBox("openPreviewPane")},r.prototype.onAfterRenderTopResults=function(i,r,f,e,o,s,h,c,l,a,v){var y=this,b,d,p;for(v(),this._resultsCounter.topResults=[],b=0,d=this.topResults;b<d.length;b++)p=d[b],this._resultsCounter.topResults.push({wrapsToTwoLines:u(p,null,!0),hasSecondaryText:!!p.secondaryText,hasAdditionalInfoText:!!p.additionalInfoTextFor3LinesTemplate||!!p.stars,isAnswer:!!p.answerHtml,isSuppressed:!1,grid:t.isPhotoOrVideo(p.type)});if(this._autoComplete&&this.topResults.length>0&&this._selectedItem==this.topResults[0]&&this._autoComplete.apply(this.topResults[0]),this.handlePendingSubmit(e)==0)return 0;var k=!1,g=0,tt=function(){k&&g==0&&(y._instrumentationHelper.instrumentRenderFinished(f,s),k=!1)},nt=function(n,t){var r=!1,i;if(y.isRankable(t)&&y._partialQuery&&y._partialQuery.queryToFetch)for(i=0;i<t.suggestions.length;i++)if(n.rankingScore>t.suggestions[i].rankingScore){t.suggestions.splice(i,0,n);r=!0;break}r||t.suggestions.push(n);g+=1;y.setupIcon(f,n,!1,function(){g-=1;tt()});y.onSuggestionAdded(n,t)},w=this.getMaxNumberOfGroupsToFitMinSuggestionsPerGroup()-this.groups.length,it=function(){var n,t,i;if(w!=0&&r||y.flush(nt,f,h),y._partialQuery&&y._partialQuery.queryToFetch)for(y.groups.sort(function(n,t){return h.indexOf(n.type)-h.indexOf(t.type)}),n=0,t=y.groups;n<t.length;n++)i=t[n],y.isRankable(i)&&i.suggestions.sort(function(n,t){return t.rankingScore-n.rankingScore})};return i||e.length>0||o.length>0?(this.renderGroupsAfter(function(){for(var k,u,s,p,a,b,i,r=0,v=o;r<v.length;r++)i=v[r],k=y.removeSuggestion(i),k&&(w+=1);if(u=function(n,i){var u=t.getGroupType(n,y._config),r=y.groups.filter(function(t){return t.type==u&&t.source==n.sourceForGroup})[0],e;r?(e=void 0,e=y._config.minSuggestionsPerGroup&&!i?y._config.minSuggestionsPerGroup-r.suggestions.length:999,e>0&&y.canFitSuggestion(!1,u,n)?nt(n,r):y.queueSuggestionInExistingGroup(n,r)):w>0&&y.canFitSuggestion(!0,u,n)?(r=y.addGroup(u,n.sourceForGroup,n,f,h),nt(n,r),w-=1):y.queueSuggestionInMissingGroup(n,u,n.sourceForGroup)},c){for(s=0,p=e;s<p.length;s++)i=p[s],n.contains(l,i)&&u(i,!0);for(a=0,b=e;a<b.length;a++)i=b[a],n.contains(l,i)||u(i,!1)}else e.forEach(function(n){return u(n,!1)});it()}),k=!0):w!=0&&r||(this._pendingSuggestionsInMissingGroups.some(function(n){return n.suggestions.length>0})||this._pendingSuggestionsInExistingGroups.some(function(n){return n.suggestions.length>0}))&&(this.renderGroupsAfter(function(){return it()}),k=!0),tt(),1},r.prototype.removePendingSuggestionFromExistingGroup=function(n,t){for(var r,u,i=0;i<this._pendingSuggestionsInExistingGroups.length;++i)if(r=this._pendingSuggestionsInExistingGroups[i],r.group==t)if(u=r.suggestions.indexOf(n),u==-1)throw new Error("Pending suggestion not found");else{r.suggestions.splice(u,1);r.suggestions.length==0&&this._pendingSuggestionsInExistingGroups.splice(i,1);return}throw new Error("Pending suggestion not found");},r.prototype.removePendingSuggestionFromMissingGroup=function(n,t,i){for(var r,f,u=0;u<this._pendingSuggestionsInMissingGroups.length;++u)if(r=this._pendingSuggestionsInMissingGroups[u],r.groupType==t&&r.source==i)if(f=r.suggestions.indexOf(n),f==-1)throw new Error("Pending suggestion not found");else{r.suggestions.splice(f,1);r.suggestions.length==0&&this._pendingSuggestionsInMissingGroups.splice(u,1);return}throw new Error("Pending suggestion not found");},r.prototype.queueSuggestionInExistingGroup=function(n,t){var i=this._pendingSuggestionsInExistingGroups.filter(function(n){return n.group.type==t.type&&n.group.source==t.source})[0];i?i.suggestions.push(n):(i={group:t,suggestions:[n]},this._pendingSuggestionsInExistingGroups.push(i))},r.prototype.queueSuggestionInMissingGroup=function(n,t,i){var r=this._pendingSuggestionsInMissingGroups.filter(function(n){return n.groupType==t&&n.source==i})[0];r?r.suggestions.push(n):(r={groupType:t,source:i,suggestions:[n]},this._pendingSuggestionsInMissingGroups.push(r))},r.prototype.partialFlush=function(n,t,i,r){while(n>0&&i.length>0){var u=i[0];this.canFitSuggestion(!1,t.type,u)&&r(u,t);i.splice(0,1);n-=1}},r.prototype.flush=function(n,t,i){for(var f,o,r,h,c=this,l=function(r){var f=r.suggestions[0],e;f&&u.canFitSuggestion(!0,r.groupType,f)&&(e=u.addGroup(r.groupType,r.source,f,t,i),u.partialFlush(u._config.minSuggestionsPerGroup,e,r.suggestions,n),r.suggestions.forEach(function(n){return c.queueSuggestionInExistingGroup(n,e)}),r.suggestions=[])},u=this,e=0,s=this._pendingSuggestionsInMissingGroups;e<s.length;e++)r=s[e],l(r);while(this._pendingSuggestionsInExistingGroups.some(function(n){return n.suggestions.length>0}))for(f=0,o=this._pendingSuggestionsInExistingGroups;f<o.length;f++)r=o[f],h=this._config.minSuggestionsPerGroup?1:r.suggestions.length,this.partialFlush(h,r.group,r.suggestions,n)},r.prototype.removeSuggestion=function(n){var e=t.getGroupType(n,this._config),i=this.groups.filter(function(t){return t.type==e&&t.source==n.sourceForGroup})[0],r,s,f;if(i)if(r=i.suggestions.indexOf(n),r>=0){i.suggestions.splice(r,1);var o=this._resultsCounter.groups.filter(function(n){return n.type==i.type})[0],h=u(n,i.type,!1),c=o.suggestions.findIndex(function(n){return n.wrapsToTwoLines==h});if(o.suggestions.splice(c,1),t.isPhotoOrVideo(i.type)&&i.suggestions.filter(function(n){return!n.suppressed}).length==0&&(i.cssClasses=""),i.suggestions.length==0)return s=this.groups.indexOf(i),this.groups.splice(s,1),this._resultsCounter.groups=this._resultsCounter.groups.filter(function(n){return n.type!=i.type}),f=this._pendingSuggestionsInExistingGroups.filter(function(n){return n.group.type==i.type&&n.group.source==i.source})[0],f&&this._pendingSuggestionsInMissingGroups.push({groupType:i.type,source:n.sourceForGroup,suggestions:f.suggestions}),!0}else this.removePendingSuggestionFromExistingGroup(n,i);else this.removePendingSuggestionFromMissingGroup(n,e,n.sourceForGroup);return!1},r}(n.BaseRootViewModel);t.RootViewModel=tt})(t=n.Windows||(n.Windows={}))})(AutoSuggest||(AutoSuggest={}))